<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Query Language Reference</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#query-language">1. Query Language Reference</a>
<ul class="sectlevel2">
<li><a href="#_basic_syntax">1.1. Basic Syntax</a>
<ul class="sectlevel3">
<li><a href="#_operators">1.1.1. Operators</a></li>
<li><a href="#_value_types">1.1.2. Value Types</a></li>
<li><a href="#_logical_operators">1.1.3. Logical Operators</a></li>
</ul>
</li>
<li><a href="#_common_patterns">1.2. Common Patterns</a>
<ul class="sectlevel3">
<li><a href="#_string_matching">1.2.1. String Matching</a></li>
<li><a href="#_numeric_ranges">1.2.2. Numeric Ranges</a></li>
<li><a href="#_date_and_time_queries">1.2.3. Date and Time Queries</a></li>
<li><a href="#_list_membership">1.2.4. List Membership</a></li>
<li><a href="#_advanced_examples">1.2.5. Advanced Examples</a></li>
<li><a href="#_variables_in_filters">1.2.6. Variables in Filters</a></li>
<li><a href="#_performance_tips">1.2.7. Performance Tips</a></li>
<li><a href="#_integration_with_rest_apis">1.2.8. Integration with REST APIs</a></li>
<li><a href="#_error_handling">1.2.9. Error Handling</a></li>
<li><a href="#_see_also">1.2.10. See Also</a></li>
<li><a href="#_execution_engines_and_listeners">1.2.11. Execution engines and listeners</a></li>
<li><a href="#ontology-query-language">1.2.12. Expressing Ontology Constraints in Queries (optional)</a></li>
</ul>
</li>
<li><a href="#_relationships_and_ontology_aware_queries">1.3. Relationships and Ontology-aware Queries</a>
<ul class="sectlevel3">
<li><a href="#_hydrating_related_data_with_expandpath">1.3.1. Hydrating related data with expand(path)</a></li>
<li><a href="#_ontology_operator_hasedgepredicate_dst">1.3.2. Ontology operator: hasEdge(predicate, dst)</a></li>
<li><a href="#_root_projection_recap_fields">1.3.3. Root projection recap: fields:[+…,-…]</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="query-language">1. Query Language Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quantum uses an ANTLR-based query language (BIAPIQuery.g4) for filtering, searching, and constraining data across all REST endpoints. This single, consistent syntax works everywhere: list APIs, permission rules, and access resolvers.</p>
</div>
<div class="sect2">
<h3 id="_basic_syntax">1.1. Basic Syntax</h3>
<div class="sect3">
<h4 id="_operators">1.1.1. Operators</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Symbol</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name:"Widget"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not equals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:!</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status:!"DELETED"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:&lt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>price:&lt;##100</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quantity:&gt;#50</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Less than or equal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:&#8656;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createdDate:&#8656;2024-12-31</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than or equal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:&gt;=</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>updatedAt:&gt;=2024-01-01T00:00:00Z</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Field exists</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:~</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description:~</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:^</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status:^["ACTIVE","PENDING"]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not in list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:!^</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status:!^["DELETED","ARCHIVED"]</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_value_types">1.1.2. Value Types</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Prefix</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none or <code>"&#8230;&#8203;"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name:widget</code> or <code>name:"Super Widget"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number (integer)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>quantity:#42</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number (decimal)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>##</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>price:##19.99</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shipDate:2024-12-25</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createdAt:2024-12-25T10:30:00Z</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>active:true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description:null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ObjectId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>id:507f1f77bcf86cd799439011</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@@</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>parentId:@@507f1f77bcf86cd799439011</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${&#8230;&#8203;}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ownerId:${principalId}</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_logical_operators">1.1.3. Logical Operators</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Symbol</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AND</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&amp;&amp;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>active:true &amp;&amp; price:&gt;##10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>||</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>status:"ACTIVE" || status:"PENDING"</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!!</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>!!(price:&lt;##5)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grouping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(active:true || featured:true) &amp;&amp; price:&gt;##0</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_common_patterns">1.2. Common Patterns</h3>
<div class="sect3">
<h4 id="_string_matching">1.2.1. String Matching</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Exact match
name:&quot;Super Widget&quot;

# Wildcard matching
name:*widget*        # contains &quot;widget&quot;
name:widget*         # starts with &quot;widget&quot;
name:*widget         # ends with &quot;widget&quot;
name:w?dget          # single character wildcard

# Case sensitivity (depends on database collation)
name:&quot;WIDGET&quot;        # may or may not match &quot;widget&quot;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_numeric_ranges">1.2.2. Numeric Ranges</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Price between 10 and 100
price:&gt;=##10 &amp;&amp; price:&lt;=##100

# Quantity greater than 0
quantity:&gt;#0

# Exact count
itemCount:#5</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_date_and_time_queries">1.2.3. Date and Time Queries</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Orders from today
createdDate:&gt;=2024-12-25

# Orders from last week
createdDate:&gt;=2024-12-18 &amp;&amp; createdDate:&lt;2024-12-25

# Specific timestamp
updatedAt:2024-12-25T14:30:00Z

# Orders modified this year
updatedAt:&gt;=2024-01-01T00:00:00Z</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_list_membership">1.2.4. List Membership</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Status in specific values (IN)
status:^[&quot;ACTIVE&quot;,&quot;PENDING&quot;,&quot;PROCESSING&quot;]

# Exclude statuses (NOT IN)
status:!^[&quot;DELETED&quot;,&quot;ARCHIVED&quot;]

# User IDs from a list (IN)
ownerId:^[&quot;user1&quot;,&quot;user2&quot;,&quot;user3&quot;]

# Exclude specific users (NOT IN)
ownerId:!^[&quot;user1&quot;,&quot;user2&quot;]

# ObjectId list (IN)
categoryId:^[@@507f1f77bcf86cd799439011, @@507f1f77bcf86cd799439012]

# ObjectId list (NOT IN)
categoryId:!^[@@507f1f77bcf86cd799439011, @@507f1f77bcf86cd799439012]

# Mixed types (coerced automatically)
priority:^[#1,#2,#3]

# Using variables (CSV expansion supported by access resolvers)
customerId:!^[${accessibleCustomerIds}]</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_null_and_existence_checks">Null and Existence Checks</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Field has any value (not null)
description:~

# Field is null
description:null

# Field is not null
description:!null

# Field exists and is not empty string
description:~ &amp;&amp; description:!&quot;&quot;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_advanced_examples">1.2.5. Advanced Examples</h4>
<div class="sect4">
<h5 id="_complex_business_logic">Complex Business Logic</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Active products under $50 OR featured products at any price
(active:true &amp;&amp; price:&lt;##50) || featured:true

# Orders needing attention: overdue OR high-value pending
(dueDate:&lt;2024-12-25 &amp;&amp; status:!&quot;COMPLETED&quot;) ||
(status:&quot;PENDING&quot; &amp;&amp; totalAmount:&gt;##1000)

# Products with inventory issues
(quantity:&lt;=#5 &amp;&amp; reorderPoint:&gt;#5) || stockStatus:&quot;OUT_OF_STOCK&quot;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_multi_tenant_filtering">Multi-tenant Filtering</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># User's own records
dataDomain.ownerId:${principalId}

# Organization-wide access
dataDomain.orgRefName:${orgRefName}

# Tenant-scoped with public sharing
dataDomain.tenantId:${pTenantId} || dataDomain.orgRefName:&quot;PUBLIC&quot;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_audit_and_compliance">Audit and Compliance</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Records modified by specific user
auditInfo.lastUpdatedBy:&quot;john.doe&quot;

# Changes in date range
auditInfo.lastUpdatedDate:&gt;=2024-12-01 &amp;&amp;
auditInfo.lastUpdatedDate:&lt;2024-12-31

# Created vs modified
auditInfo.createdDate:auditInfo.lastUpdatedDate  # never modified
auditInfo.createdDate:!auditInfo.lastUpdatedDate # has been modified</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_variables_in_filters">1.2.6. Variables in Filters</h4>
<div class="paragraph">
<p>Variables are resolved from the current security context and can be used in permission rules and access resolvers.</p>
</div>
<div class="sect4">
<h5 id="_standard_variables">Standard Variables</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${principalId}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current user&#8217;s ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${pTenantId}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Principal&#8217;s tenant ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${pAccountId}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Principal&#8217;s account ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${pOrgRefName}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Principal&#8217;s organization</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${realm}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current realm/database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${area}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current functional area</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${functionalDomain}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current functional domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>${action}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current action (CREATE, UPDATE, etc.)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_custom_variables_from_access_resolvers">Custom Variables from Access Resolvers</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// In your AccessListResolver</span>
<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">String</span> key() {
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">accessibleCustomerIds</span><span class="delimiter">&quot;</span></span>;  <span class="comment">// becomes ${accessibleCustomerIds}</span>
}

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;?&gt; resolve(...) {
    <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">CUST001</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">CUST002</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">CUST003</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Use in filter
customerId:^[${accessibleCustomerIds}]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_performance_tips">1.2.7. Performance Tips</h4>
<div class="sect4">
<h5 id="_efficient_queries">Efficient Queries</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Good: Use indexed fields first
status:&quot;ACTIVE&quot; &amp;&amp; createdDate:&gt;=2024-01-01

# Better: Combine with specific values
status:&quot;ACTIVE&quot; &amp;&amp; ownerId:${principalId} &amp;&amp; createdDate:&gt;=2024-01-01

# Avoid: Leading wildcards on large collections
name:*widget  # can be slow on millions of records</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_projection_for_large_objects">Projection for Large Objects</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># In REST calls, limit returned fields
GET /products/list?filter=active:true&amp;projection=+id,+name,+price,-description</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_integration_with_rest_apis">1.2.8. Integration with REST APIs</h4>
<div class="sect4">
<h5 id="_list_endpoints">List Endpoints</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># Basic filtering
GET /products/list?filter=active:true

# With sorting and pagination
GET /products/list?filter=price:&gt;##10&amp;sort=-createdDate&amp;skip=20&amp;limit=10

# Complex filter with projection
GET /orders/list?filter=(status:&quot;PENDING&quot;||status:&quot;PROCESSING&quot;)&amp;&amp;totalAmount:&gt;##100&amp;projection=+id,+status,+totalAmount,+customerName</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_permission_rules">Permission Rules</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">- <span class="string"><span class="content">name: user-own-records</span></span>
  <span class="key">priority</span>: <span class="string"><span class="content">300</span></span>
  <span class="key">match</span>:
    <span class="key">method</span>: <span class="string"><span class="content">[GET]</span></span>
    <span class="key">url</span>: <span class="string"><span class="content">/api/**</span></span>
  <span class="key">effect</span>: <span class="string"><span class="content">ALLOW</span></span>
  <span class="key">andFilterString</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dataDomain.ownerId:${principalId}</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_access_resolvers">Access Resolvers</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Resolver returns customer IDs user can access</span>
<span class="directive">public</span> <span class="predefined-type">Collection</span>&lt;?&gt; resolve(...) {
    <span class="keyword">return</span> customerService.getAccessibleIds(principalId);
}

<span class="comment">// Used in permission rule</span>
andFilterString: <span class="string"><span class="delimiter">&quot;</span><span class="content">customerId:^[${accessibleCustomerIds}]</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_error_handling">1.2.9. Error Handling</h4>
<div class="paragraph">
<p>Common syntax errors and solutions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Wrong: Missing quotes for multi-word strings
name:Super Widget
# Right:
name:&quot;Super Widget&quot;

# Wrong: Incorrect number prefix
price:19.99
# Right:
price:##19.99

# Wrong: Invalid date format
createdDate:12/25/2024
# Right:
createdDate:2024-12-25

# Wrong: Unbalanced parentheses
(active:true &amp;&amp; price:&gt;##10
# Right:
(active:true &amp;&amp; price:&gt;##10)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_see_also">1.2.10. See Also</h4>
<div class="ulist">
<ul>
<li>
<p><a href="rest-crud.html#querying">REST CRUD Querying</a></p>
</li>
<li>
<p><a href="permissions.html">Permission Rules</a></p>
</li>
<li>
<p><a href="domain-rule-context.html">Access Resolvers</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_execution_engines_and_listeners">1.2.11. Execution engines and listeners</h4>
<div class="paragraph">
<p>The BIAPI query syntax is parsed once (via ANTLR) and can be executed by different "listeners" depending on the use case. Quantum ships with two primary implementations that share the same grammar and semantics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Morphia listener: converts a query into Mongo/Morphia Filters for database-side execution</p>
</li>
<li>
<p>In-memory listener: converts a query into a Java Predicate over JSON data for Quarkus/GraalVM-friendly in-memory execution</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_morphia_querytofilterlistener">Morphia: QueryToFilterListener</h5>
<div class="paragraph">
<p>Use this when you want the database to perform the filtering. The listener walks the parse tree and produces a dev.morphia.query.filters.Filter which you can apply to Morphia queries. This is ideal for repository APIs and any endpoint where you want to leverage MongoDB indexes and avoid loading large data sets into memory.</p>
</div>
<div class="paragraph">
<p>Key characteristics:
- Output type: Morphia Filter
- Execution: database-side (MongoDB)
- Semantics: identical to grammar (comparisons, IN/NIN, exists, null, regex with wildcards, elemMatch, boolean &amp;&amp;/||/!!)
- Variable expansion: supports ${vars} and single-variable IN list expansion (e.g., [${ids}] can expand to a collection/array or a comma-separated string)</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.e2eq.framework.grammar</span>.*;
<span class="keyword">import</span> <span class="include">com.e2eq.framework.model.persistent.morphia.QueryToFilterListener</span>;
<span class="keyword">import</span> <span class="include">dev.morphia.query.filters.Filter</span>;
<span class="keyword">import</span> <span class="include">dev.morphia.query.filters.Filters</span>;
<span class="keyword">import</span> <span class="include">org.antlr.v4.runtime</span>.*;
<span class="keyword">import</span> <span class="include">org.antlr.v4.runtime.tree.ParseTreeWalker</span>;
<span class="keyword">import</span> <span class="include">org.apache.commons.text.StringSubstitutor</span>;

<span class="predefined-type">String</span> query = <span class="string"><span class="delimiter">&quot;</span><span class="content">(status:Assigned||status:Pending)&amp;&amp;displayName:*Route*</span><span class="delimiter">&quot;</span></span>;
<span class="type">var</span> vars = java.util.Map.&lt;<span class="predefined-type">String</span>,<span class="predefined-type">String</span>&gt;of();

<span class="comment">// Parse</span>
CharStream cs = CharStreams.fromString(query);
BIAPIQueryLexer lexer = <span class="keyword">new</span> BIAPIQueryLexer(cs);
CommonTokenStream tokens = <span class="keyword">new</span> CommonTokenStream(lexer);
BIAPIQueryParser parser = <span class="keyword">new</span> BIAPIQueryParser(tokens);
BIAPIQueryParser.QueryContext tree = parser.query();

<span class="comment">// Build Morphia filter</span>
QueryToFilterListener listener = <span class="keyword">new</span> QueryToFilterListener(vars, <span class="keyword">new</span> StringSubstitutor(vars), <span class="comment">/* modelClass */</span> <span class="predefined-constant">null</span>);
ParseTreeWalker.DEFAULT.walk(listener, tree);
<span class="predefined-type">Filter</span> morphiaFilter = listener.getFilter();

<span class="comment">// Use with Morphia query (example)</span>
<span class="comment">// datastore.find(MyEntity.class).filter(morphiaFilter).iterator().toList();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A few query examples (taken from testQueryStrings.txt):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Equality: field:"quotedString"</p>
</li>
<li>
<p>Comparisons: field:&gt;##12.56, field:&#8656;#123</p>
</li>
<li>
<p>IN/NIN: field:^[value1,value2], field:!^[value1,value2]</p>
</li>
<li>
<p>Exists/Null: field:~, field:null</p>
</li>
<li>
<p>elemMatch: arrayField:{(subField:&lt;#12)||(subField:&gt;#15)}</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_in_memory_jsonnode_querytopredicatejsonlistener">In-memory (JsonNode): QueryToPredicateJsonListener</h5>
<div class="paragraph">
<p>Use this when you need to evaluate queries in memory without reflection on POJOs. This implementation compiles a query into a java.util.function.Predicate over a Jackson JsonNode. It is Quarkus/GraalVM friendly, useful for:
- Unit tests where you want to validate query behavior without a database
- Post-filtering or pre-filtering of already-fetched data
- Evaluating access rules or business logic against transient objects</p>
</div>
<div class="paragraph">
<p>Key characteristics:
- Output type: Predicate&lt;JsonNode&gt;
- Execution: in-memory
- No runtime reflection: operates on JsonNode
- Semantics and variable expansion match the Morphia listener</p>
</div>
<div class="paragraph">
<p>Convenience helpers exist in QueryPredicates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.e2eq.framework.query.QueryPredicates</span>;
<span class="keyword">import</span> <span class="include">com.fasterxml.jackson.databind.JsonNode</span>;
<span class="keyword">import</span> <span class="include">java.util.function.Predicate</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;

<span class="predefined-type">String</span> query = <span class="string"><span class="delimiter">&quot;</span><span class="content">(status:Assigned||status:Pending)&amp;&amp;displayName:*Route*</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Predicate</span>&lt;JsonNode&gt; p = QueryPredicates.compilePredicate(query, <span class="predefined-type">Map</span>.of(), <span class="predefined-type">Map</span>.of());

<span class="comment">// Example data as a POJO or Map -&gt; convert to JsonNode</span>
record Ticket(<span class="predefined-type">String</span> status, <span class="predefined-type">String</span> displayName) {}
Ticket ticket = <span class="keyword">new</span> Ticket(<span class="string"><span class="delimiter">&quot;</span><span class="content">Assigned</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Route Exception in Route:To[http://com.xxx/update]</span><span class="delimiter">&quot;</span></span>);
JsonNode node = QueryPredicates.toJsonNode(ticket);

<span class="type">boolean</span> include = p.test(node); <span class="comment">// true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Additional examples</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Equality and comparisons</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>var vars = Map.&lt;String,String&gt;of();
var objVars = Map.&lt;String,Object&gt;of();
Predicate&lt;JsonNode&gt; eq = QueryPredicates.compilePredicate("quantity:#42", vars, objVars);
Predicate&lt;JsonNode&gt; gt = QueryPredicates.compilePredicate("price:&gt;##19.99", vars, objVars);

JsonNode product = QueryPredicates.toJsonNode(Map.of("quantity", 42, "price", 25.00));
assert eq.test(product);
assert gt.test(product);</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>IN / NIN with variable expansion</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>var vars = Map.of("principalId", "66d1f1ab452b94674bbd934a");
Predicate&lt;JsonNode&gt; in = QueryPredicates.compilePredicate("ownerId:^[${principalId},value2]", vars, Map.of());
JsonNode doc = QueryPredicates.toJsonNode(Map.of("ownerId", "66d1f1ab452b94674bbd934a"));
assert in.test(doc);</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>elemMatch over arrays of objects</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>String q = "items:{(sku:abc||qty:&gt;#10)&amp;&amp;price:&lt;=##9.99}";
Predicate&lt;JsonNode&gt; em = QueryPredicates.compilePredicate(q, Map.of(), Map.of());
JsonNode order = QueryPredicates.toJsonNode(Map.of(
  "items", java.util.List.of(
     Map.of("sku","abc","qty", 5,  "price", 9.99),
     Map.of("sku","xyz","qty", 12, "price", 8.50)
)));
// Matches: first item by sku OR second item by qty with price cap
assert em.test(order);</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Regex with wildcards</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Predicate&lt;JsonNode&gt; rx = QueryPredicates.compilePredicate("displayName:*Route*", Map.of(), Map.of());
JsonNode ticket = QueryPredicates.toJsonNode(Map.of("displayName", "Route Exception in Route:To[...]"));
assert rx.test(ticket);</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_choosing_the_right_listener">Choosing the right listener</h5>
<div class="ulist">
<ul>
<li>
<p>Use Morphia (QueryToFilterListener) when:</p>
<div class="ulist">
<ul>
<li>
<p>You are filtering MongoDB collections and want the DB to do the work (indexing, pagination, scalability)</p>
</li>
<li>
<p>You need server-side performance and minimal memory footprint</p>
</li>
</ul>
</div>
</li>
<li>
<p>Use In-memory (QueryToPredicateJsonListener) when:</p>
<div class="ulist">
<ul>
<li>
<p>You run in Quarkus native image and want to avoid reflection on POJOs</p>
</li>
<li>
<p>You are writing unit tests or applying rules to transient/aggregated data</p>
</li>
<li>
<p>You need to evaluate a query over already materialized objects without another database round-trip</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both listeners aim to maintain parity with the grammar. If you observe mismatches, please file an issue with the query string, the evaluated data sample, and the expected vs actual results.</p>
</div>
</div>
<div class="sect4">
<h5 id="_query_field_validation">Query Field Validation</h5>
<div class="paragraph">
<p>Quantum provides validation capabilities to detect references to non-existent fields before query execution, preventing runtime errors and providing early feedback.</p>
</div>
<div class="sect5">
<h6 id="_validating_listeners">Validating Listeners</h6>
<div class="paragraph">
<p>Two validating listener implementations extend the standard listeners:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ValidatingQueryToFilterListener: extends QueryToFilterListener for Morphia queries</p>
</li>
<li>
<p>ValidatingQueryToPredicateJsonListener: extends QueryToPredicateJsonListener for in-memory predicates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both validate field references against a model class during parsing and accumulate errors.</p>
</div>
<div class="paragraph">
<p>Example usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.e2eq.framework.model.persistent.morphia.ValidatingQueryToFilterListener</span>;
<span class="keyword">import</span> <span class="include">com.e2eq.framework.grammar</span>.*;
<span class="keyword">import</span> <span class="include">org.antlr.v4.runtime</span>.*;
<span class="keyword">import</span> <span class="include">org.antlr.v4.runtime.tree.ParseTreeWalker</span>;

<span class="predefined-type">String</span> query = <span class="string"><span class="delimiter">&quot;</span><span class="content">name:John AND invalidField:test</span><span class="delimiter">&quot;</span></span>;

BIAPIQueryLexer lexer = <span class="keyword">new</span> BIAPIQueryLexer(CharStreams.fromString(query));
CommonTokenStream tokens = <span class="keyword">new</span> CommonTokenStream(lexer);
BIAPIQueryParser parser = <span class="keyword">new</span> BIAPIQueryParser(tokens);

ValidatingQueryToFilterListener listener =
    <span class="keyword">new</span> ValidatingQueryToFilterListener(UserProfile.class);
ParseTreeWalker.DEFAULT.walk(listener, parser.query());

<span class="keyword">if</span> (listener.hasValidationErrors()) {
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; errors = listener.getValidationErrors();
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalArgumentException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid query: </span><span class="delimiter">&quot;</span></span> + errors);
}

<span class="predefined-type">Filter</span> filter = listener.getFilter();</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_validqueryfilter_annotation">@ValidQueryFilter Annotation</h6>
<div class="paragraph">
<p>For automatic validation in DTOs and models, use the <code>@ValidQueryFilter</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.e2eq.framework.annotations.ValidQueryFilter</span>;
<span class="keyword">import</span> <span class="include">jakarta.validation.constraints.NotNull</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SearchRequest</span> {
    <span class="annotation">@NotNull</span>
    <span class="annotation">@ValidQueryFilter</span>(modelClass = UserProfile.class)
    <span class="directive">private</span> <span class="predefined-type">String</span> filterQuery;

    <span class="comment">// getters/setters</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation integrates with Jakarta Bean Validation and is automatically enforced by the ValidationInterceptor during entity persistence.</p>
</div>
<div class="paragraph">
<p>REST endpoint example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/users</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">UserResource</span> {

    <span class="annotation">@GET</span>
    <span class="directive">public</span> Response searchUsers(<span class="annotation">@Valid</span> <span class="annotation">@BeanParam</span> SearchParams params) {
        <span class="comment">// filterQuery is validated before this method executes</span>
        <span class="keyword">return</span> Response.ok(userService.search(params.getFilterQuery())).build();
    }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">SearchParams</span> {
    <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">filter</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@ValidQueryFilter</span>(modelClass = UserProfile.class)
    <span class="directive">private</span> <span class="predefined-type">String</span> filterQuery;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Persisted filter example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SavedSearch</span> <span class="directive">extends</span> BaseModel {
    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="annotation">@ValidQueryFilter</span>(modelClass = Order.class)
    <span class="directive">private</span> <span class="predefined-type">String</span> filterExpression;

    <span class="comment">// When saved, ValidationInterceptor validates the filter</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_queryfieldvalidator_utility">QueryFieldValidator Utility</h6>
<div class="paragraph">
<p>For programmatic validation without listeners:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.e2eq.framework.query.QueryFieldValidator</span>;

<span class="comment">// Validate against a model class</span>
QueryFieldValidator validator = QueryFieldValidator.forModelClass(UserProfile.class);

<span class="type">boolean</span> isValid = validator.validateField(<span class="string"><span class="delimiter">&quot;</span><span class="content">email</span><span class="delimiter">&quot;</span></span>);  <span class="comment">// true</span>
<span class="type">boolean</span> isInvalid = validator.validateField(<span class="string"><span class="delimiter">&quot;</span><span class="content">nonExistentField</span><span class="delimiter">&quot;</span></span>);  <span class="comment">// false</span>

<span class="keyword">if</span> (validator.hasErrors()) {
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; errors = validator.getErrors();
    <span class="comment">// Handle validation errors</span>
}

<span class="comment">// Validate against aggregation pipeline schema</span>
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Class</span>&lt;?&gt;&gt; schema = <span class="predefined-type">Map</span>.of(
    <span class="string"><span class="delimiter">&quot;</span><span class="content">totalAmount</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Double</span>.class,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">orderCount</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Long</span>.class,
    <span class="string"><span class="delimiter">&quot;</span><span class="content">customerName</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">String</span>.class
);

QueryFieldValidator aggValidator = QueryFieldValidator.forAggregationSchema(schema);
aggValidator.validateField(<span class="string"><span class="delimiter">&quot;</span><span class="content">totalAmount</span><span class="delimiter">&quot;</span></span>);  <span class="comment">// true</span>
aggValidator.validateField(<span class="string"><span class="delimiter">&quot;</span><span class="content">invalidField</span><span class="delimiter">&quot;</span></span>);  <span class="comment">// false</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_benefits">Benefits</h6>
<div class="ulist">
<ul>
<li>
<p>Early error detection: catch field reference errors before query execution</p>
</li>
<li>
<p>Better error messages: specific feedback about which fields are invalid</p>
</li>
<li>
<p>Development safety: prevent typos and refactoring issues</p>
</li>
<li>
<p>API validation: validate user-provided query strings in REST endpoints</p>
</li>
<li>
<p>Data integrity: prevent saving invalid filter expressions to the database</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ontology-query-language">1.2.12. Expressing Ontology Constraints in Queries (optional)</h4>
<div class="paragraph">
<p>The BIAPI query language primarily targets fields on documents. When using the ontology modules, there are two ways to incorporate ontology relationships into queries:</p>
</div>
<div class="paragraph">
<p>Option A: Variable from an AccessListResolver</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A resolver computes the set of IDs using EdgeDao (e.g., orders related by placedInOrg to the caller’s org).</p>
</li>
<li>
<p>Use an IN clause over id in your filter string:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># idsByPlacedInOrg is published by an AccessListResolver
id:^${idsByPlacedInOrg}</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Option B: Function-style helper (if you wire one)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some applications register a hasEdge(predicate, value) function into the filter translation path.</p>
</li>
<li>
<p>Example (conceptual): hasEdge("placedInOrg", ${principal.orgRefName})</p>
</li>
<li>
<p>Under the hood, it translates to id IN edgeDao.srcIdsByDst(tenantId, predicate, dst).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Notes</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ontology is optional; these patterns only apply when enabled and materialization is active.</p>
</li>
<li>
<p>Always scope edge lookups by tenantId from RuleContext.</p>
</li>
<li>
<p>See <a href="ontology.html#ontology-integration-morphia-permissions">Integrating Ontology</a> for wiring examples.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Policy function hasEdge()</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The hasEdge(predicate, dstIdOrVar) operator is a policy-level function evaluated before query translation. It is not part of the BIAPI grammar parsed in this document.</p>
</li>
<li>
<p>When present in a policy, the repository typically applies it by calling ListQueryRewriter.rewriteForHasEdge(&#8230;&#8203;), which constrains results by the set of IDs that have the specified ontology edge.</p>
</li>
<li>
<p>See <a href="permissions.html#rule-hasedge">Rule language: add hasEdge()</a> for signature, semantics, and a full end-to-end example.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_relationships_and_ontology_aware_queries">1.3. Relationships and Ontology-aware Queries</h3>
<div class="sect3">
<h4 id="_hydrating_related_data_with_expandpath">1.3.1. Hydrating related data with expand(path)</h4>
<div class="paragraph">
<p>The query language supports a compact, non-SQL directive to request hydration (materialization) of related entities referenced by the root documents.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Syntax: <code>expand(path)</code></p>
</li>
<li>
<p>Path: a dotted path; array segments may use <code>[*]</code> to indicate an array of references.</p>
</li>
<li>
<p>Variables: segments may be literal field names or <code>${var}</code> placeholders that are substituted before planning.</p>
</li>
<li>
<p>Examples:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Single reference
expand(customer)

# Parameterized segment (for tenant-specific collections)
expand(${tenantRoot}.sites[*])

# Array of references
expand(items[*].product)

# Nested paths (bounded by first non-reference boundary)
expand(patient.visits[*].diagnoses[*])</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Semantics</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Presence of <code>expand(&#8230;&#8203;)</code> informs the planner to choose an aggregation-based execution plan (e.g., MongoDB $lookup) rather than a simple single-collection filter.</p>
</li>
<li>
<p>Filters remain expressed with the existing primitives and compose as usual. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Filter roots by status AND hydrate the related customer
expand(customer) &amp;&amp; status:active</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Notes and limits (v1)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Backend: MongoDB only in this release. The planner selects aggregation mode when <code>expand(&#8230;&#8203;)</code> appears.</p>
</li>
<li>
<p>Depth: for mixed arrays/objects, traversal stops at the first non-reference boundary.</p>
</li>
<li>
<p>Projection: a concise projection form <code>fields:[+a,+b,-c]</code> can be used at the root (see below). Per-expansion projections and related-entity filters are documented in <a href="query-expansion.html">Query Expansion</a> and may be introduced incrementally.</p>
</li>
<li>
<p>Errors: unknown projection paths (when using <code>fields:[…]</code>) are hard errors.</p>
</li>
<li>
<p>Variables: <code>${var}</code> placeholders in expand paths leverage the same substitution map (request variables plus resolver outputs) as other filter expressions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="query-expansion.html">Query Expansion</a> for more examples and planner behavior.</p>
</li>
<li>
<p><a href="planner-and-query-gateway.html">Planner and QueryGateway</a> for how execution mode is chosen.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_ontology_operator_hasedgepredicate_dst">1.3.2. Ontology operator: hasEdge(predicate, dst)</h4>
<div class="paragraph">
<p>When the ontology module is enabled and edges are materialized, you can constrain results by semantic relationships using <code>hasEdge</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Syntax: <code>hasEdge(predicate, dst)</code> where</p>
</li>
<li>
<p><code>predicate</code> can be an unquoted string, a quoted string, or a <code>${var}</code> placeholder supplied by the caller</p>
</li>
<li>
<p><code>dst</code> can be a literal id, a variable like <code>${principalId}</code>, an ObjectId, or a reference literal <code>@@&#8230;&#8203;</code></p>
</li>
<li>
<p>Examples:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Orders placed in a specific organization
hasEdge(&quot;placedInOrg&quot;, ${orgRefName})

# Tickets routed to a region by id
hasEdge(&quot;routedToRegion&quot;, 507f1f77bcf86cd799439011)</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Semantics</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hasEdge</code> narrows the result set to entities that have the specified ontology edge from the entity (source) to the destination id/value.</p>
</li>
<li>
<p>It composes with other filters using <code>&amp;&amp;</code>, <code>||</code>, and <code>!!</code> like any other expression.</p>
</li>
<li>
<p>Tenancy: edge resolution is always scoped by tenant/realm per your configuration.</p>
</li>
<li>
<p>Variables: both arguments participate in the standard substitution flow, so resolver output such as <code>${accessibleOrgPredicate}</code> and <code>${orgIds}</code> can drive ontology constraints without manual string building.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="permissions.html#rule-hasedge">Rule language: add hasEdge()</a> for a deep dive and policy usage.</p>
</li>
<li>
<p><a href="ontology.html#ontology-integration-morphia-permissions">Ontology integration</a> for repository wiring and examples.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_root_projection_recap_fields">1.3.3. Root projection recap: fields:[+…,-…]</h4>
<div class="paragraph">
<p>To include or exclude fields from the root documents:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Syntax: <code>fields:[+f1,+f2,-f3]</code></p>
</li>
<li>
<p>Include mode: if any <code>+</code> is present, only the listed fields are included (with explicit <code>-</code> carving out exceptions).</p>
</li>
<li>
<p>Exclude mode: if only <code>-</code> entries exist, all fields are included except those.</p>
</li>
<li>
<p>Default <code>_id</code>: preserved unless explicitly specified (<code>+_id</code>/<code>-_id</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># Include a few fields from the root and drop one
fields:[+_id,+total,-internalNotes]

# Combine with expansion (planner chooses aggregation mode)
expand(customer) &amp;&amp; fields:[+_id,+customer,+total]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For per-expansion projections and advanced traversal filters, see <a href="query-expansion.html">Query Expansion</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.2.2-SNAPSHOT<br>
Last updated 2025-11-13 13:17:09 -0600
</div>
</div>
</body>
</html>