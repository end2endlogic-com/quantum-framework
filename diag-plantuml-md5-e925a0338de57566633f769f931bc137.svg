<svg contentStyleType='text/css' data-diagram-type='SEQUENCE' height='688px' preserveAspectRatio='none' style='width:812px;height:688px;background:#FFFFFF;' version='1.1' viewBox='0 0 812 688' width='812px' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns='http://www.w3.org/2000/svg' zoomAndPan='magnify'><defs/><g><g><title>RuleContext.checkRules</title><rect fill='#FFFFFF' height='447.0371' style='stroke:#181818;stroke-width:1;' width='10' x='385.355' y='142.1094'/></g><rect fill='none' height='283.7949' style='stroke:#000000;stroke-width:1.5;' width='751.2231' x='55.644' y='277.041'/><rect fill='none' height='75.9316' style='stroke:#000000;stroke-width:1.5;' width='505.106' x='291.7612' y='343.6621'/><rect fill='none' height='120.2422' style='stroke:#000000;stroke-width:1.5;' width='531.7607' x='65.644' y='433.5938'/><rect fill='none' height='46.6211' style='stroke:#000000;stroke-width:1.5;' width='413.3047' x='75.644' y='500.2148'/><g><title>Client</title><rect fill='#000000' fill-opacity='0.00000' height='525.6582' width='8' x='23.7524' y='81.4883'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='27' x2='27' y1='81.4883' y2='607.1465'/></g><g><title>SecurityFilter</title><rect fill='#000000' fill-opacity='0.00000' height='525.6582' width='8' x='132.5889' y='81.4883'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='135.644' x2='135.644' y1='81.4883' y2='607.1465'/></g><g><title>RuleContext.checkRules</title><rect fill='#000000' fill-opacity='0.00000' height='525.6582' width='8' x='386.355' y='81.4883'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='389.7612' x2='389.7612' y1='81.4883' y2='607.1465'/></g><g><title>postconditionScript</title><rect fill='#000000' fill-opacity='0.00000' height='525.6582' width='8' x='709.7637' y='81.4883'/><line style='stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;' x1='713.6602' x2='713.6602' y1='81.4883' y2='607.1465'/></g><g class='participant participant-head' data-participant='Client'><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='39.5049' x='5' y='78.5352'>Client</text><ellipse cx='27.7524' cy='13.5' fill='#E2E2F0' rx='8' ry='8' style='stroke:#181818;stroke-width:0.5;'/><path d='M27.7524,21.5 L27.7524,48.5 M14.7524,29.5 L40.7524,29.5 M27.7524,48.5 L14.7524,63.5 M27.7524,48.5 L40.7524,63.5' fill='none' style='stroke:#181818;stroke-width:0.5;'/></g><g class='participant participant-tail' data-participant='Client'><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='39.5049' x='5' y='619.6816'>Client</text><ellipse cx='27.7524' cy='631.1348' fill='#E2E2F0' rx='8' ry='8' style='stroke:#181818;stroke-width:0.5;'/><path d='M27.7524,639.1348 L27.7524,666.1348 M14.7524,647.1348 L40.7524,647.1348 M27.7524,666.1348 L14.7524,681.1348 M27.7524,666.1348 L40.7524,681.1348' fill='none' style='stroke:#181818;stroke-width:0.5;'/></g><g class='participant participant-head' data-participant='SecurityFilter'><rect fill='#E2E2F0' height='30.4883' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='101.8896' x='85.644' y='50'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='87.8896' x='92.644' y='70.5352'>SecurityFilter</text></g><g class='participant participant-tail' data-participant='SecurityFilter'><rect fill='#E2E2F0' height='30.4883' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='101.8896' x='85.644' y='606.1465'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='87.8896' x='92.644' y='626.6816'>SecurityFilter</text></g><g class='participant participant-head' data-participant='RuleContext'><rect fill='#E2E2F0' height='30.4883' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='177.1875' x='301.7612' y='50'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='163.1875' x='308.7612' y='70.5352'>RuleContext.checkRules</text></g><g class='participant participant-tail' data-participant='RuleContext'><rect fill='#E2E2F0' height='30.4883' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='177.1875' x='301.7612' y='606.1465'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='163.1875' x='308.7612' y='626.6816'>RuleContext.checkRules</text></g><g class='participant participant-head' data-participant='Script'><rect fill='#E2E2F0' height='30.4883' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='146.207' x='640.6602' y='50'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='132.207' x='647.6602' y='70.5352'>postconditionScript</text></g><g class='participant participant-tail' data-participant='Script'><rect fill='#E2E2F0' height='30.4883' rx='2.5' ry='2.5' style='stroke:#181818;stroke-width:0.5;' width='146.207' x='640.6602' y='606.1465'/><text fill='#000000' font-family='sans-serif' font-size='14' lengthAdjust='spacing' textLength='132.207' x='647.6602' y='626.6816'>postconditionScript</text></g><g><title>RuleContext.checkRules</title><rect fill='#FFFFFF' height='447.0371' style='stroke:#181818;stroke-width:1;' width='10' x='385.355' y='142.1094'/></g><g class='message' data-participant-1='Client' data-participant-2='SecurityFilter'><line style='stroke:#181818;stroke-width:1;' x1='134.5889' x2='124.5889' y1='112.7988' y2='108.7988'/><line style='stroke:#181818;stroke-width:1;' x1='134.5889' x2='124.5889' y1='112.7988' y2='116.7988'/><line style='stroke:#181818;stroke-width:1;' x1='27.7524' x2='135.5889' y1='112.7988' y2='112.7988'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='84.8364' x='34.7524' y='108.0566'>HTTP request</text></g><g class='message' data-participant-1='SecurityFilter' data-participant-2='RuleContext'><line style='stroke:#181818;stroke-width:1;' x1='383.355' x2='373.355' y1='142.1094' y2='138.1094'/><line style='stroke:#181818;stroke-width:1;' x1='383.355' x2='373.355' y1='142.1094' y2='146.1094'/><line style='stroke:#181818;stroke-width:1;' x1='136.5889' x2='384.355' y1='142.1094' y2='142.1094'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='229.7661' x='143.5889' y='137.3672'>PrincipalContext + ResourceContext</text></g><path d='M278,155.1094 L278,180.1094 L501,180.1094 L501,165.1094 L491,155.1094 L278,155.1094' fill='#FEFFDD' style='stroke:#181818;stroke-width:0.5;'/><path d='M491,155.1094 L491,165.1094 L501,165.1094 L491,155.1094' fill='#FEFFDD' style='stroke:#181818;stroke-width:0.5;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='202.5728' x='284' y='172.6777'>Expand identities: userId &#8746; roles</text><g class='message' data-participant-1='RuleContext' data-participant-2='RuleContext'><line style='stroke:#181818;stroke-width:1;' x1='395.355' x2='437.355' y1='206.7305' y2='206.7305'/><line style='stroke:#181818;stroke-width:1;' x1='437.355' x2='437.355' y1='206.7305' y2='219.7305'/><line style='stroke:#181818;stroke-width:1;' x1='396.355' x2='437.355' y1='219.7305' y2='219.7305'/><polygon fill='#181818' points='406.355,215.7305,396.355,219.7305,406.355,223.7305,402.355,219.7305' style='stroke:#181818;stroke-width:1;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='184.2915' x='402.355' y='201.9883'>Gather rules for each identity</text></g><g class='message' data-participant-1='RuleContext' data-participant-2='RuleContext'><line style='stroke:#181818;stroke-width:1;' x1='395.355' x2='437.355' y1='249.041' y2='249.041'/><line style='stroke:#181818;stroke-width:1;' x1='437.355' x2='437.355' y1='249.041' y2='262.041'/><line style='stroke:#181818;stroke-width:1;' x1='396.355' x2='437.355' y1='262.041' y2='262.041'/><polygon fill='#181818' points='406.355,258.041,396.355,262.041,406.355,266.041,402.355,262.041' style='stroke:#181818;stroke-width:1;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='162.3477' x='402.355' y='244.2988'>Sort by ascending priority</text></g><path d='M55.644,277.041 L130.0908,277.041 L130.0908,284.3516 L120.0908,294.3516 L55.644,294.3516 L55.644,277.041' fill='#EEEEEE' style='stroke:#000000;stroke-width:1.5;'/><rect fill='none' height='283.7949' style='stroke:#000000;stroke-width:1.5;' width='751.2231' x='55.644' y='277.041'/><text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacing' textLength='29.4468' x='70.644' y='290.6094'>loop</text><text fill='#000000' font-family='sans-serif' font-size='11' font-weight='bold' lengthAdjust='spacing' textLength='108.9902' x='145.0908' y='289.6758'>[Each rule in order]</text><g class='message' data-participant-1='RuleContext' data-participant-2='RuleContext'><line style='stroke:#181818;stroke-width:1;' x1='395.355' x2='437.355' y1='315.6621' y2='315.6621'/><line style='stroke:#181818;stroke-width:1;' x1='437.355' x2='437.355' y1='315.6621' y2='328.6621'/><line style='stroke:#181818;stroke-width:1;' x1='396.355' x2='437.355' y1='328.6621' y2='328.6621'/><polygon fill='#181818' points='406.355,324.6621,396.355,328.6621,406.355,332.6621,402.355,328.6621' style='stroke:#181818;stroke-width:1;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='289.4087' x='402.355' y='310.9199'>Wildcard match on SecurityURI (header+body)</text></g><path d='M291.7612,343.6621 L353.8999,343.6621 L353.8999,350.9727 L343.8999,360.9727 L291.7612,360.9727 L291.7612,343.6621' fill='#EEEEEE' style='stroke:#000000;stroke-width:1.5;'/><rect fill='none' height='75.9316' style='stroke:#000000;stroke-width:1.5;' width='505.106' x='291.7612' y='343.6621'/><text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacing' textLength='17.1387' x='306.7612' y='357.2305'>alt</text><text fill='#000000' font-family='sans-serif' font-size='11' font-weight='bold' lengthAdjust='spacing' textLength='163.8936' x='368.8999' y='356.2969'>[matched and script present]</text><g class='message' data-participant-1='RuleContext' data-participant-2='Script'><polygon fill='#181818' points='701.7637,378.2832,711.7637,382.2832,701.7637,386.2832,705.7637,382.2832' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='395.355' x2='707.7637' y1='382.2832' y2='382.2832'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='146.9419' x='402.355' y='377.541'>run(pcontext, rcontext)</text></g><g class='message' data-participant-1='Script' data-participant-2='RuleContext'><polygon fill='#181818' points='406.355,407.5938,396.355,411.5938,406.355,415.5938,402.355,411.5938' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;' x1='400.355' x2='712.7637' y1='411.5938' y2='411.5938'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='50.4004' x='412.355' y='406.8516'>boolean</text></g><path d='M65.644,433.5938 L127.7827,433.5938 L127.7827,440.9043 L117.7827,450.9043 L65.644,450.9043 L65.644,433.5938' fill='#EEEEEE' style='stroke:#000000;stroke-width:1.5;'/><rect fill='none' height='120.2422' style='stroke:#000000;stroke-width:1.5;' width='531.7607' x='65.644' y='433.5938'/><text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacing' textLength='17.1387' x='80.644' y='447.1621'>alt</text><text fill='#000000' font-family='sans-serif' font-size='11' font-weight='bold' lengthAdjust='spacing' textLength='138.3594' x='142.7827' y='446.2285'>[match (and script true)]</text><g class='message' data-participant-1='RuleContext' data-participant-2='RuleContext'><line style='stroke:#181818;stroke-width:1;' x1='395.355' x2='437.355' y1='472.2148' y2='472.2148'/><line style='stroke:#181818;stroke-width:1;' x1='437.355' x2='437.355' y1='472.2148' y2='485.2148'/><line style='stroke:#181818;stroke-width:1;' x1='396.355' x2='437.355' y1='485.2148' y2='485.2148'/><polygon fill='#181818' points='406.355,481.2148,396.355,485.2148,406.355,489.2148,402.355,485.2148' style='stroke:#181818;stroke-width:1;'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='173.0498' x='402.355' y='467.4727'>set decision (ALLOW/DENY)</text></g><path d='M75.644,500.2148 L142.8291,500.2148 L142.8291,507.5254 L132.8291,517.5254 L75.644,517.5254 L75.644,500.2148' fill='#EEEEEE' style='stroke:#000000;stroke-width:1.5;'/><rect fill='none' height='46.6211' style='stroke:#000000;stroke-width:1.5;' width='413.3047' x='75.644' y='500.2148'/><text fill='#000000' font-family='sans-serif' font-size='13' font-weight='bold' lengthAdjust='spacing' textLength='22.1851' x='90.644' y='513.7832'>opt</text><text fill='#000000' font-family='sans-serif' font-size='11' font-weight='bold' lengthAdjust='spacing' textLength='106.2725' x='157.8291' y='512.8496'>[finalRule == true]</text><g class='message' data-participant-1='RuleContext' data-participant-2='SecurityFilter'><polygon fill='#181818' points='147.5889,534.8359,137.5889,538.8359,147.5889,542.8359,143.5889,538.8359' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;' x1='141.5889' x2='384.355' y1='538.8359' y2='538.8359'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='96.5986' x='153.5889' y='534.0938'>stop evaluation</text></g><g class='message' data-participant-1='RuleContext' data-participant-2='SecurityFilter'><polygon fill='#181818' points='147.5889,585.1465,137.5889,589.1465,147.5889,593.1465,143.5889,589.1465' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;stroke-dasharray:2.0,2.0;' x1='141.5889' x2='389.355' y1='589.1465' y2='589.1465'/><text fill='#000000' font-family='sans-serif' font-size='13' lengthAdjust='spacing' textLength='62.9116' x='153.5889' y='584.4043'>finalEffect</text></g></g></svg>