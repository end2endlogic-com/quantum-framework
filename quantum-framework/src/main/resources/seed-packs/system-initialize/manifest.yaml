seedPack: system-initialize
version: 1.0.0

# Apply globally; idempotency is enforced per-realm by the registry and natural keys
scope:
  type: GLOBAL

datasets:
  # Functional Domains (minimal starter set). Upsert by refName.
  - collection: functionalDomain
    modelClass: com.e2eq.framework.model.security.FunctionalDomain
    naturalKey: [ "refName" ]
    upsert: true
    file: functional-domains.jsonl
    transforms:
      - type: tenantSubstitution

  # Full security model functional domains (ported from securityModel.yaml)
  - collection: functionalDomain
    modelClass: com.e2eq.framework.model.security.FunctionalDomain
    naturalKey: [ "refName" ]
    upsert: true
    file: functional-domains-all.jsonl
    transforms:
      - type: tenantSubstitution

  # System organization (refName unique). If your environment uses a different refName,
  # adjust the JSONL accordingly.
  - collection: organization
    modelClass: com.e2eq.framework.model.security.Organization
    naturalKey: [ "refName" ]
    upsert: true
    file: organization.jsonl
    transforms:
      - type: tenantSubstitution

  # System account associated to organization (refName unique)
  - collection: account
    modelClass: com.e2eq.framework.model.security.Account
    naturalKey: [ "refName" ]
    upsert: true
    file: account.jsonl
    transforms:
      - type: tenantSubstitution

  # Counters (e.g., accountNumber). Upsert by refName
  - collection: counter
    modelClass: com.e2eq.framework.model.persistent.base.Counter
    naturalKey: [ "refName" ]
    upsert: true
    file: counters.jsonl
    transforms:
      - type: tenantSubstitution

  # Default user policy equivalent to InitializeDatabase.createInitialRules()
  - collection: policy
    modelClass: com.e2eq.framework.model.security.Policy
    naturalKey: [ "refName" ]
    upsert: true
    file: policies-default-user.jsonl
    transforms:
      - type: tenantSubstitution

  # System user profile (without enforcing credential link to avoid hashing concerns)
  - collection: userProfile
    modelClass: com.e2eq.framework.model.security.UserProfile
    naturalKey: [ "userId" ]
    upsert: true
    file: system-userProfile.jsonl
    transforms:
      - type: tenantSubstitution
