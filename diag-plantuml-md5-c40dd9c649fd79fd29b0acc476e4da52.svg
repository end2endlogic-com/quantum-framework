<svg contentStyleType='text/css' data-diagram-type='ACTIVITY' height='470px' preserveAspectRatio='none' style='width:916px;height:470px;background:#FFFFFF;' version='1.1' viewBox='0 0 916 470' width='916px' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns='http://www.w3.org/2000/svg' zoomAndPan='magnify'><defs/><g><ellipse cx='473.394' cy='20' fill='#222222' rx='10' ry='10' style='stroke:#222222;stroke-width:1;'/><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='109.291' x='418.7485' y='50'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='89.291' x='428.7485' y='71.6016'>Request arrives</text><polygon fill='#F1F1F1' points='390.6201,104.1328,556.168,104.1328,568.168,116.1328,556.168,128.1328,390.6201,128.1328,378.6201,116.1328,390.6201,104.1328' style='stroke:#181818;stroke-width:0.5;'/><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='165.5479' x='390.6201' y='120.29'>Impersonation header present?</text><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='17.4829' x='361.1372' y='113.8125'>yes</text><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='13.5835' x='568.168' y='113.8125'>no</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='249.5703' x='147.521' y='138.1328'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='229.5703' x='157.521' y='159.7344'>Validate caller's impersonateFilterScript</text><polygon fill='#F1F1F1' points='260.1997,192.2656,284.4126,192.2656,296.4126,204.2656,284.4126,216.2656,260.1997,216.2656,248.1997,204.2656,260.1997,192.2656' style='stroke:#181818;stroke-width:0.5;'/><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='24.2129' x='260.1997' y='208.4229'>pass</text><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='17.4829' x='230.7168' y='201.9453'>yes</text><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='13.5835' x='296.4126' y='201.9453'>no</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='293.0586' x='24.8809' y='226.2656'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='273.0586' x='34.8809' y='247.8672'>Build PrincipalContext from impersonated user</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='320.8203' x='11' y='295.3984'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='300.8203' x='21' y='317'>Effective realm = impersonated user's defaultRealm</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='42.7637' x='351.8203' y='226.2656'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='22.7637' x='361.8203' y='247.8672'>403</text><ellipse cx='373.2021' cy='306.3984' fill='none' rx='11' ry='11' style='stroke:#222222;stroke-width:1;'/><ellipse cx='373.2021' cy='306.3984' fill='#222222' rx='6' ry='6' style='stroke:#222222;stroke-width:1;'/><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='215.2988' x='566.8325' y='138.1328'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='195.2988' x='576.8325' y='159.7344'>Build PrincipalContext from caller</text><polygon fill='#F1F1F1' points='549.0078,192.2656,799.9561,192.2656,811.9561,204.2656,799.9561,216.2656,549.0078,216.2656,537.0078,204.2656,549.0078,192.2656' style='stroke:#181818;stroke-width:0.5;'/><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='250.9482' x='549.0078' y='208.4229'>X-Realm provided and allowed by realmRegEx?</text><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='17.4829' x='519.5249' y='201.9453'>yes</text><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='13.5835' x='811.9561' y='201.9453'>no</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='184.8477' x='434.584' y='226.2656'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='164.8477' x='444.584' y='247.8672'>Set defaultRealm = X-Realm</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='166.2559' x='738.8281' y='226.2656'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='146.2559' x='748.8281' y='247.8672'>Use caller's default realm</text><polygon fill='#F1F1F1' points='674.4819,266.3984,686.4819,278.3984,674.4819,290.3984,662.4819,278.3984,674.4819,266.3984' style='stroke:#181818;stroke-width:0.5;'/><polygon fill='#F1F1F1' points='473.394,339.5313,485.394,351.5313,473.394,363.5313,461.394,351.5313,473.394,339.5313' style='stroke:#181818;stroke-width:0.5;'/><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='171.5879' x='387.6001' y='383.5313'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='151.5879' x='397.6001' y='405.1328'>Proceed to rule evaluation</text><ellipse cx='473.394' cy='448.6641' fill='none' rx='11' ry='11' style='stroke:#222222;stroke-width:1;'/><ellipse cx='473.394' cy='448.6641' fill='#222222' rx='6' ry='6' style='stroke:#222222;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='473.394' x2='473.394' y1='30' y2='50'/><polygon fill='#181818' points='469.394,40,473.394,50,477.394,40,473.394,44' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='171.4102' x2='171.4102' y1='260.3984' y2='295.3984'/><polygon fill='#181818' points='167.4102,285.3984,171.4102,295.3984,175.4102,285.3984,171.4102,289.3984' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='373.2021' x2='373.2021' y1='260.3984' y2='295.3984'/><polygon fill='#181818' points='369.2021,285.3984,373.2021,295.3984,377.2021,285.3984,373.2021,289.3984' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='248.1997' x2='171.4102' y1='204.2656' y2='204.2656'/><line style='stroke:#181818;stroke-width:1;' x1='171.4102' x2='171.4102' y1='204.2656' y2='226.2656'/><polygon fill='#181818' points='167.4102,216.2656,171.4102,226.2656,175.4102,216.2656,171.4102,220.2656' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='296.4126' x2='373.2021' y1='204.2656' y2='204.2656'/><line style='stroke:#181818;stroke-width:1;' x1='373.2021' x2='373.2021' y1='204.2656' y2='226.2656'/><polygon fill='#181818' points='369.2021,216.2656,373.2021,226.2656,377.2021,216.2656,373.2021,220.2656' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='171.4102' x2='171.4102' y1='329.5313' y2='351.5313'/><line style='stroke:#181818;stroke-width:1;' x1='171.4102' x2='461.394' y1='351.5313' y2='351.5313'/><polygon fill='#181818' points='451.394,347.5313,461.394,351.5313,451.394,355.5313,455.394,351.5313' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='272.3062' x2='272.3062' y1='172.2656' y2='192.2656'/><polygon fill='#181818' points='268.3062,182.2656,272.3062,192.2656,276.3062,182.2656,272.3062,186.2656' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='537.0078' x2='527.0078' y1='204.2656' y2='204.2656'/><line style='stroke:#181818;stroke-width:1;' x1='527.0078' x2='527.0078' y1='204.2656' y2='226.2656'/><polygon fill='#181818' points='523.0078,216.2656,527.0078,226.2656,531.0078,216.2656,527.0078,220.2656' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='811.9561' x2='821.9561' y1='204.2656' y2='204.2656'/><line style='stroke:#181818;stroke-width:1;' x1='821.9561' x2='821.9561' y1='204.2656' y2='226.2656'/><polygon fill='#181818' points='817.9561,216.2656,821.9561,226.2656,825.9561,216.2656,821.9561,220.2656' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='527.0078' x2='527.0078' y1='260.3984' y2='278.3984'/><line style='stroke:#181818;stroke-width:1;' x1='527.0078' x2='662.4819' y1='278.3984' y2='278.3984'/><polygon fill='#181818' points='652.4819,274.3984,662.4819,278.3984,652.4819,282.3984,656.4819,278.3984' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='821.9561' x2='821.9561' y1='260.3984' y2='278.3984'/><line style='stroke:#181818;stroke-width:1;' x1='821.9561' x2='686.4819' y1='278.3984' y2='278.3984'/><polygon fill='#181818' points='696.4819,274.3984,686.4819,278.3984,696.4819,282.3984,692.4819,278.3984' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='674.4819' x2='674.4819' y1='172.2656' y2='192.2656'/><polygon fill='#181818' points='670.4819,182.2656,674.4819,192.2656,678.4819,182.2656,674.4819,186.2656' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='378.6201' x2='272.3062' y1='116.1328' y2='116.1328'/><line style='stroke:#181818;stroke-width:1;' x1='272.3062' x2='272.3062' y1='116.1328' y2='138.1328'/><polygon fill='#181818' points='268.3062,128.1328,272.3062,138.1328,276.3062,128.1328,272.3062,132.1328' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='568.168' x2='674.4819' y1='116.1328' y2='116.1328'/><line style='stroke:#181818;stroke-width:1;' x1='674.4819' x2='674.4819' y1='116.1328' y2='138.1328'/><polygon fill='#181818' points='670.4819,128.1328,674.4819,138.1328,678.4819,128.1328,674.4819,132.1328' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='674.4819' x2='674.4819' y1='290.3984' y2='351.5313'/><line style='stroke:#181818;stroke-width:1;' x1='674.4819' x2='485.394' y1='351.5313' y2='351.5313'/><polygon fill='#181818' points='495.394,347.5313,485.394,351.5313,495.394,355.5313,491.394,351.5313' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='473.394' x2='473.394' y1='84.1328' y2='104.1328'/><polygon fill='#181818' points='469.394,94.1328,473.394,104.1328,477.394,94.1328,473.394,98.1328' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='473.394' x2='473.394' y1='363.5313' y2='383.5313'/><polygon fill='#181818' points='469.394,373.5313,473.394,383.5313,477.394,373.5313,473.394,377.5313' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='473.394' x2='473.394' y1='417.6641' y2='437.6641'/><polygon fill='#181818' points='469.394,427.6641,473.394,437.6641,477.394,427.6641,473.394,431.6641' style='stroke:#181818;stroke-width:1;'/></g></svg>