<svg contentStyleType='text/css' data-diagram-type='ACTIVITY' height='535px' preserveAspectRatio='none' style='width:1085px;height:535px;background:#FFFFFF;' version='1.1' viewBox='0 0 1085 535' width='1085px' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns='http://www.w3.org/2000/svg' zoomAndPan='magnify'><defs/><g><ellipse cx='520.1919' cy='20' fill='#222222' rx='10' ry='10' style='stroke:#222222;stroke-width:1;'/><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='109.291' x='465.5464' y='50'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='89.291' x='475.5464' y='71.6016'>Request arrives</text><polygon fill='#F1F1F1' points='437.418,104.1328,602.9658,104.1328,614.9658,116.1328,602.9658,128.1328,437.418,128.1328,425.418,116.1328,437.418,104.1328' style='stroke:#181818;stroke-width:0.5;'/><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='165.5479' x='437.418' y='120.29'>Impersonation header present?</text><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='17.4829' x='407.9351' y='113.8125'>yes</text><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='13.5835' x='614.9658' y='113.8125'>no</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='249.5703' x='148.3647' y='138.1328'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='229.5703' x='158.3647' y='159.7344'>Validate caller's impersonateFilterScript</text><polygon fill='#F1F1F1' points='261.0435,192.2656,285.2563,192.2656,297.2563,204.2656,285.2563,216.2656,261.0435,216.2656,249.0435,204.2656,261.0435,192.2656' style='stroke:#181818;stroke-width:0.5;'/><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='24.2129' x='261.0435' y='208.4229'>pass</text><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='17.4829' x='231.5605' y='201.9453'>yes</text><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='13.5835' x='297.2563' y='201.9453'>no</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='293.0586' x='25.4434' y='226.2656'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='273.0586' x='35.4434' y='247.8672'>Build PrincipalContext from impersonated user</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='320.8203' x='11.5625' y='280.3984'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='300.8203' x='21.5625' y='302'>Effective realm = impersonated user's defaultRealm</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='321.9453' x='11' y='334.5313'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='301.9453' x='21' y='356.1328'>DataDomain = impersonated user's DomainContext</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='42.7637' x='352.9453' y='226.2656'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='22.7637' x='362.9453' y='247.8672'>403</text><ellipse cx='374.3271' cy='291.3984' fill='none' rx='11' ry='11' style='stroke:#222222;stroke-width:1;'/><ellipse cx='374.3271' cy='291.3984' fill='#222222' rx='6' ry='6' style='stroke:#222222;stroke-width:1;'/><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='215.2988' x='675.9563' y='138.1328'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='195.2988' x='685.9563' y='159.7344'>Build PrincipalContext from caller</text><polygon fill='#F1F1F1' points='658.1316,192.2656,909.0798,192.2656,921.0798,204.2656,909.0798,216.2656,658.1316,216.2656,646.1316,204.2656,658.1316,192.2656' style='stroke:#181818;stroke-width:0.5;'/><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='250.9482' x='658.1316' y='208.4229'>X-Realm provided and allowed by realmRegEx?</text><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='17.4829' x='628.6487' y='201.9453'>yes</text><text fill='#000000' font-family='sans-serif' font-size='11' lengthAdjust='spacing' textLength='13.5835' x='921.0798' y='201.9453'>no</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='184.8477' x='522.3948' y='226.2656'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='164.8477' x='532.3948' y='247.8672'>Set defaultRealm = X-Realm</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='244.9121' x='492.3625' y='280.3984'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='224.9121' x='502.3625' y='302'>Lookup target Realm's DomainContext</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='390.9629' x='419.3372' y='334.5313'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='370.9629' x='429.3372' y='356.1328'>DataDomain = target realm's DomainContext (ownerId = caller)</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='166.2559' x='869.2649' y='226.2656'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='146.2559' x='879.2649' y='247.8672'>Use caller's default realm</text><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='244.1855' x='830.3' y='280.3984'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='224.1855' x='840.3' y='302'>DataDomain = caller's DomainContext</text><polygon fill='#F1F1F1' points='783.6057,374.6641,795.6057,386.6641,783.6057,398.6641,771.6057,386.6641,783.6057,374.6641' style='stroke:#181818;stroke-width:0.5;'/><polygon fill='#F1F1F1' points='520.1919,404.6641,532.1919,416.6641,520.1919,428.6641,508.1919,416.6641,520.1919,404.6641' style='stroke:#181818;stroke-width:0.5;'/><rect fill='#F1F1F1' height='34.1328' rx='12.5' ry='12.5' style='stroke:#181818;stroke-width:0.5;' width='171.5879' x='434.3979' y='448.6641'/><text fill='#000000' font-family='sans-serif' font-size='12' lengthAdjust='spacing' textLength='151.5879' x='444.3979' y='470.2656'>Proceed to rule evaluation</text><ellipse cx='520.1919' cy='513.7969' fill='none' rx='11' ry='11' style='stroke:#222222;stroke-width:1;'/><ellipse cx='520.1919' cy='513.7969' fill='#222222' rx='6' ry='6' style='stroke:#222222;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='520.1919' x2='520.1919' y1='30' y2='50'/><polygon fill='#181818' points='516.1919,40,520.1919,50,524.1919,40,520.1919,44' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='171.9727' x2='171.9727' y1='260.3984' y2='280.3984'/><polygon fill='#181818' points='167.9727,270.3984,171.9727,280.3984,175.9727,270.3984,171.9727,274.3984' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='171.9727' x2='171.9727' y1='314.5313' y2='334.5313'/><polygon fill='#181818' points='167.9727,324.5313,171.9727,334.5313,175.9727,324.5313,171.9727,328.5313' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='374.3271' x2='374.3271' y1='260.3984' y2='280.3984'/><polygon fill='#181818' points='370.3271,270.3984,374.3271,280.3984,378.3271,270.3984,374.3271,274.3984' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='249.0435' x2='171.9727' y1='204.2656' y2='204.2656'/><line style='stroke:#181818;stroke-width:1;' x1='171.9727' x2='171.9727' y1='204.2656' y2='226.2656'/><polygon fill='#181818' points='167.9727,216.2656,171.9727,226.2656,175.9727,216.2656,171.9727,220.2656' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='297.2563' x2='374.3271' y1='204.2656' y2='204.2656'/><line style='stroke:#181818;stroke-width:1;' x1='374.3271' x2='374.3271' y1='204.2656' y2='226.2656'/><polygon fill='#181818' points='370.3271,216.2656,374.3271,226.2656,378.3271,216.2656,374.3271,220.2656' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='171.9727' x2='171.9727' y1='368.6641' y2='416.6641'/><line style='stroke:#181818;stroke-width:1;' x1='171.9727' x2='508.1919' y1='416.6641' y2='416.6641'/><polygon fill='#181818' points='498.1919,412.6641,508.1919,416.6641,498.1919,420.6641,502.1919,416.6641' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='273.1499' x2='273.1499' y1='172.2656' y2='192.2656'/><polygon fill='#181818' points='269.1499,182.2656,273.1499,192.2656,277.1499,182.2656,273.1499,186.2656' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='614.8186' x2='614.8186' y1='260.3984' y2='280.3984'/><polygon fill='#181818' points='610.8186,270.3984,614.8186,280.3984,618.8186,270.3984,614.8186,274.3984' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='614.8186' x2='614.8186' y1='314.5313' y2='334.5313'/><polygon fill='#181818' points='610.8186,324.5313,614.8186,334.5313,618.8186,324.5313,614.8186,328.5313' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='952.3928' x2='952.3928' y1='260.3984' y2='280.3984'/><polygon fill='#181818' points='948.3928,270.3984,952.3928,280.3984,956.3928,270.3984,952.3928,274.3984' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='646.1316' x2='614.8186' y1='204.2656' y2='204.2656'/><line style='stroke:#181818;stroke-width:1;' x1='614.8186' x2='614.8186' y1='204.2656' y2='226.2656'/><polygon fill='#181818' points='610.8186,216.2656,614.8186,226.2656,618.8186,216.2656,614.8186,220.2656' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='921.0798' x2='952.3928' y1='204.2656' y2='204.2656'/><line style='stroke:#181818;stroke-width:1;' x1='952.3928' x2='952.3928' y1='204.2656' y2='226.2656'/><polygon fill='#181818' points='948.3928,216.2656,952.3928,226.2656,956.3928,216.2656,952.3928,220.2656' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='614.8186' x2='614.8186' y1='368.6641' y2='386.6641'/><line style='stroke:#181818;stroke-width:1;' x1='614.8186' x2='771.6057' y1='386.6641' y2='386.6641'/><polygon fill='#181818' points='761.6057,382.6641,771.6057,386.6641,761.6057,390.6641,765.6057,386.6641' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='952.3928' x2='952.3928' y1='314.5313' y2='386.6641'/><line style='stroke:#181818;stroke-width:1;' x1='952.3928' x2='795.6057' y1='386.6641' y2='386.6641'/><polygon fill='#181818' points='805.6057,382.6641,795.6057,386.6641,805.6057,390.6641,801.6057,386.6641' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='783.6057' x2='783.6057' y1='172.2656' y2='192.2656'/><polygon fill='#181818' points='779.6057,182.2656,783.6057,192.2656,787.6057,182.2656,783.6057,186.2656' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='425.418' x2='273.1499' y1='116.1328' y2='116.1328'/><line style='stroke:#181818;stroke-width:1;' x1='273.1499' x2='273.1499' y1='116.1328' y2='138.1328'/><polygon fill='#181818' points='269.1499,128.1328,273.1499,138.1328,277.1499,128.1328,273.1499,132.1328' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='614.9658' x2='783.6057' y1='116.1328' y2='116.1328'/><line style='stroke:#181818;stroke-width:1;' x1='783.6057' x2='783.6057' y1='116.1328' y2='138.1328'/><polygon fill='#181818' points='779.6057,128.1328,783.6057,138.1328,787.6057,128.1328,783.6057,132.1328' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='783.6057' x2='783.6057' y1='398.6641' y2='416.6641'/><line style='stroke:#181818;stroke-width:1;' x1='783.6057' x2='532.1919' y1='416.6641' y2='416.6641'/><polygon fill='#181818' points='542.1919,412.6641,532.1919,416.6641,542.1919,420.6641,538.1919,416.6641' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='520.1919' x2='520.1919' y1='84.1328' y2='104.1328'/><polygon fill='#181818' points='516.1919,94.1328,520.1919,104.1328,524.1919,94.1328,520.1919,98.1328' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='520.1919' x2='520.1919' y1='428.6641' y2='448.6641'/><polygon fill='#181818' points='516.1919,438.6641,520.1919,448.6641,524.1919,438.6641,520.1919,442.6641' style='stroke:#181818;stroke-width:1;'/><line style='stroke:#181818;stroke-width:1;' x1='520.1919' x2='520.1919' y1='482.7969' y2='502.7969'/><polygon fill='#181818' points='516.1919,492.7969,520.1919,502.7969,524.1919,492.7969,520.1919,496.7969' style='stroke:#181818;stroke-width:1;'/></g></svg>