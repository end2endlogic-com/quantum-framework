<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Permissions: Rule Bases, SecurityURLHeaders, and SecurityURLBody</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body id="permissions" class="book toc2 toc-left">
<div id="header">
<h1>Permissions: Rule Bases, SecurityURLHeaders, and SecurityURLBody</h1>
<div class="details">
<span id="revnumber">version 1.2.2-SNAPSHOT,</span>
<span id="revdate">2025-09-14T13:15:12Z</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction_layered_enforcement_overview">1. Introduction: Layered Enforcement Overview</a></li>
<li><a href="#_key_concepts">2. Key Concepts</a></li>
<li><a href="#_rule_structure_illustrative">3. Rule Structure (Illustrative)</a></li>
<li><a href="#_matching_algorithm">4. Matching Algorithm</a></li>
<li><a href="#_priorities">5. Priorities</a></li>
<li><a href="#_grant_based_vs_deny_based_rule_sets">6. Grant-based vs Deny-based Rule Sets</a></li>
<li><a href="#_feature_flags_variants_and_target_rules">7. Feature Flags, Variants, and Target Rules</a></li>
<li><a href="#_multiple_matching_rulebases">8. Multiple Matching RuleBases</a></li>
<li><a href="#_identity_and_role_matching">9. Identity and Role Matching</a>
<ul class="sectlevel2">
<li><a href="#_how_roles_are_defined_for_an_identity_role_sources_and_resolution">9.1. How roles are defined for an identity (role sources and resolution)</a></li>
</ul>
</li>
<li><a href="#_example_scenarios">10. Example Scenarios</a></li>
<li><a href="#_operational_tips">11. Operational Tips</a></li>
<li><a href="#_how_uiactions_and_defaultuiactions_are_calculated">12. How UIActions and DefaultUIActions are calculated</a></li>
<li><a href="#_how_this_integrates_end_to_end">13. How This Integrates End-to-End</a></li>
<li><a href="#_administering_policies_via_rest_policyresource">14. Administering Policies via REST (PolicyResource)</a>
<ul class="sectlevel2">
<li><a href="#_model_shape_policy">14.1. Model shape (Policy)</a></li>
<li><a href="#_endpoints">14.2. Endpoints</a></li>
<li><a href="#_examples">14.3. Examples</a></li>
<li><a href="#_how_changes_affect_rule_bases_and_enforcement">14.4. How changes affect rule bases and enforcement</a></li>
</ul>
</li>
<li><a href="#_realm_override_x_realm_and_impersonation_x_impersonate">15. Realm override (X-Realm) and Impersonation (X-Impersonate)</a>
<ul class="sectlevel2">
<li><a href="#_what_they_do_at_a_glance">15.1. What they do (at a glance)</a></li>
<li><a href="#_how_the_headers_integrate_with_permission_evaluation">15.2. How the headers integrate with permission evaluation</a></li>
<li><a href="#_required_credential_configuration_credentialuseridpassword">15.3. Required credential configuration (CredentialUserIdPassword)</a></li>
<li><a href="#_end_to_end_behavior_from_securityfilter_reference">15.4. End-to-end behavior from SecurityFilter (reference)</a></li>
<li><a href="#_practical_differences_and_use_cases">15.5. Practical differences and use cases</a></li>
<li><a href="#_examples_2">15.6. Examples</a></li>
</ul>
</li>
<li><a href="#_data_domain_assignment_on_create_domaincontext_and_datadomainpolicy">16. Data domain assignment on create: DomainContext and DataDomainPolicy</a>
<ul class="sectlevel2">
<li><a href="#_the_problem_this_solves_and_why_it_matters">16.1. The problem this solves (and why it matters)</a></li>
<li><a href="#_key_concepts_recap_domaincontext_and_datadomain">16.2. Key concepts recap: DomainContext and DataDomain</a></li>
<li><a href="#_the_default_policy_do_nothing_and_it_works">16.3. The default policy (do nothing and it works)</a></li>
<li><a href="#_policy_scopes_principalattached_vs_global">16.4. Policy scopes: principal‑attached vs. global</a></li>
<li><a href="#_the_policy_map_and_matching">16.5. The policy map and matching</a></li>
<li><a href="#_how_the_resolver_works">16.6. How the resolver works</a></li>
<li><a href="#_when_would_you_want_a_nonglobal_policy">16.7. When would you want a non‑global policy?</a></li>
<li><a href="#_relation_to_tenancy_models">16.8. Relation to tenancy models</a></li>
<li><a href="#_authoring_tips">16.9. Authoring tips</a></li>
<li><a href="#_api_pointers">16.10. API pointers</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section explains how Quantum evaluates permissions for REST requests using rule bases that match on URL, HTTP method, headers, and request body content. It also covers how identities and roles (as found on userProfile or credentialUserIdPassword) are matched, how priority works, and how multiple matching rule bases are evaluated.</p>
</div>
<div class="paragraph">
<p>Note: The terms SecurityURLHeaders and SecurityURLBody in this document describe the matching dimensions for rules. Implementations may vary, but the semantics below are stable for authoring and reasoning about permissions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_layered_enforcement_overview">1. Introduction: Layered Enforcement Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quantum evaluates "can this identity do X?" through three complementary layers. Understanding them in order helps you pick the right tool for the job and combine them safely:</p>
</div>
<div class="paragraph">
<p>1) REST API annotations (top layer, code-level)
- What: JAX-RS/Jakarta Security annotations on resource methods, e.g., @RolesAllowed("ADMIN"), @PermitAll, @DenyAll, @Authenticated.
- Purpose: Coarse-grained, immediate gates right at the endpoint. Ideal for baseline protections (e.g., only ADMIN may call /admin/**) and for non-dynamic constraints that rarely change.
- Pros: Simple, fast, visible in code reviews.
- Cons: Hard-coded; changing access requires a code change, build, and deploy. No data-aware scoping (e.g., cannot express tenant/domain filters).</p>
</div>
<div class="paragraph">
<p>2) Feature flags (exposure and variants)
- What: Turn capabilities on/off per environment or cohort and select variants (A/B, multivariate). See "Feature Flags, Variants, and Target Rules" below.
- Purpose: Control who even sees or can reach a capability during rollout (by tenant, role, geography, plan), independently of authorization. Flags answer "is the feature ON and which variant?"; they do not by themselves prove the caller is authorized.
- Pros: Reversible, environment-aware, safe rollout and experimentation.
- Cons: Not a substitute for authorization; must be paired with roles/permission rules for enforcement.</p>
</div>
<div class="paragraph">
<p>3) Permission Rules with DataDomain filtering (fine-grained, dynamic)
- What: Declarative rule bases that match URL, method, SecurityURLHeaders, and SecurityURLBody, and decide ALLOW/DENY. ALLOWs can contribute DataDomain constraints applied by repositories. See sections "Key Concepts", "Matching Algorithm", and examples below.
- Purpose: Express least-privilege, data-aware policies that evolve without code changes (data-driven authoring).
- Pros: Dynamic, auditable, supports role checks plus attribute predicates and domain scoping.
- Cons: Requires governance of rulebases and careful priority management.</p>
</div>
<div class="paragraph">
<p>How roles, Functional Areas, and Functional Domains fit in
- Roles: Used by both layers (1) and (3). Annotations directly reference roles; rules can require rolesAny/rolesAll. Effective roles are resolved by merging IdP roles with roles on the user record; see "How roles are defined for an identity" below.
- Functional Area/Domain: Provide the vocabulary for rules and headers. Services set x-functional-area and x-functional-domain (or models expose bmFunctionalArea()/bmFunctionalDomain()); rules can match on these to target policies to business capabilities rather than raw URLs.
- DataDomain: When rules ALLOW an action, they can attach data-scope filters (tenant/org/owner) so downstream reads/writes are constrained to the caller’s domain.</p>
</div>
<div class="paragraph">
<p>Choosing the right approach
- Use annotations for stable, coarse gates you want visible in code (e.g., admin-only endpoints, health endpoints with @PermitAll).
- Use feature flags to manage rollout/exposure and variants across environments and cohorts.
- Use permission rules to encode fine-grained, data-aware authorization and to evolve policy without redeploying.</p>
</div>
<div class="paragraph">
<p>Compare and contrast
- Annotation-based controls are compile-time and hard-code policy into the service; changing them requires code changes.
- Permission Rules and the Rule Language are data-driven and user-changeable (with proper governance), enabling rapid, auditable policy changes and DataDomain scoping.
- In practice: apply annotations as the first gate, evaluate feature flags to determine exposure/variant, then evaluate permission rules to decide ALLOW/DENY and attach scopes. This layered approach yields both safety and agility.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_key_concepts">2. Key Concepts</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Identity: The authenticated principal, typically originating from JWT or another provider. It includes:</p>
</li>
<li>
<p>userId (or credentialUserIdPassword username)</p>
</li>
<li>
<p>roles (authorities/groups)</p>
</li>
<li>
<p>tenantId, orgRefName, optional realm, and other claims that contribute to DomainContext</p>
</li>
<li>
<p>userProfile: A domain representation of the user that aggregates identity, roles, and policy decorations (feature flags, plans, expiration, etc.).</p>
</li>
<li>
<p>Rule Base (Permission Rule): A declarative rule with matching criteria and an effect (ALLOW or DENY). Criteria may include:</p>
</li>
<li>
<p>HTTP method and URL pattern</p>
</li>
<li>
<p>SecurityURLHeaders: predicates over selected HTTP headers (e.g., x-functional-area, x-functional-domain, x-tenant-id)</p>
</li>
<li>
<p>SecurityURLBody: predicates over request body fields (JSON paths) or query parameters</p>
</li>
<li>
<p>Required roles/attributes on identity or userProfile</p>
</li>
<li>
<p>Functional area/domain/action</p>
</li>
<li>
<p>Priority: integer used to sort rule evaluation</p>
</li>
<li>
<p>Effect: ALLOW or DENY; an ALLOW may also contribute scope filters (e.g., DataDomain constraints) to be applied downstream by repositories.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rule_structure_illustrative">3. Rule Structure (Illustrative)</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">- <span class="string"><span class="content">name: allow-public-reads</span></span>
  <span class="key">priority</span>: <span class="string"><span class="content">100</span></span>
  <span class="key">match</span>:
    <span class="key">method</span>: <span class="string"><span class="content">[GET]</span></span>
    <span class="key">url</span>: <span class="string"><span class="content">/api/catalog/**</span></span>
    <span class="key">headers</span>:
      <span class="key">x-functional-area</span>: <span class="string"><span class="content">[Catalog]</span></span>
    <span class="key">rolesAny</span>: <span class="string"><span class="content">[USER, ADMIN]</span></span>
  <span class="key">effect</span>: <span class="string"><span class="content">ALLOW</span></span>
  <span class="key">filters</span>:
    <span class="comment"># Optional: contribute additional DataDomain filters</span>
    <span class="key">readScope</span>: <span class="string"><span class="content">{ orgRefName: PUBLIC }</span></span>

- <span class="string"><span class="content">name: deny-non-admin-delete</span></span>
  <span class="key">priority</span>: <span class="string"><span class="content">10</span></span>
  <span class="key">match</span>:
    <span class="key">method</span>: <span class="string"><span class="content">[DELETE]</span></span>
    <span class="key">url</span>: <span class="string"><span class="content">/api/**</span></span>
  <span class="key">requireRolesAll</span>: <span class="string"><span class="content">[ADMIN]</span></span>
  <span class="key">effect</span>: <span class="string"><span class="content">ALLOW</span></span>

- <span class="string"><span class="content">name: default-deny</span></span>
  <span class="key">priority</span>: <span class="string"><span class="content">10000</span></span>
  <span class="key">match</span>: <span class="string"><span class="content">{}</span></span>
  <span class="key">effect</span>: <span class="string"><span class="content">DENY</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>headers under match are the SecurityURLHeaders predicates.</p>
</li>
<li>
<p>Body predicates (SecurityURLBody) can be expressed similarly as JSONPath-like constraints:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  <span class="key">body</span>:
    <span class="error">$.dataDomain.tenantId</span>: <span class="error">${identity.tenantId}</span>
    <span class="error">$.action</span>: [<span class="error">CREATE, UPDATE]</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_matching_algorithm">4. Matching Algorithm</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Given a request R and identity I, evaluate a set of rule bases RB as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Candidate selection</p>
<div class="ulist">
<ul>
<li>
<p>From RB, select all rules whose URL pattern and HTTP method match R.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Attribute and header/body checks</p>
<div class="ulist">
<ul>
<li>
<p>For each candidate, check:</p>
</li>
<li>
<p>SecurityURLHeaders: header predicates must all match (case-insensitive header names; values support exact string, regex, or one-of lists depending on rule authoring capability).</p>
</li>
<li>
<p>SecurityURLBody: if present, evaluate body predicates against parsed JSON body (or query params when body is absent). Predicates must all match.</p>
</li>
<li>
<p>Identity/UserProfile: role requirements and attribute requirements must be satisfied.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Priority sort</p>
<div class="ulist">
<ul>
<li>
<p>Sort matching candidates by ascending priority (lower numbers indicate higher precedence). If not specified, default priority is 1000.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Evaluation order and decision</p>
<div class="ulist">
<ul>
<li>
<p>Iterate in sorted order; the first rule that yields a decisive effect (ALLOW or DENY) becomes the decision.</p>
</li>
<li>
<p>If the rule is ALLOW and contributes filters (e.g., DataDomain read/write scope), attach those to the request context for downstream repositories.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Multi-match aggregation (optional advanced mode)</p>
<div class="ulist">
<ul>
<li>
<p>In advanced configurations, if multiple ALLOW rules match at the same priority, their filters may be merged (intersection for restrictive scope, union for permissive scope) according to a configured merge strategy. If not configured, the default is first-match-wins.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Fallback</p>
<div class="ulist">
<ul>
<li>
<p>If no rules match decisively, apply a default policy (typically DENY).</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_priorities">5. Priorities</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Lower integer = higher priority. Example: priority 1 overrides priority 10.</p>
</li>
<li>
<p>Use tight scopes with low priority for critical protections (e.g., denies), and broader ALLOWs with higher numeric priority.</p>
</li>
<li>
<p>Recommended ranges:</p>
</li>
<li>
<p>1–99: global deny rules and emergency blocks</p>
</li>
<li>
<p>100–499: domain/area-specific critical rules</p>
</li>
<li>
<p>500–999: standard ALLOW policies</p>
</li>
<li>
<p>1000+: defaults and catch-alls</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_grant_based_vs_deny_based_rule_sets">6. Grant-based vs Deny-based Rule Sets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Grant-based rule sets start with a default decision of DENY and then incrementally add ALLOW scenarios through explicit rules. This model is fail‑safe by default: any URL, action, or functional area that does not have a matching ALLOW rule remains inaccessible. As new endpoints or capabilities are added to the system, users will not gain access until an explicit ALLOW is authored. This is the recommended posture for security‑sensitive systems and multi‑tenant platforms.</p>
</div>
<div class="paragraph">
<p>Deny-based rule sets start with a default decision of ALLOW and then add DENY scenarios to carve away disallowed cases. In this model, new functionality is exposed by default unless a DENY is added. While convenient during rapid prototyping, this posture risks accidental exposure as the surface area grows.</p>
</div>
<div class="paragraph">
<p>Practical implications:
- Change management: Grant-based requires adding ALLOWs when shipping new features; Deny-based requires remembering to add new DENYs.
- Auditability: Grant-based policies make it easy to enumerate what is permitted; Deny-based requires proving the absence of permissive gaps.
- Safety: In merge conflicts or partial deployments, Grant-based tends to fail closed (DENY), which is usually safer.</p>
</div>
<div class="paragraph">
<p>Example defaults:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Grant-based (recommended):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">- <span class="string"><span class="content">name: default-deny</span></span>
  <span class="key">priority</span>: <span class="string"><span class="content">10000</span></span>
  <span class="key">match</span>: <span class="string"><span class="content">{}</span></span>
  <span class="key">effect</span>: <span class="string"><span class="content">DENY</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Deny-based (use with caution):</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">- <span class="string"><span class="content">name: default-allow</span></span>
  <span class="key">priority</span>: <span class="string"><span class="content">10000</span></span>
  <span class="key">match</span>: <span class="string"><span class="content">{}</span></span>
  <span class="key">effect</span>: <span class="string"><span class="content">ALLOW</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tip: Even in a deny-based set, author low‑number DENY rules for critical protections. In most production systems, prefer the grant-based model and layer specific ALLOWs for each capability.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_feature_flags_variants_and_target_rules">7. Feature Flags, Variants, and Target Rules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Feature flags complement permission rules by controlling whether a capability is active for a given principal, cohort, or environment. Permissions answer “may this identity perform this action?”; feature flags answer “is this capability turned on, and which variant applies?” Use them together to achieve safe rollouts and fine‑grained authorization.</p>
</div>
<div class="paragraph">
<p>Model reference: com.e2eq.framework.model.general.FeatureFlag with key fields:
- enabled: master on/off
- type: BOOLEAN or MULTIVARIATE
- variants: list of variant keys for multivariate experiments
- targetRules: cohort targeting rules
- environment: e.g., dev, staging, prod
- jsonConfiguration: arbitrary configuration for the feature (e.g., rollout %, UI copy, limits)</p>
</div>
<div class="paragraph">
<p>Example: Boolean flag for a new export API with environment‑specific targeting</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">refName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">EXPORT_API</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Enable CSV export endpoint</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">enabled</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">BOOLEAN</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">environment</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">prod</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">targetRules</span><span class="delimiter">&quot;</span></span>: [
    { <span class="key"><span class="delimiter">&quot;</span><span class="content">attribute</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>,     <span class="key"><span class="delimiter">&quot;</span><span class="content">operator</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">equals</span><span class="delimiter">&quot;</span></span>,  <span class="key"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">BETA</span><span class="delimiter">&quot;</span></span>] },
    { <span class="key"><span class="delimiter">&quot;</span><span class="content">attribute</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">tenantId</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">operator</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">in</span><span class="delimiter">&quot;</span></span>,      <span class="key"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">T100</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">T200</span><span class="delimiter">&quot;</span></span>] }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">jsonConfiguration</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">rateLimitPerMin</span><span class="delimiter">&quot;</span></span>: <span class="integer">60</span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example: Multivariate flag to roll out Search v2 to 10% of users and all members of a beta role</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">refName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">SEARCH_V2</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">New search implementation</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">enabled</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">MULTIVARIATE</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">variants</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">control</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">v2</span><span class="delimiter">&quot;</span></span>],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">environment</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">prod</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">targetRules</span><span class="delimiter">&quot;</span></span>: [
    { <span class="key"><span class="delimiter">&quot;</span><span class="content">attribute</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">operator</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">equals</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">BETA</span><span class="delimiter">&quot;</span></span>], <span class="key"><span class="delimiter">&quot;</span><span class="content">variant</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">v2</span><span class="delimiter">&quot;</span></span> },
    { <span class="key"><span class="delimiter">&quot;</span><span class="content">attribute</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">userId</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">operator</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">hashMod</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>], <span class="key"><span class="delimiter">&quot;</span><span class="content">variant</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">v2</span><span class="delimiter">&quot;</span></span> }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">jsonConfiguration</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">defaultVariant</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">control</span><span class="delimiter">&quot;</span></span> }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notes on TargetRules:
- attribute: a property from identity/userProfile (e.g., userId, role, tenantId, location, plan).
- operator: equals, in, contains, startsWith, regex, or domain‑specific operators like hashMod for percentage rollouts.
- values: comparison values; semantics depend on operator.
- variant: when type is MULTIVARIATE, selects which variant applies when the rule matches.</p>
</div>
<div class="paragraph">
<p>How feature flags complement Permission Rule Context:
- The evaluation of a request can enrich the Rule Context (SecurityURLHeaders/Body or userProfile) with resolved feature flags and variants (e.g., userProfile.features["SEARCH_V2"] = "v2").
- Permission rules can then require a feature to be present before ALLOWing an action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">- <span class="string"><span class="content">name: allow-export-when-flag-on</span></span>
  <span class="key">priority</span>: <span class="string"><span class="content">300</span></span>
  <span class="key">match</span>:
    <span class="key">method</span>: <span class="string"><span class="content">[GET]</span></span>
    <span class="key">url</span>: <span class="string"><span class="content">/api/export/**</span></span>
    <span class="key">headers</span>:
      <span class="key">x-functional-area</span>: <span class="string"><span class="content">[Reports]</span></span>
    <span class="comment"># Example predicate that assumes features are surfaced in userProfile</span>
    <span class="key">userProfile.features.EXPORT_API</span>: <span class="string"><span class="content">[true]</span></span>
  <span class="key">rolesAny</span>: <span class="string"><span class="content">[ADMIN, REPORTER]</span></span>
  <span class="key">effect</span>: <span class="string"><span class="content">ALLOW</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, systems may surface feature decisions via headers (e.g., X-Feature-SEARCH_V2: v2) so that SecurityURLHeaders can match directly.</p>
</div>
<div class="paragraph">
<p>Business usage examples for TargetRules and their correlation to Permission Rules:
- Progressive rollout by tenant: TargetRule tenantId in [T100, T200] → Permission adds ALLOW for endpoints guarded by that flag so only those tenants can call them during rollout.
- Role‑based beta access: TargetRule role equals BETA → Permission requires both the BETA feature flag and standard role checks (e.g., USER/ADMIN) to ALLOW sensitive actions.
- Plan/entitlement tiers: TargetRule plan in [Pro, Enterprise] → Permission rules enforce additional data‑domain constraints (e.g., export size limits) while the flag simply turns the feature on for eligible plans.</p>
</div>
<div class="paragraph">
<p>Guidance: Feature Flags vs Permission Rules
- Put into Feature Flags:
  - Gradual, reversible rollouts; A/B or multivariate experiments; UI/behavior switches.
  - Environment gates (dev/staging/prod) and cohort targeting (tenants, beta users, geography).
  - Non‑security configuration values in jsonConfiguration (limits, thresholds, copy) that do not change who is authorized.
- Put into Permission Rules:
  - Durable authorization logic: roles, identities, functional area/domain/action, and DataDomain constraints.
  - Compliance and least‑privilege decisions where fail‑closed behavior is required.
  - Enforcement that remains valid after a feature is fully launched (even when the flag is removed).</p>
</div>
<div class="paragraph">
<p>Recommendation: Use a grant‑based permission posture (default DENY) and let feature flags decide which cohorts even see or can reach new capabilities. Then author explicit ALLOW rules for those capabilities, conditioned on both role and feature presence.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multiple_matching_rulebases">8. Multiple Matching RuleBases</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>First-match-wins (default): after sorting by priority, the first decisive rule determines the result; subsequent matches are ignored.</p>
</li>
<li>
<p>Merge strategy (optional):</p>
</li>
<li>
<p>When enabled and multiple ALLOW rules share the same priority, scopes/filters are merged.</p>
</li>
<li>
<p>Conflicts between ALLOW and DENY at the same priority resolve to DENY unless explicitly configured otherwise (fail-safe).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_identity_and_role_matching">9. Identity and Role Matching</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>RolesAny: request is allowed if identity has at least one of the specified roles.</p>
</li>
<li>
<p>RolesAll: request requires all listed roles.</p>
</li>
<li>
<p>Attribute predicates can compare identity/userProfile attributes (e.g., identity.tenantId == header.x-tenant-id).</p>
</li>
<li>
<p>Time or plan-based conditions: userProfile can embed plan and expiration; rules may check that trials are active or features are enabled.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_how_roles_are_defined_for_an_identity_role_sources_and_resolution">9.1. How roles are defined for an identity (role sources and resolution)</h3>
<div class="paragraph">
<p>Quantum composes the effective roles for a request by merging:
- Roles from the identity provider (JWT/SecurityIdentity)
- Roles configured on the user record (CredentialUserIdPassword.roles)</p>
</div>
<div class="paragraph">
<p>Source details:
- Identity Provider (JWT): roles commonly arrive via standard claims (e.g., groups, roles, or provider-specific fields). Quarkus maps these into SecurityIdentity.getRoles(). In multi-realm setups, the realm in X-Realm can scope lookups but does not alter what the JWT asserts.
- Quantum user record: com.e2eq.framework.model.security.CredentialUserIdPassword has a String[] roles field stored per realm. This can be administered by Quantum to grant platform- or tenant-level roles.</p>
</div>
<div class="paragraph">
<p>Merge semantics (current implementation):
- Union: the effective role set is the union of JWT roles and CredentialUserIdPassword.roles. If either source is empty, the other source defines the set.
- Fallback: when neither source yields roles, the framework defaults to [ANONYMOUS].
- Where implemented: SecurityFilter.determinePrincipalContext builds PrincipalContext with the merged roles.</p>
</div>
<div class="paragraph">
<p>Realm considerations:
- The user record is looked up by subject or userId in the active realm (default or X-Realm). If a realm override is provided, it is validated with CredentialUserIdPassword.realmRegEx.
- Roles stored in a user record are realm-specific; JWT roles are whatever the IdP asserts for the token.</p>
</div>
<div class="paragraph">
<p>Operating models:
- Quantum-managed roles:
  - IdP authenticates the user (subject, username). Authorization is primarily driven by roles stored in CredentialUserIdPassword.roles.
  - Use when you want central, auditable role assignment within Quantum, independent of IdP groups.
- IdP-managed roles:
  - IdP carries authoritative roles/groups in the JWT. Keep CredentialUserIdPassword.roles minimal or empty.
  - Use when enterprises require IdP as the source of truth for access groups.
- Hybrid (recommended in many deployments):
  - Effective roles = JWT roles ∪ CredentialUserIdPassword.roles.
  - Use JWT for enterprise groups (e.g., DEPT_SALES, ORG_ADMIN) and Quantum roles for app-specific grants (e.g., REPORT_EXPORTER, BETA).
  - This avoids IdP churn for application-local concerns while respecting org policies.</p>
</div>
<div class="paragraph">
<p>Examples:
- JWT-only:
  - JWT.groups = [USER, REPORTER]; user record roles = []
  - Effective roles = [USER, REPORTER]
- Quantum-only:
  - JWT.groups = []; user record roles = [USER, ADMIN]
  - Effective roles = [USER, ADMIN]
- Hybrid union:
  - JWT.groups = [USER]; user record roles = [BETA, REPORT_EXPORTER]
  - Effective roles = [USER, BETA, REPORT_EXPORTER]</p>
</div>
<div class="paragraph">
<p>Guidance and best practices:
- Keep role names stable and environment-agnostic; use realms/permissions to scope where needed.
- Avoid overloading roles for feature rollout; use Feature Flags for rollout and variants, and roles for durable authorization.
- When IdP is authoritative, ensure consistent claim mapping so SecurityIdentity.getRoles() contains the expected values; commonly via 'groups' claim in JWT.
- Use grant-based permission rules and require the minimal set of roles (rolesAny/rolesAll) needed for each capability.</p>
</div>
<div class="paragraph">
<p>Cross-references:
- User model: com.e2eq.framework.model.security.CredentialUserIdPassword.roles
- Context: com.e2eq.framework.model.securityrules.PrincipalContext.getRoles()
- Filter logic: com.e2eq.framework.rest.filters.SecurityFilter.determinePrincipalContext</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_example_scenarios">10. Example Scenarios</h2>
<div class="sectionbody">
<div class="paragraph">
<p>1) Public catalog browsing
   - Request: GET /api/catalog/products?search=widgets
   - Headers: x-functional-area=Catalog
   - Identity: anonymous or role USER
   - Rules:
     - allow-public-reads (priority 100) ALLOW + readScope orgRefName=PUBLIC
   - Outcome: ALLOW; repository applies DataDomain filter orgRefName=PUBLIC</p>
</div>
<div class="paragraph">
<p>2) Tenant-scoped shipment update
   - Request: PUT /api/shipments/ABC123
   - Headers: x-functional-area=Collaboration, x-tenant-id=T1
   - Body: { dataDomain: { tenantId: "T1" }, &#8230;&#8203; }
   - Identity: user in tenant T1 with roles [USER]
   - Rules:
     - allow-collab-update (priority 300) requires body.dataDomain.tenantId == identity.tenantId and rolesAny USER, ADMIN &#8658; ALLOW
   - Outcome: ALLOW; Rule contributes writeScope tenantId=T1</p>
</div>
<div class="paragraph">
<p>3) Cross-tenant admin read with higher priority
   - Request: GET /api/partners
   - Identity: role ADMIN (super-admin)
   - Rules:
     - admin-override (priority 50) ALLOW
     - default-tenant-read (priority 600) ALLOW with tenant filter
   - Outcome: admin-override wins due to higher precedence (lower number), allowing broader read</p>
</div>
<div class="paragraph">
<p>4) Conflicting ALLOW and DENY at same priority
   - Two rules match with priority 200: one ALLOW, one DENY
   - Resolution: DENY wins unless merge strategy configured to handle explicitly; recommended to avoid same-priority conflicts by policy.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_operational_tips">11. Operational Tips</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Author specific DENY rules with low numbers to prevent accidental exposure.</p>
</li>
<li>
<p>Keep URL patterns narrowly tailored for sensitive domains.</p>
</li>
<li>
<p>Prefer header/body predicates to refine matches without exploding URL patterns.</p>
</li>
<li>
<p>Log matched rule names and applied scopes for auditability.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_uiactions_and_defaultuiactions_are_calculated">12. How UIActions and DefaultUIActions are calculated</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the server returns a collection of entities (for example, userProfiles), each entity may expose two action lists:
- DefaultUIActions: the full set of actions that conceptually apply to this type of entity (e.g., CREATE, UPDATE, VIEW, DELETE, ARCHIVE). Think of this as the “menu template” for the type.
- UIActions: the subset of actions the current user is actually permitted to perform on that specific entity instance right now.</p>
</div>
<div class="paragraph">
<p>Why they can differ per entity:
- Entity attributes: state or flags (e.g., archived, soft-deleted, immutable) can remove or alter available actions at instance level.
- Permission rule base: evaluated against the current request, identity, and context to allow or deny actions.
- DataDomain membership: tenant/org/owner scoping can further restrict actions if the identity is outside the entity’s domain.</p>
</div>
<div class="paragraph">
<p>How the server computes them:
1) Start with a default action template for the entity type (DefaultUIActions).
2) Apply simple state-based adjustments (e.g., suppress CREATE on already-persisted instances).
3) Evaluate the permission rules with the current identity and context:
   - Consider roles, functional area/domain, action intent, headers/body, and any rule-contributed scopes.
   - Resolve DataDomain constraints to ensure the identity is permitted to act within the entity’s domain.
4) Produce UIActions as the allowed subset for that entity instance.
5) Return both lists with each entity in collection responses.</p>
</div>
<div class="paragraph">
<p>How the client should use the two lists:
- Render the full DefaultUIActions as the visible set of possible actions (icons, buttons, menus) so the UI stays consistent.
- Enable only those actions present in UIActions; gray out or disable the remainder to signal capability but lack of current permission.
- This approach avoids flicker and keeps affordances discoverable while remaining truthful to the user’s current authorization.</p>
</div>
<div class="paragraph">
<p>Example:
- You fetch 25 userProfiles.
- DefaultUIActions for the type = [CREATE, VIEW, UPDATE, DELETE, ARCHIVE].
- For a specific profile A (owned by your tenant), UIActions may be [VIEW, UPDATE] based on your roles and domain.
- For another profile B (in a different tenant), UIActions may be [VIEW] only.
- The UI renders the same controls for both A and B, but only enables the actions present in each item’s UIActions list.</p>
</div>
<div class="paragraph">
<p>Operational considerations:
- Keep action names stable and documented so front-ends can map to icons and tooltips consistently.
- Prefer small, composable rules that evaluate action permissions explicitly by functional area/domain to avoid surprises.
- Consider server-side caching of action evaluations for list views to reduce latency, respecting identity and scope.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_this_integrates_end_to_end">13. How This Integrates End-to-End</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>BaseResource extracts identity and headers to construct DomainContext.</p>
</li>
<li>
<p>Rule evaluation uses URL/method + SecurityURLHeaders + SecurityURLBody + identity/userProfile to reach a decision and derive scope filters.</p>
</li>
<li>
<p>Repositories (e.g., MorphiaRepo) apply the filters to queries and updates, ensuring DataDomain-respecting access.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_administering_policies_via_rest_policyresource">14. Administering Policies via REST (PolicyResource)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The PolicyResource exposes CRUD-style REST APIs for creating and managing policies (rule bases) that drive authorization decisions. Each Policy targets a principalId (either a specific userId or a role name) and contains an ordered list of Rule objects. Rules match requests using SecurityURIHeader and SecurityURIBody and then contribute an effect (ALLOW/DENY) and optional repository filters.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Base path: /security/permission/policies</p>
</li>
<li>
<p>Auth: Bearer JWT (see Authentication); resource methods are guarded by @RolesAllowed("user", "admin") at the BaseResource level and your own realm/role policies.</p>
</li>
<li>
<p>Multi-realm: pass X-Realm header to operate within a specific realm; otherwise the default realm is used.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_model_shape_policy">14.1. Model shape (Policy)</h3>
<div class="paragraph">
<p>A Policy extends FullBaseModel and includes:
- id, refName, displayName, dataDomain, archived/expired flags (inherited)
- principalId: userId or role name that this policy attaches to
- description: human-readable summary
- rules: array of Rule entries</p>
</div>
<div class="paragraph">
<p>Rule fields (key ones):
- name, description
- securityURI.header: identity, area, functionalDomain, action (supports wildcard "<strong>")
- securityURI.body: realm, orgRefName, accountNumber, tenantId, ownerId, dataSegment, resourceId (supports wildcard "</strong>")
- effect: ALLOW or DENY
- priority: integer; lower numbers evaluated first
- finalRule: boolean; stop evaluating when this rule applies
- andFilterString / orFilterString: ANTLR filter DSL snippets injected into repository queries (see Query Language section)</p>
</div>
<div class="paragraph">
<p>Example payload:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">refName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">defaultUserPolicy</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">displayName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Default user policy</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">principalId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Users can act on their own data; deny dangerous ops in security area</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">rules</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">view-own-resources</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Limit reads to owner and default data segment</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">securityURI</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">header</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">identity</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">area</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">functionalDomain</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">action</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span> },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>:   { <span class="key"><span class="delimiter">&quot;</span><span class="content">realm</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">orgRefName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">accountNumber</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">tenantId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">ownerId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">dataSegment</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">resourceId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span> }
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">andFilterString</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dataDomain.ownerId:${principalId}&amp;&amp;dataDomain.dataSegment:#0</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">effect</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ALLOW</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">priority</span><span class="delimiter">&quot;</span></span>: <span class="integer">300</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">finalRule</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">deny-delete-in-security</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">securityURI</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">header</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">identity</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">area</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">security</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">functionalDomain</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">action</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">delete</span><span class="delimiter">&quot;</span></span> },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span>:   { <span class="key"><span class="delimiter">&quot;</span><span class="content">realm</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">orgRefName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">accountNumber</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">tenantId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">ownerId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">dataSegment</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">resourceId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span> }
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">effect</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">DENY</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">priority</span><span class="delimiter">&quot;</span></span>: <span class="integer">100</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">finalRule</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    }
  ]
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_endpoints">14.2. Endpoints</h3>
<div class="paragraph">
<p>All endpoints are relative to /security/permission/policies. These are inherited from BaseResource and are consistent across entity resources.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GET /list</p>
</li>
<li>
<p>Query params: skip, limit, filter, sort, projection</p>
</li>
<li>
<p>Returns a Collection&lt;Policy&gt; with paging metadata; respects X-Realm.</p>
</li>
<li>
<p>GET /id/{id} and GET /id?id=&#8230;&#8203;</p>
</li>
<li>
<p>Fetch a single Policy by id.</p>
</li>
<li>
<p>GET /refName/{refName} and GET /refName?refName=&#8230;&#8203;</p>
</li>
<li>
<p>Fetch a single Policy by refName.</p>
</li>
<li>
<p>GET /count?filter=&#8230;&#8203;</p>
</li>
<li>
<p>Returns a CounterResponse with total matching entities.</p>
</li>
<li>
<p>GET /schema</p>
</li>
<li>
<p>Returns JSON Schema for Policy.</p>
</li>
<li>
<p>POST /</p>
</li>
<li>
<p>Create or upsert a Policy (if id is present and matches an existing entity in the selected realm, it is updated).</p>
</li>
<li>
<p>PUT /set?id=&#8230;&#8203;&amp;pairs=field:value</p>
</li>
<li>
<p>Targeted field updates by id. pairs is a repeated query parameter specifying field/value pairs.</p>
</li>
<li>
<p>PUT /bulk/setByQuery?filter=&#8230;&#8203;&amp;pairs=&#8230;&#8203;</p>
</li>
<li>
<p>Bulk updates by query. Note: ignoreRules=true is not supported on this endpoint.</p>
</li>
<li>
<p>PUT /bulk/setByIds</p>
</li>
<li>
<p>Bulk updates by list of ids posted in the request body.</p>
</li>
<li>
<p>PUT /bulk/setByRefAndDomain</p>
</li>
<li>
<p>Bulk updates by a list of (refName, dataDomain) pairs in the request body.</p>
</li>
<li>
<p>DELETE /id/{id} (or /id?id=&#8230;&#8203;)</p>
</li>
<li>
<p>Delete by id.</p>
</li>
<li>
<p>DELETE /refName/{refName} (or /refName?refName=&#8230;&#8203;)</p>
</li>
<li>
<p>Delete by refName.</p>
</li>
<li>
<p>CSV import/export endpoints for bulk operations:</p>
</li>
<li>
<p>GET /csv – export as CSV (field selection, encoding, etc.)</p>
</li>
<li>
<p>POST /csv – import CSV into Policies</p>
</li>
<li>
<p>POST /csv/session – analyze CSV and create an import session (preview)</p>
</li>
<li>
<p>POST /csv/session/{sessionId}/commit – commit a previously analyzed session</p>
</li>
<li>
<p>DELETE /csv/session/{sessionId} – cancel a session</p>
</li>
<li>
<p>GET /csv/session/{sessionId}/rows – page through analyzed rows</p>
</li>
<li>
<p>Index management (admin only):</p>
</li>
<li>
<p>POST /indexes/ensureIndexes/{realm}?collectionName=policy</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Headers:
- Authorization: Bearer &lt;token&gt;
- X-Realm: realm identifier (optional but recommended in multi-tenant deployments)</p>
</div>
<div class="paragraph">
<p>Filtering and sorting:
- filter uses the ANTLR-based DSL (see REST CRUD &gt; Query Language)
- sort uses comma-separated fields with optional +/- prefix; projection accepts a comma-separated field list</p>
</div>
</div>
<div class="sect2">
<h3 id="_examples">14.3. Examples</h3>
<div class="ulist">
<ul>
<li>
<p>Create or update a Policy</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  -H &quot;Authorization: Bearer $JWT&quot; \
  -H &quot;Content-Type: application/json&quot; \
  -H &quot;X-Realm: system-com&quot; \
  https://host/api/security/permission/policies \
  -d @policy.json</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>List policies for principalId=user</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -H &quot;Authorization: Bearer $JWT&quot; \
     -H &quot;X-Realm: system-com&quot; \
     &quot;https://host/api/security/permission/policies/list?filter=principalId:'user'&amp;sort=+refName&amp;limit=50&quot;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Delete a policy by refName</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X DELETE \
  -H &quot;Authorization: Bearer $JWT&quot; \
  -H &quot;X-Realm: system-com&quot; \
  &quot;https://host/api/security/permission/policies/refName/defaultUserPolicy&quot;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_changes_affect_rule_bases_and_enforcement">14.4. How changes affect rule bases and enforcement</h3>
<div class="ulist">
<ul>
<li>
<p>Persistence vs. in-memory rules:</p>
</li>
<li>
<p>PolicyResource updates the persistent store of policies (one policy per principalId or role with a list of rules).</p>
</li>
<li>
<p>RuleContext is the in-memory evaluator used by repositories and resources to enforce permissions. It matches SecurityURIHeader/Body, orders rules by priority, and applies effects and filters.</p>
</li>
<li>
<p>Making persisted policy changes effective:</p>
</li>
<li>
<p>On startup, migrations (see InitializeDatabase and AddAnonymousSecurityRules) typically seed default policies and/or programmatically add rules to RuleContext.</p>
</li>
<li>
<p>When you modify policies via REST, you have two options to apply them at runtime:
1) Implement a reload step that reads policies from PolicyRepo and rehydrates RuleContext (e.g., RuleContext.clear(); then add rules built from current policies).
2) Restart the service or trigger whatever policy-loader your application uses at boot.</p>
</li>
<li>
<p>Tip: If you maintain a background watcher or admin endpoint to refresh policies, keep it tenant/realm-aware and idempotent.</p>
</li>
<li>
<p>Evaluation semantics (recap):</p>
</li>
<li>
<p>Rules are sorted by ascending priority; the first decisive rule sets the outcome. finalRule=true stops further processing.</p>
</li>
<li>
<p>andFilterString/orFilterString contribute repository filters through RuleContext.getFilters(), constraining result sets and write scopes.</p>
</li>
<li>
<p>principalId can be a concrete userId or a role; RuleContext considers both the principal and all associated roles.</p>
</li>
<li>
<p>Safe rollout:</p>
</li>
<li>
<p>Create new policies with a higher numeric priority (lower precedence) first, test with GET /schema and dry-run queries.</p>
</li>
<li>
<p>Use realm scoping via X-Realm to stage changes in a non-production realm.</p>
</li>
<li>
<p>Prefer DENY with low priority numbers for critical protections.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See also:
- Permissions: Matching Algorithm, Priorities, and Multiple Matching RuleBases (sections above)
- REST CRUD: Query Language and generic endpoint behaviors</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_realm_override_x_realm_and_impersonation_x_impersonate">15. Realm override (X-Realm) and Impersonation (X-Impersonate)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains how to use the request headers X-Realm and X-Impersonate-* alongside permission rule bases. These headers influence which realm (database) a request operates against and, in the case of impersonation, which identity’s roles are evaluated by the rule engine.</p>
</div>
<div class="sect2">
<h3 id="_what_they_do_at_a_glance">15.1. What they do (at a glance)</h3>
<div class="ulist">
<ul>
<li>
<p>X-Realm: Overrides the target realm (MongoDB database) used by repositories for this request. Your own identity and roles remain the same; only the data context (tenant/realm) changes for this call. This lets you “switch tenants” at the database level in deployments that use the one-tenant-per-database model.</p>
</li>
<li>
<p>X-Impersonate-Subject or X-Impersonate-UserId: Causes the request to run as another identity. The effective permissions become those of the impersonated identity (potentially more or less than your own). This is analogous to sudo on Unix or to “simulate a user/role” for troubleshooting.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only one of X-Impersonate-Subject or X-Impersonate-UserId may be supplied per request. Supplying both results in a 400/IllegalArgumentException.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_the_headers_integrate_with_permission_evaluation">15.2. How the headers integrate with permission evaluation</h3>
<div class="ulist">
<ul>
<li>
<p>Rule matching and effects (ALLOW/DENY) still follow the standard algorithm described earlier.</p>
</li>
<li>
<p>With X-Realm (no impersonation):</p>
</li>
<li>
<p>The PrincipalContext.defaultRealm is set to the header value (after validation), and repositories operate in that realm.</p>
</li>
<li>
<p>Your own roles and identity remain intact; the rule base is evaluated for your identity and roles but in the specified realm’s data context.</p>
</li>
<li>
<p>With impersonation:</p>
</li>
<li>
<p>The PrincipalContext is rebuilt from the impersonated user’s credential. The effective roles used by the rule engine include the impersonated user’s roles; the platform also merges in the caller’s security roles from Quarkus SecurityIdentity. This means permissions can be a superset; design policy rules accordingly.</p>
</li>
<li>
<p>The effective realm for the request is set to the impersonated user’s default realm (not the X-Realm header). If you passed X-Realm, it is still validated (see below) but not used to override the impersonated default realm in the current implementation.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_required_credential_configuration_credentialuseridpassword">15.3. Required credential configuration (CredentialUserIdPassword)</h3>
<div class="paragraph">
<p>Two fields on CredentialUserIdPassword govern whether a user may use these headers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>realmRegEx (for X-Realm):</p>
</li>
<li>
<p>A wildcard pattern ("*" matches any sequence; case-insensitive) listing the realms a user is allowed to target with X-Realm.</p>
</li>
<li>
<p>If X-Realm is present but realmRegEx is null/blank or does not match the requested realm, the server returns 403 Forbidden.</p>
</li>
<li>
<p>Examples:</p>
</li>
<li>
<p>"*" → allow any realm</p>
</li>
<li>
<p>"acme-*" → allow realms that start with acme-</p>
</li>
<li>
<p>"dev|stage|prod" is not supported as-is; use wildcards like "dev*" and "stage*" or a combined pattern like "(dev|stage|prod)" only if you store a true regex. The current validator replaces '<strong>' with ".</strong>" and matches case-insensitively.</p>
</li>
<li>
<p>impersonateFilterScript (for X-Impersonate-*):</p>
</li>
<li>
<p>A JavaScript snippet executed by the server (GraalVM) that must return a boolean. It receives three variables: username (the caller’s subject), userId (caller’s userId), and realm (the requested realm or current DB name).</p>
</li>
<li>
<p>If the script evaluates to false, the server returns 403 Forbidden for impersonation.</p>
</li>
<li>
<p>If the script is missing (null) and you attempt impersonation, the server rejects the request with 400/IllegalArgumentException.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example impersonation script (allow only company admins to impersonate in dev realms):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// username = caller's subject, userId = caller's userId, realm = requested realm (or current)</span>
(username.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">@acme.com</span><span class="delimiter">'</span></span>) &amp;&amp; realm.startsWith(<span class="string"><span class="delimiter">'</span><span class="content">dev-</span><span class="delimiter">'</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>Tip: Manage these two fields via your auth provider’s admin APIs or directly through CredentialRepo in controlled environments.</p>
</div>
</div>
<div class="sect2">
<h3 id="_end_to_end_behavior_from_securityfilter_reference">15.4. End-to-end behavior from SecurityFilter (reference)</h3>
<div class="paragraph">
<p>The SecurityFilter constructs the PrincipalContext/ResourceContext before rule evaluation:
- X-Realm is read and, if present, validated against the caller’s credential.realmRegEx.
- If impersonation headers are present:
  - The caller’s credential.impersonateFilterScript is executed. If it returns true, the impersonated user’s credential is loaded and used to build the PrincipalContext.
  - The final PrincipalContext carries the impersonated user’s defaultRealm and roles (merged with the caller’s SecurityIdentity roles), and may copy area2RealmOverrides from the impersonated credential.
- Without impersonation, the PrincipalContext is built from the caller’s credential; X-Realm, when valid, sets the defaultRealm for this request.</p>
</div>
</div>
<div class="sect2">
<h3 id="_practical_differences_and_use_cases">15.5. Practical differences and use cases</h3>
<div class="ulist">
<ul>
<li>
<p>Realm override (X-Realm):</p>
</li>
<li>
<p>Who you are does not change; only where you act changes. Your permissions (as determined by policies attached to your identity/roles) are applied against data in the specified realm.</p>
</li>
<li>
<p>Use cases:</p>
</li>
<li>
<p>Multi-tenant admin tooling that needs to inspect or repair data in customer realms.</p>
</li>
<li>
<p>Reporting or backfills where the same service is pointed at different tenant databases per request.</p>
</li>
<li>
<p>Impersonation (X-Impersonate-*):</p>
</li>
<li>
<p>Who you are (for authorization purposes) changes. You act with the impersonated identity’s permissions; depending on your configuration, additional caller roles may be merged.</p>
</li>
<li>
<p>Use cases:</p>
</li>
<li>
<p>Temporary elevation to an admin identity (sudo-like) for break-glass operations.</p>
</li>
<li>
<p>Simulate what a given role/identity can see/do for troubleshooting or customer support.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Caveats:
- Never set a permissive impersonateFilterScript in production. Keep it restrictive and auditable.
- When using both X-Realm and impersonation in one call, be aware that the effective realm will be the impersonated user’s default realm; X-Realm is not applied in the impersonation branch in the current implementation.
- realmRegEx must be populated for any user who needs realm override; leaving it blank effectively disables X-Realm for that user.</p>
</div>
</div>
<div class="sect2">
<h3 id="_examples_2">15.6. Examples</h3>
<div class="ulist">
<ul>
<li>
<p>List policies in a different realm using your own identity</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -H &quot;Authorization: Bearer $JWT&quot; \
     -H &quot;X-Realm: acme-prod&quot; \
     &quot;https://host/api/security/permission/policies/list?limit=20&amp;sort=+refName&quot;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Simulate another user by subject while staying in their default realm</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -H &quot;Authorization: Bearer $JWT&quot; \
     -H &quot;X-Impersonate-Subject: 3d8f4e7b-...-idp-subject&quot; \
     &quot;https://host/api/security/permission/policies/list?limit=20&quot;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Attempt impersonation with a realm hint (validated by script; effective realm = impersonated default)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -H &quot;Authorization: Bearer $JWT&quot; \
     -H &quot;X-Realm: dev-acme&quot; \
     -H &quot;X-Impersonate-UserId: tenant-admin&quot; \
     &quot;https://host/api/security/permission/policies/list?limit=20&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Security outcomes in all cases continue to be driven by your rule bases (Policy rules) matched against the effective PrincipalContext and ResourceContext.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_domain_assignment_on_create_domaincontext_and_datadomainpolicy">16. Data domain assignment on create: DomainContext and DataDomainPolicy</h2>
<div class="sectionbody">
<div id="_data_domain_assignment" class="paragraph">
<p>This section explains how Quantum decides which dataDomain is stamped on newly created records, why this decision is necessary in a multi‑tenant system, what the default behavior is, and how you can override it globally or per Functional Area / Functional Domain. It also describes the DataDomainResolver interface and the default implementation provided by the framework.</p>
</div>
<div class="sect2">
<h3 id="_the_problem_this_solves_and_why_it_matters">16.1. The problem this solves (and why it matters)</h3>
<div class="paragraph">
<p>In a multi‑tenant platform you must ensure each new record is written to the correct data partition so later reads/updates can be scoped safely. If the dataDomain is wrong or missing, you risk leaking data across tenants or making your own data inaccessible due to mis‑scoping.</p>
</div>
<div class="paragraph">
<p>Historically, Quantum set the dataDomain of new entities to match the creator’s credential (i.e., the principal’s DomainContext → DataDomain). That default is sensible in many cases, but real systems often need more specific behavior per business area or type. For example:
- You may centralize HR records in a single org‑level domain regardless of who created them.
- Sales invoices for EU customers must live under an EU data segment.
- A specific product area might always write into a shared catalog domain separate from the author’s tenant.</p>
</div>
<div class="paragraph">
<p>These needs require a simple, deterministic way to override the default per Functional Area and/or Functional Domain.</p>
</div>
</div>
<div class="sect2">
<h3 id="_key_concepts_recap_domaincontext_and_datadomain">16.2. Key concepts recap: DomainContext and DataDomain</h3>
<div class="ulist">
<ul>
<li>
<p>DomainContext (on credentials/realms) captures the principal’s scoping defaults (realm, org/account/tenant identifiers, data segment). At request time this is materialized into a DataDomain.</p>
</li>
<li>
<p>DataDomain is what gets stamped onto persisted entities and later used by repositories to constrain queries and updates.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you do nothing, new records inherit the principal’s DataDomain.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_default_policy_do_nothing_and_it_works">16.3. The default policy (do nothing and it works)</h3>
<div class="paragraph">
<p>Out of the box, Quantum preserves the existing behavior: if no policy is configured, the resolver falls back to the authenticated principal’s DataDomain. This guarantees compatibility with existing applications.</p>
</div>
<div class="paragraph">
<p>Concretely:
- ValidationInterceptor checks if an entity being persisted lacks a dataDomain.
- If missing, it calls DataDomainResolver.resolveForCreate(area, domain).
- The DefaultDataDomainResolver first looks for overrides (credential‑attached or global); if none match, it returns the principal’s DataDomain from the current SecurityContext.</p>
</div>
</div>
<div class="sect2">
<h3 id="_policy_scopes_principalattached_vs_global">16.4. Policy scopes: principal‑attached vs. global</h3>
<div class="paragraph">
<p>You can define overrides at two levels:
- Principal‑attached (per credential): attach a DataDomainPolicy to a CredentialUserIdPassword. The SecurityFilter places this policy into the PrincipalContext, so it applies only to records created by that principal. This is useful for VIP service accounts or specific partners.
- Global policy: an application‑wide DataDomainPolicy provided by GlobalDataDomainPolicyProvider. If present, this applies when the principal has no specific override for the matching area/domain.</p>
</div>
<div class="paragraph">
<p>Precedence: principal‑attached policy wins over global policy; if neither applies, fall back to the principal’s credential domain.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_policy_map_and_matching">16.5. The policy map and matching</h3>
<div class="paragraph">
<p>A DataDomainPolicy is a small map of rules: Map&lt;String, DataDomainPolicyEntry&gt; policyEntries, keyed by "&lt;FunctionalArea&gt;:&lt;FunctionalDomain&gt;" with support for "*" wildcards. The resolver evaluates keys in this order:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>area:domain (most specific)</p>
</li>
<li>
<p>area:*</p>
</li>
<li>
<p>*:domain</p>
</li>
<li>
<p><strong>:</strong> (global catch‑all)</p>
</li>
<li>
<p>Fallback to principal’s domain if no entry yields a value</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Each DataDomainPolicyEntry has a resolutionMode:
- FROM_CREDENTIAL (default): use the principal’s credential domain (i.e., the historical behavior).
- FIXED: use the first DataDomain listed in dataDomains on the entry.</p>
</div>
<div class="paragraph">
<p>Example policy definitions (illustrative JSON):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">policyEntries</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Sales:Invoice</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">resolutionMode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FIXED</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">dataDomains</span><span class="delimiter">&quot;</span></span>: [ {<span class="key"><span class="delimiter">&quot;</span><span class="content">orgRefName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ACME</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">tenantId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">eu-1</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">dataSegment</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">INVOICE</span><span class="delimiter">&quot;</span></span>} ] },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Sales:*</span><span class="delimiter">&quot;</span></span>:      { <span class="key"><span class="delimiter">&quot;</span><span class="content">resolutionMode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FROM_CREDENTIAL</span><span class="delimiter">&quot;</span></span> },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">*:HR</span><span class="delimiter">&quot;</span></span>:         { <span class="key"><span class="delimiter">&quot;</span><span class="content">resolutionMode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FIXED</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">dataDomains</span><span class="delimiter">&quot;</span></span>: [ {<span class="key"><span class="delimiter">&quot;</span><span class="content">orgRefName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">GLOBAL</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">tenantId</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">hr</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">dataSegment</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">HR</span><span class="delimiter">&quot;</span></span>} ] },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">*:*</span><span class="delimiter">&quot;</span></span>:          { <span class="key"><span class="delimiter">&quot;</span><span class="content">resolutionMode</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FROM_CREDENTIAL</span><span class="delimiter">&quot;</span></span> }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Behavior of the above:
- Sales:Invoice records always go to the fixed EU invoices domain.
- Any other Sales:* creation uses the creator’s credential domain.
- All HR records go to a central HR domain.
- Otherwise, default to the creator’s domain.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_the_resolver_works">16.6. How the resolver works</h3>
<div class="paragraph">
<p>Interfaces and default implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">DataDomainResolver</span> {
  DataDomain resolveForCreate(<span class="predefined-type">String</span> functionalArea, <span class="predefined-type">String</span> functionalDomain);
}

<span class="annotation">@ApplicationScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DefaultDataDomainResolver</span> <span class="directive">implements</span> DataDomainResolver {
  <span class="annotation">@Inject</span> GlobalDataDomainPolicyProvider globalPolicyProvider;
  <span class="directive">public</span> DataDomain resolveForCreate(<span class="predefined-type">String</span> area, <span class="predefined-type">String</span> domain) {
    DataDomain principalDD = SecurityContext.getPrincipalDataDomain()
      .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="exception">IllegalStateException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Principal context not providing a data domain</span><span class="delimiter">&quot;</span></span>));
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; keys = <span class="predefined-type">List</span>.of(areaOrStar(area)+<span class="string"><span class="delimiter">&quot;</span><span class="content">:</span><span class="delimiter">&quot;</span></span>+areaOrStar(domain), areaOrStar(area)+<span class="string"><span class="delimiter">&quot;</span><span class="content">:*</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">*:</span><span class="delimiter">&quot;</span></span>+areaOrStar(domain), <span class="string"><span class="delimiter">&quot;</span><span class="content">*:*</span><span class="delimiter">&quot;</span></span>);
    <span class="comment">// 1) principal‑attached policy from PrincipalContext</span>
    DataDomain fromPrincipal = resolveFrom(policyFromPrincipal(), keys, principalDD);
    <span class="keyword">if</span> (fromPrincipal != <span class="predefined-constant">null</span>) <span class="keyword">return</span> fromPrincipal;
    <span class="comment">// 2) global policy</span>
    DataDomain fromGlobal = resolveFrom(globalPolicyProvider.getPolicy().orElse(<span class="predefined-constant">null</span>), keys, principalDD);
    <span class="keyword">if</span> (fromGlobal != <span class="predefined-constant">null</span>) <span class="keyword">return</span> fromGlobal;
    <span class="comment">// 3) default fallback</span>
    <span class="keyword">return</span> principalDD;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Integration point:
- ValidationInterceptor injects DataDomainResolver and calls it in prePersist when an entity’s dataDomain is null.
- SecurityFilter propagates a principal’s attached DataDomainPolicy (if any) into the PrincipalContext so the resolver can see it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_when_would_you_want_a_nonglobal_policy">16.7. When would you want a non‑global policy?</h3>
<div class="paragraph">
<p>Here are a few concrete scenarios:
- Centralized HR: All HR Employee records are written to a shared HR domain regardless of the team creating them. This supports a shared‑service HR model without duplicating HR data per tenant.
- Regulated invoices: In the Sales:Invoice domain for EU, you must write under a specific EU tenantId/dataSegment to satisfy data residency. Other Sales domains can keep default behavior.
- Shared catalog: The Catalog:Item domain is a cross‑tenant shared catalog maintained by a core team. Writes should go to a canonical catalog domain even when initiated by tenant‑specific users.
- VIP account override: A particular integration user should always write to a staging domain for testing purposes, while all others use defaults. Attach a small policy to just that credential.</p>
</div>
</div>
<div class="sect2">
<h3 id="_relation_to_tenancy_models">16.8. Relation to tenancy models</h3>
<div class="paragraph">
<p>The policy mechanism supports both siloed and pooled tenancy:
- Siloed tenancy: Most domains default to FROM_CREDENTIAL (each tenant writes to its own partition). Only a few shared services (e.g., HR, catalog) use FIXED to centralize data.
- Pooled tenancy: You may lean on FIXED policies more often to route writes into pooled/segment‑specific domains (e.g., region, product line), while still enforcing read/write scoping via permissions.</p>
</div>
<div class="paragraph">
<p>Because the resolver always validates through the principal context and falls back safely, you can introduce overrides gradually without destabilizing existing flows.</p>
</div>
</div>
<div class="sect2">
<h3 id="_authoring_tips">16.9. Authoring tips</h3>
<div class="ulist">
<ul>
<li>
<p>Start with no policy and verify your default flows. Add entries only where necessary.</p>
</li>
<li>
<p>Prefer specific keys (area:domain) for clarity; use wildcards sparingly.</p>
</li>
<li>
<p>Keep FIXED DataDomain objects minimal and valid for your deployment (orgRefName, tenantId, and dataSegment as needed).</p>
</li>
<li>
<p>Document any global policy so teams know which areas are centralized.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_api_pointers">16.10. API pointers</h3>
<div class="ulist">
<ul>
<li>
<p>CredentialUserIdPassword.dataDomainPolicy: optional per‑credential overrides (propagated to PrincipalContext).</p>
</li>
<li>
<p>GlobalDataDomainPolicyProvider: holds an optional in‑memory global policy (null by default).</p>
</li>
<li>
<p>DataDomainPolicyEntry.resolutionMode: FROM_CREDENTIAL (default) or FIXED.</p>
</li>
<li>
<p>DataDomainResolver / DefaultDataDomainResolver: the extension point and default behavior.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.2.2-SNAPSHOT<br>
Last updated 2025-09-13 09:47:25 -0400
</div>
</div>
</body>
</html>