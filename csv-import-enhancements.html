<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>CSV Import Enhancements: Value Mapping and Transformations</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body id="csv-import-enhancements" class="book toc2 toc-left">
<div id="header">
<h1>CSV Import Enhancements: Value Mapping and Transformations</h1>
<div class="details">
<span id="revnumber">version 1.2.4-SNAPSHOT,</span>
<span id="revdate">2026-01-31T06:27:21Z</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_executive_summary">1. Executive Summary</a></li>
<li><a href="#_current_state_analysis">2. Current State Analysis</a>
<ul class="sectlevel2">
<li><a href="#_existing_architecture">2.1. Existing Architecture</a></li>
<li><a href="#_current_limitations">2.2. Current Limitations</a></li>
</ul>
</li>
<li><a href="#_proposed_design">3. Proposed Design</a>
<ul class="sectlevel2">
<li><a href="#_overview">3.1. Overview</a></li>
<li><a href="#_component_design">3.2. Component Design</a>
<ul class="sectlevel3">
<li><a href="#_1_importprofile_entity">3.2.1. 1. ImportProfile Entity</a></li>
<li><a href="#_2_columnmapping_configuration">3.2.2. 2. ColumnMapping Configuration</a></li>
<li><a href="#_3_supporting_enums_and_classes">3.2.3. 3. Supporting Enums and Classes</a></li>
<li><a href="#_4_lookupconfig_for_reference_resolution">3.2.4. 4. LookupConfig for Reference Resolution</a></li>
<li><a href="#_5_header_based_field_metadata">3.2.5. 5. Header-Based Field Metadata</a></li>
<li><a href="#_6_intent_configuration">3.2.6. 6. Intent Configuration</a></li>
<li><a href="#_7_globaltransformations">3.2.7. 7. GlobalTransformations</a></li>
<li><a href="#_8_lookupservice_interface">3.2.8. 8. LookupService Interface</a></li>
<li><a href="#_9_prevalidationtransformer_interface">3.2.9. 9. PreValidationTransformer Interface</a></li>
<li><a href="#_10_importrowcontext">3.2.10. 10. ImportRowContext</a></li>
<li><a href="#_11_transformationexception">3.2.11. 11. TransformationException</a></li>
</ul>
</li>
<li><a href="#_enhanced_cell_processors">3.3. Enhanced Cell Processors</a>
<ul class="sectlevel3">
<li><a href="#_valuemapprocessor">3.3.1. ValueMapProcessor</a></li>
<li><a href="#_regexreplaceprocessor">3.3.2. RegexReplaceProcessor</a></li>
<li><a href="#_casetransformprocessor">3.3.3. CaseTransformProcessor</a></li>
<li><a href="#_lookupprocessor">3.3.4. LookupProcessor</a></li>
</ul>
</li>
<li><a href="#_enhanced_csvimporthelper">3.4. Enhanced CSVImportHelper</a>
<ul class="sectlevel3">
<li><a href="#_new_method_signatures">3.4.1. New Method Signatures</a></li>
<li><a href="#_csvformatoptions_refactored">3.4.2. CSVFormatOptions (Refactored)</a></li>
<li><a href="#_enhanced_processor_chain_building">3.4.3. Enhanced Processor Chain Building</a></li>
<li><a href="#_prevalidationtransformer_integration">3.4.4. PreValidationTransformer Integration</a></li>
<li><a href="#_intent_resolution">3.4.5. Intent Resolution</a></li>
<li><a href="#_intent_execution">3.4.6. Intent Execution</a></li>
</ul>
</li>
<li><a href="#_rest_api_enhancements">3.5. REST API Enhancements</a>
<ul class="sectlevel3">
<li><a href="#_updated_endpoints">3.5.1. Updated Endpoints</a></li>
<li><a href="#_importprofile_resource">3.5.2. ImportProfile Resource</a></li>
</ul>
</li>
<li><a href="#_example_usage">3.6. Example Usage</a>
<ul class="sectlevel3">
<li><a href="#_example_importprofile_json">3.6.1. Example ImportProfile (JSON)</a></li>
<li><a href="#_example_csv_without_intent_column">3.6.2. Example CSV (without intent column)</a></li>
<li><a href="#_example_csv_with_intent_column">3.6.3. Example CSV (with intent column)</a></li>
<li><a href="#_api_calls">3.6.4. API Calls</a></li>
<li><a href="#_example_prevalidationtransformer">3.6.5. Example PreValidationTransformer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_migration_path">4. Migration Path</a>
<ul class="sectlevel2">
<li><a href="#_phase_1_core_models_non_breaking">4.1. Phase 1: Core Models (Non-Breaking)</a></li>
<li><a href="#_phase_2_cell_processors_non_breaking">4.2. Phase 2: Cell Processors (Non-Breaking)</a></li>
<li><a href="#_phase_3_csvimporthelper_enhancement_non_breaking">4.3. Phase 3: CSVImportHelper Enhancement (Non-Breaking)</a></li>
<li><a href="#_phase_4_prevalidationtransformer_spi_non_breaking">4.4. Phase 4: PreValidationTransformer SPI (Non-Breaking)</a></li>
<li><a href="#_phase_5_header_modifiers_non_breaking">4.5. Phase 5: Header Modifiers (Non-Breaking)</a></li>
<li><a href="#_phase_6_rest_api_updates_non_breaking">4.6. Phase 6: REST API Updates (Non-Breaking)</a></li>
</ul>
</li>
<li><a href="#_security_considerations">5. Security Considerations</a>
<ul class="sectlevel2">
<li><a href="#_profile_access_control">5.1. Profile Access Control</a></li>
<li><a href="#_lookup_security">5.2. Lookup Security</a></li>
<li><a href="#_regex_safety">5.3. Regex Safety</a></li>
</ul>
</li>
<li><a href="#_performance_considerations">6. Performance Considerations</a>
<ul class="sectlevel2">
<li><a href="#_lookup_caching">6.1. Lookup Caching</a></li>
<li><a href="#_batch_lookup_optimization">6.2. Batch Lookup Optimization</a></li>
<li><a href="#_profile_caching">6.3. Profile Caching</a></li>
</ul>
</li>
<li><a href="#_testing_strategy">7. Testing Strategy</a>
<ul class="sectlevel2">
<li><a href="#_unit_tests">7.1. Unit Tests</a></li>
<li><a href="#_integration_tests">7.2. Integration Tests</a></li>
<li><a href="#_performance_tests">7.3. Performance Tests</a></li>
</ul>
</li>
<li><a href="#_appendix_a_common_value_mapping_patterns">8. Appendix A: Common Value Mapping Patterns</a>
<ul class="sectlevel2">
<li><a href="#_boolean_values">8.1. Boolean Values</a></li>
<li><a href="#_status_codes">8.2. Status Codes</a></li>
<li><a href="#_country_codes">8.3. Country Codes</a></li>
</ul>
</li>
<li><a href="#_appendix_b_regex_patterns">9. Appendix B: Regex Patterns</a>
<ul class="sectlevel2">
<li><a href="#_remove_currency_symbols">9.1. Remove Currency Symbols</a></li>
<li><a href="#_normalize_phone_numbers">9.2. Normalize Phone Numbers</a></li>
<li><a href="#_extract_numeric_id">9.3. Extract Numeric ID</a></li>
<li><a href="#_normalize_whitespace">9.4. Normalize Whitespace</a></li>
</ul>
</li>
<li><a href="#_implementation_status">10. Implementation Status</a>
<ul class="sectlevel2">
<li><a href="#_completed_components">10.1. Completed Components</a></li>
<li><a href="#_rest_api_endpoints">10.2. REST API Endpoints</a></li>
<li><a href="#_usage">10.3. Usage</a></li>
</ul>
</li>
<li><a href="#_rowvalueresolver_per_row_arbitrary_code_execution">11. RowValueResolver: Per-Row Arbitrary Code Execution</a>
<ul class="sectlevel2">
<li><a href="#_use_cases">11.1. Use Cases</a></li>
<li><a href="#_example_address_geocoding">11.2. Example: Address Geocoding</a>
<ul class="sectlevel3">
<li><a href="#_1_create_the_rowvalueresolver_implementation">11.2.1. 1. Create the RowValueResolver Implementation</a></li>
<li><a href="#_2_configure_the_importprofile">11.2.2. 2. Configure the ImportProfile</a></li>
<li><a href="#_3_sample_csv_input">11.2.3. 3. Sample CSV Input</a></li>
<li><a href="#_4_result">11.2.4. 4. Result</a></li>
</ul>
</li>
<li><a href="#_rowvalueresolver_api">11.3. RowValueResolver API</a></li>
<li><a href="#_resolveresult_options">11.4. ResolveResult Options</a></li>
<li><a href="#_processing_order">11.5. Processing Order</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_executive_summary">1. Executive Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document proposes enhancements to the Quantum framework&#8217;s CSV import functionality to add value mapping and transformation capabilities. The primary gaps addressed are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>No value mapping</strong> - Cannot map CSV values to different values prior to validation (e.g., "Y" → <code>true</code>, "Active" → <code>ACTIVE</code>)</p>
</li>
<li>
<p><strong>No lookup/reference resolution</strong> - Cannot resolve foreign references by looking up values in other collections</p>
</li>
<li>
<p><strong>No pre-validation transformation hook</strong> - Cannot programmatically transform parsed beans before validation</p>
</li>
<li>
<p><strong>No explicit intent control</strong> - Cannot specify INSERT vs UPDATE per row; always uses auto-detect (UPSERT)</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This design intentionally <strong>excludes</strong> MERGE and DELETE intents for safety reasons. Only INSERT, UPDATE, UPSERT, and SKIP are supported.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>No header-based field metadata</strong> - Cannot specify required/optional/calculated fields via CSV header conventions</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_current_state_analysis">2. Current State Analysis</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_existing_architecture">2.1. Existing Architecture</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CSV File
    │
    ▼
┌─────────────────────────┐
│  SuperCSV Parser        │  CsvDozerBeanReader
│  + CellProcessors       │  (ParseInt, ParseEnum, etc.)
└─────────────────────────┘
    │
    ▼
┌─────────────────────────┐
│  Bean Instance (T)      │  Populated via Dozer mapping
└─────────────────────────┘
    │
    ▼
┌─────────────────────────┐
│  Jakarta Validation     │  validator.validate(bean)
│  (@NotNull, @Size, etc) │
└─────────────────────────┘
    │
    ▼
┌─────────────────────────┐
│  Intent Detection       │  repo.getListFromRefNames()
│  (INSERT vs UPDATE)     │  Automatic based on refName existence
└─────────────────────────┘
    │
    ▼
┌─────────────────────────┐
│  MorphiaRepo.save()     │  Upsert behavior
└─────────────────────────┘</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_current_limitations">2.2. Current Limitations</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Gap</th>
<th class="tableblock halign-left valign-top">Current Behavior</th>
<th class="tableblock halign-left valign-top">Desired Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value Mapping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only type conversion (String→int, String→enum)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbitrary value transformations via configurable mappings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lookup Resolution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resolve references by looking up values in other collections</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">String Transformations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trim, case conversion, regex replacement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pre-validation Hook</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transform bean after parsing, before validation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None (null if empty)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configurable default values for empty/null cells</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intent Control</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always UPSERT (auto-detect INSERT vs UPDATE)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional per-row intent column (INSERT, UPDATE, SKIP) with validation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Header-based Field Metadata</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None - all fields treated equally</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suffix conventions for required (*), optional (?), calculated (~) fields</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_proposed_design">3. Proposed Design</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview">3.1. Overview</h3>
<div class="paragraph">
<p>The design introduces three new concepts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>ImportProfile</strong> - Configurable transformation and mapping rules</p>
</li>
<li>
<p><strong>Enhanced CellProcessors</strong> - Value mapping, lookup, and string transformation processors</p>
</li>
<li>
<p><strong>PreValidationTransformer</strong> - Programmatic transformation hook</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CSV File + ImportProfile
    │
    ▼
┌─────────────────────────┐
│  SuperCSV Parser        │
│  + Enhanced Processors  │  ← ValueMapProcessor, LookupProcessor
└─────────────────────────┘
    │
    ▼
┌─────────────────────────┐
│  Bean Instance (T)      │
└─────────────────────────┘
    │
    ▼
┌─────────────────────────┐
│  PreValidationTransform │  ← NEW: Programmatic transformation
└─────────────────────────┘
    │
    ▼
┌─────────────────────────┐
│  Jakarta Validation     │
└─────────────────────────┘
    │
    ▼
┌─────────────────────────┐
│  Intent Detection       │  (unchanged)
└─────────────────────────┘
    │
    ▼
┌─────────────────────────┐
│  MorphiaRepo.save()     │  (unchanged)
└─────────────────────────┘</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_component_design">3.2. Component Design</h3>
<div class="sect3">
<h4 id="_1_importprofile_entity">3.2.1. 1. ImportProfile Entity</h4>
<div class="paragraph">
<p>A persistent, reusable configuration for import transformations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.model.persistent.imports</span>;

<span class="keyword">import</span> <span class="include">com.e2eq.framework.model.persistent.base.BaseModel</span>;
<span class="keyword">import</span> <span class="include">dev.morphia.annotations.Entity</span>;
<span class="keyword">import</span> <span class="include">io.quarkus.runtime.annotations.RegisterForReflection</span>;
<span class="keyword">import</span> <span class="include">lombok.Data</span>;
<span class="keyword">import</span> <span class="include">lombok.EqualsAndHashCode</span>;
<span class="keyword">import</span> <span class="include">lombok.NoArgsConstructor</span>;
<span class="keyword">import</span> <span class="include">lombok.experimental.SuperBuilder</span>;

<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="comment">/**
 * Persistent configuration for CSV import transformations.
 * Profiles can be reused across multiple imports and shared within a tenant.
 */</span>
<span class="annotation">@Data</span>
<span class="annotation">@EqualsAndHashCode</span>(callSuper = <span class="predefined-constant">true</span>)
<span class="annotation">@RegisterForReflection</span>
<span class="annotation">@SuperBuilder</span>
<span class="annotation">@NoArgsConstructor</span>
<span class="annotation">@Entity</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ImportProfile</span> <span class="directive">extends</span> BaseModel {

    <span class="comment">/**
     * Target entity class name (fully qualified).
     * If null, profile can be used with any entity type.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> targetType;

    <span class="comment">/**
     * Column-to-field mappings with transformations.
     * Order matters - defines CSV column order when requestedColumns not specified.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;ColumnMapping&gt; columnMappings;

    <span class="comment">/**
     * Global transformations applied to all string fields.
     */</span>
    <span class="directive">private</span> GlobalTransformations globalTransformations;

    <span class="comment">/**
     * Whether to fail on first transformation error or collect all errors.
     */</span>
    <span class="directive">private</span> <span class="type">boolean</span> failFast = <span class="predefined-constant">false</span>;

    <span class="comment">/**
     * Optional description of what this profile is for.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> description;

    <span class="comment">/**
     * Optional column name containing per-row intent.
     * If specified, the CSV can include a column with values: INSERT, UPDATE, SKIP.
     * If null, intent is determined automatically (UPSERT behavior).
     *
     * Note: Only INSERT, UPDATE, and SKIP are supported. MERGE and DELETE
     * are intentionally not supported for safety reasons.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> intentColumn;

    <span class="comment">/**
     * Default intent when intentColumn is specified but a row has empty/invalid value.
     * One of: INSERT, UPDATE, UPSERT (auto-detect), SKIP.
     * Default: UPSERT (auto-detect based on refName existence).
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> defaultIntent = <span class="string"><span class="delimiter">&quot;</span><span class="content">UPSERT</span><span class="delimiter">&quot;</span></span>;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> bmFunctionalArea() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">IMPORTS</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> bmFunctionalDomain() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">IMPORTS</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_2_columnmapping_configuration">3.2.2. 2. ColumnMapping Configuration</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.model.persistent.imports</span>;

<span class="keyword">import</span> <span class="include">lombok.Data</span>;
<span class="keyword">import</span> <span class="include">lombok.NoArgsConstructor</span>;
<span class="keyword">import</span> <span class="include">lombok.AllArgsConstructor</span>;
<span class="keyword">import</span> <span class="include">lombok.Builder</span>;

<span class="keyword">import</span> <span class="include">java.util.Map</span>;

<span class="comment">/**
 * Configuration for mapping and transforming a single CSV column.
 */</span>
<span class="annotation">@Data</span>
<span class="annotation">@NoArgsConstructor</span>
<span class="annotation">@AllArgsConstructor</span>
<span class="annotation">@Builder</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ColumnMapping</span> {

    <span class="comment">/**
     * CSV column index (0-based) or column name if header present.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> sourceColumn;

    <span class="comment">/**
     * Target field name on the entity.
     * Supports nested paths (e.g., &quot;address.city&quot;) and array notation (e.g., &quot;tags[0]&quot;).
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> targetField;

    <span class="comment">/**
     * Static value mappings: CSV value → target value.
     * Applied before type conversion.
     * Example: {&quot;Y&quot;: &quot;true&quot;, &quot;N&quot;: &quot;false&quot;}
     */</span>
    <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; valueMappings;

    <span class="comment">/**
     * Whether value mapping comparison is case-sensitive.
     * Default: false (case-insensitive)
     */</span>
    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> <span class="type">boolean</span> valueMappingCaseSensitive = <span class="predefined-constant">false</span>;

    <span class="comment">/**
     * Behavior when CSV value not found in valueMappings.
     * Default: PASSTHROUGH
     */</span>
    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> UnmappedValueBehavior unmappedValueBehavior = UnmappedValueBehavior.PASSTHROUGH;

    <span class="comment">/**
     * Regex pattern for replacement.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> regexPattern;

    <span class="comment">/**
     * Replacement string for regex matches.
     * Supports capture group references ($1, $2, etc.)
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> regexReplacement;

    <span class="comment">/**
     * Default value if CSV cell is empty/null.
     * Applied after all other transformations.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> defaultValue;

    <span class="comment">/**
     * Trim leading/trailing whitespace.
     * Default: true
     */</span>
    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> <span class="type">boolean</span> trim = <span class="predefined-constant">true</span>;

    <span class="comment">/**
     * Convert empty string to null.
     * Default: true
     */</span>
    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> <span class="type">boolean</span> emptyToNull = <span class="predefined-constant">true</span>;

    <span class="comment">/**
     * Case transformation: UPPER, LOWER, TITLE, NONE.
     * Default: NONE
     */</span>
    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> CaseTransform caseTransform = CaseTransform.NONE;

    <span class="comment">/**
     * Lookup configuration for resolving references from other collections.
     */</span>
    <span class="directive">private</span> LookupConfig lookup;

    <span class="comment">/**
     * Date/time format pattern for parsing date strings.
     * Example: &quot;yyyy-MM-dd&quot;, &quot;MM/dd/yyyy HH:mm:ss&quot;
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> dateFormat;

    <span class="comment">/**
     * Locale for date/number parsing (e.g., &quot;en-US&quot;, &quot;de-DE&quot;).
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> locale;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_3_supporting_enums_and_classes">3.2.3. 3. Supporting Enums and Classes</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.model.persistent.imports</span>;

<span class="comment">/**
 * Behavior when a CSV value is not found in the value mappings.
 */</span>
<span class="directive">public</span> <span class="type">enum</span> UnmappedValueBehavior {
    <span class="comment">/** Keep the original CSV value unchanged */</span>
    PASSTHROUGH,
    <span class="comment">/** Convert to null */</span>
    NULL,
    <span class="comment">/** Treat as an error */</span>
    FAIL
}

<span class="comment">/**
 * String case transformation options.
 */</span>
<span class="directive">public</span> <span class="type">enum</span> CaseTransform {
    NONE,
    UPPER,
    LOWER,
    TITLE
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_4_lookupconfig_for_reference_resolution">3.2.4. 4. LookupConfig for Reference Resolution</h4>
<div class="paragraph">
<p>Supports looking up values from other collections (e.g., map customer name to customer ID).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.model.persistent.imports</span>;

<span class="keyword">import</span> <span class="include">lombok.Data</span>;
<span class="keyword">import</span> <span class="include">lombok.NoArgsConstructor</span>;
<span class="keyword">import</span> <span class="include">lombok.AllArgsConstructor</span>;
<span class="keyword">import</span> <span class="include">lombok.Builder</span>;

<span class="comment">/**
 * Configuration for looking up values from another collection.
 * Useful for resolving foreign key references during import.
 *
 * Example: Map customer name from CSV to customer refName in database.
 */</span>
<span class="annotation">@Data</span>
<span class="annotation">@NoArgsConstructor</span>
<span class="annotation">@AllArgsConstructor</span>
<span class="annotation">@Builder</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">LookupConfig</span> {

    <span class="comment">/**
     * Collection/entity class name to lookup from.
     * Can be simple name (e.g., &quot;Customer&quot;) or fully qualified.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> lookupCollection;

    <span class="comment">/**
     * Field in lookup collection to match against CSV value.
     * Example: &quot;displayName&quot;, &quot;email&quot;, &quot;externalId&quot;
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> lookupMatchField;

    <span class="comment">/**
     * Field in lookup collection to return as the mapped value.
     * Example: &quot;refName&quot;, &quot;id&quot;
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> lookupReturnField;

    <span class="comment">/**
     * Behavior when lookup fails to find a match.
     * Default: FAIL
     */</span>
    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> LookupFailBehavior onNotFound = LookupFailBehavior.FAIL;

    <span class="comment">/**
     * Whether to cache lookup results for performance.
     * Recommended for large imports with repeated values.
     * Default: true
     */</span>
    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> <span class="type">boolean</span> cacheLookups = <span class="predefined-constant">true</span>;

    <span class="comment">/**
     * Optional filter to apply to lookup query.
     * Uses standard Quantum query syntax.
     * Example: &quot;status:ACTIVE&quot;
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> lookupFilter;
}

<span class="comment">/**
 * Behavior when lookup fails to find a matching record.
 */</span>
<span class="directive">public</span> <span class="type">enum</span> LookupFailBehavior {
    <span class="comment">/** Mark row as error */</span>
    FAIL,
    <span class="comment">/** Set field to null */</span>
    NULL,
    <span class="comment">/** Keep original CSV value unchanged */</span>
    PASSTHROUGH
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_5_header_based_field_metadata">3.2.5. 5. Header-Based Field Metadata</h4>
<div class="paragraph">
<p>CSV headers can include optional suffix modifiers to specify field behavior. This feature is <strong>opt-in</strong> via the <code>enableHeaderModifiers</code> flag.</p>
</div>
<div class="sect4">
<h5 id="_header_modifier_syntax">Header Modifier Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>fieldName[modifier]

Where modifier is one of:
  *  = Required (fail if empty/null)
  ?  = Optional (allow empty/null, skip validation)
  ~  = Calculated (compute if not provided)
  #  = Key field (used for intent detection instead of refName)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_examples">Examples</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csv">refName*,displayName*,description?,price*,sku#,createdAt~,modifiedAt~
SKU-001,Widget,A great widget,19.99,SKU-001,,
SKU-002,Gadget,,29.99,SKU-002,,</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example:
- <code>refName*</code> and <code>displayName*</code> are required - import fails if empty
- <code>description?</code> is optional - empty values are accepted without validation error
- <code>price*</code> is required
- <code>sku#</code> is the key field - used instead of <code>refName</code> for INSERT vs UPDATE detection
- <code>createdAt~</code> and <code>modifiedAt~</code> are calculated - if empty, system generates values</p>
</div>
</div>
<div class="sect4">
<h5 id="_headermodifier_enum">HeaderModifier Enum</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.util.csv</span>;

<span class="comment">/**
 * Modifiers that can be applied to CSV header columns via suffix notation.
 * Feature is opt-in via ImportProfile.enableHeaderModifiers or REST parameter.
 */</span>
<span class="directive">public</span> <span class="type">enum</span> HeaderModifier {
    <span class="comment">/**
     * No modifier - field uses default behavior from entity validation.
     */</span>
    NONE(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>),

    <span class="comment">/**
     * Required field - import fails if value is empty/null.
     * Checked BEFORE Jakarta validation, providing earlier feedback.
     * Suffix: *
     */</span>
    REQUIRED(<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>),

    <span class="comment">/**
     * Optional field - empty/null values are allowed.
     * Skips @NotNull/@NotEmpty validation for this field.
     * Suffix: ?
     */</span>
    OPTIONAL(<span class="string"><span class="delimiter">&quot;</span><span class="content">?</span><span class="delimiter">&quot;</span></span>),

    <span class="comment">/**
     * Calculated field - if empty, value is computed by a FieldCalculator.
     * Common uses: timestamps, UUIDs, derived values.
     * Suffix: ~
     */</span>
    CALCULATED(<span class="string"><span class="delimiter">&quot;</span><span class="content">~</span><span class="delimiter">&quot;</span></span>),

    <span class="comment">/**
     * Key field - used for INSERT vs UPDATE detection instead of refName.
     * Useful when importing data where refName differs from natural key.
     * Only one key field allowed per import.
     * Suffix: #
     */</span>
    KEY(<span class="string"><span class="delimiter">&quot;</span><span class="content">#</span><span class="delimiter">&quot;</span></span>);

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> suffix;

    HeaderModifier(<span class="predefined-type">String</span> suffix) {
        <span class="local-variable">this</span>.suffix = suffix;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getSuffix() {
        <span class="keyword">return</span> suffix;
    }

    <span class="comment">/**
     * Parse modifier from header column name.
     * @param header The raw header (e.g., &quot;displayName*&quot;, &quot;price?&quot;)
     * @return The modifier, or NONE if no recognized suffix
     */</span>
    <span class="directive">public</span> <span class="directive">static</span> HeaderModifier fromHeader(<span class="predefined-type">String</span> header) {
        <span class="keyword">if</span> (header == <span class="predefined-constant">null</span> || header.isEmpty()) <span class="keyword">return</span> NONE;
        <span class="type">char</span> last = header.charAt(header.length() - <span class="integer">1</span>);
        <span class="keyword">return</span> <span class="keyword">switch</span> (last) {
            <span class="keyword">case</span> <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span> -&gt; REQUIRED;
            <span class="keyword">case</span> <span class="string"><span class="delimiter">'</span><span class="content">?</span><span class="delimiter">'</span></span> -&gt; OPTIONAL;
            <span class="keyword">case</span> <span class="string"><span class="delimiter">'</span><span class="content">~</span><span class="delimiter">'</span></span> -&gt; CALCULATED;
            <span class="keyword">case</span> <span class="string"><span class="delimiter">'</span><span class="content">#</span><span class="delimiter">'</span></span> -&gt; KEY;
            <span class="keyword">default</span> -&gt; NONE;
        };
    }

    <span class="comment">/**
     * Strip modifier suffix from header to get field name.
     * @param header The raw header (e.g., &quot;displayName*&quot;)
     * @return The field name without suffix (e.g., &quot;displayName&quot;)
     */</span>
    <span class="directive">public</span> <span class="directive">static</span> <span class="predefined-type">String</span> stripModifier(<span class="predefined-type">String</span> header) {
        <span class="keyword">if</span> (header == <span class="predefined-constant">null</span> || header.isEmpty()) <span class="keyword">return</span> header;
        <span class="type">char</span> last = header.charAt(header.length() - <span class="integer">1</span>);
        <span class="keyword">if</span> (last == <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span> || last == <span class="string"><span class="delimiter">'</span><span class="content">?</span><span class="delimiter">'</span></span> || last == <span class="string"><span class="delimiter">'</span><span class="content">~</span><span class="delimiter">'</span></span> || last == <span class="string"><span class="delimiter">'</span><span class="content">#</span><span class="delimiter">'</span></span>) {
            <span class="keyword">return</span> header.substring(<span class="integer">0</span>, header.length() - <span class="integer">1</span>);
        }
        <span class="keyword">return</span> header;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_parsedheader_class">ParsedHeader Class</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.util.csv</span>;

<span class="keyword">import</span> <span class="include">lombok.Value</span>;

<span class="comment">/**
 * Represents a parsed CSV header with field name and modifier.
 */</span>
<span class="annotation">@Value</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ParsedHeader</span> {
    <span class="predefined-type">String</span> fieldName;
    HeaderModifier modifier;

    <span class="comment">/**
     * Parse a raw header string into field name and modifier.
     */</span>
    <span class="directive">public</span> <span class="directive">static</span> ParsedHeader parse(<span class="predefined-type">String</span> rawHeader) {
        HeaderModifier modifier = HeaderModifier.fromHeader(rawHeader);
        <span class="predefined-type">String</span> fieldName = HeaderModifier.stripModifier(rawHeader);
        <span class="keyword">return</span> <span class="keyword">new</span> ParsedHeader(fieldName, modifier);
    }

    <span class="comment">/**
     * @return true if this field is marked as required (*)
     */</span>
    <span class="directive">public</span> <span class="type">boolean</span> isRequired() {
        <span class="keyword">return</span> modifier == HeaderModifier.REQUIRED;
    }

    <span class="comment">/**
     * @return true if this field is marked as optional
     */</span>
    <span class="directive">public</span> <span class="type">boolean</span> isOptional() {
        <span class="keyword">return</span> modifier == HeaderModifier.OPTIONAL;
    }

    <span class="comment">/**
     * @return true if this field should be calculated when empty
     */</span>
    <span class="directive">public</span> <span class="type">boolean</span> isCalculated() {
        <span class="keyword">return</span> modifier == HeaderModifier.CALCULATED;
    }

    <span class="comment">/**
     * @return true if this field is the key for intent detection (#)
     */</span>
    <span class="directive">public</span> <span class="type">boolean</span> isKey() {
        <span class="keyword">return</span> modifier == HeaderModifier.KEY;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fieldcalculator_spi">FieldCalculator SPI</h5>
<div class="paragraph">
<p>For calculated fields (<code>~</code> modifier), a pluggable calculator interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.util.csv</span>;

<span class="keyword">import</span> <span class="include">com.e2eq.framework.model.persistent.base.UnversionedBaseModel</span>;

<span class="comment">/**
 * SPI for calculating field values when marked with ~ modifier and value is empty.
 * Implementations are discovered via CDI.
 */</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">FieldCalculator</span> {

    <span class="comment">/**
     * @return The field name this calculator handles (e.g., &quot;createdAt&quot;, &quot;uuid&quot;)
     */</span>
    <span class="predefined-type">String</span> getFieldName();

    <span class="comment">/**
     * @return Entity types this calculator applies to, or empty for all types
     */</span>
    <span class="keyword">default</span> <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> getTargetTypes() {
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">Class</span>&lt;?&gt;[<span class="integer">0</span>]; <span class="comment">// All types</span>
    }

    <span class="comment">/**
     * @return Priority (lower = earlier). Default calculators run at 1000.
     */</span>
    <span class="keyword">default</span> <span class="type">int</span> getPriority() {
        <span class="keyword">return</span> <span class="integer">1000</span>;
    }

    <span class="comment">/**
     * Calculate the value for a field.
     *
     * @param bean The entity being imported
     * @param fieldName The field to calculate
     * @param context Import context
     * @return The calculated value
     */</span>
    <span class="predefined-type">Object</span> calculate(UnversionedBaseModel bean, <span class="predefined-type">String</span> fieldName, ImportRowContext context);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_built_in_field_calculators">Built-in Field Calculators</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Calculates timestamp fields (createdAt, modifiedAt, updatedAt).
 */</span>
<span class="annotation">@ApplicationScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TimestampFieldCalculator</span> <span class="directive">implements</span> FieldCalculator {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; TIMESTAMP_FIELDS = <span class="predefined-type">Set</span>.of(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">createdAt</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">modifiedAt</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">updatedAt</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">createdDate</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">modifiedDate</span><span class="delimiter">&quot;</span></span>
    );

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getFieldName() {
        <span class="keyword">return</span> <span class="predefined-constant">null</span>; <span class="comment">// Handles multiple fields</span>
    }

    <span class="directive">public</span> <span class="type">boolean</span> handles(<span class="predefined-type">String</span> fieldName) {
        <span class="keyword">return</span> TIMESTAMP_FIELDS.contains(fieldName);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> calculate(UnversionedBaseModel bean, <span class="predefined-type">String</span> fieldName, ImportRowContext context) {
        <span class="keyword">return</span> Instant.now();
    }
}

<span class="comment">/**
 * Calculates UUID fields.
 */</span>
<span class="annotation">@ApplicationScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">UUIDFieldCalculator</span> <span class="directive">implements</span> FieldCalculator {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getFieldName() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">uuid</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> calculate(UnversionedBaseModel bean, <span class="predefined-type">String</span> fieldName, ImportRowContext context) {
        <span class="keyword">return</span> <span class="predefined-type">UUID</span>.randomUUID().toString();
    }
}

<span class="comment">/**
 * Calculates refName from other fields if not provided.
 */</span>
<span class="annotation">@ApplicationScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RefNameCalculator</span> <span class="directive">implements</span> FieldCalculator {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getFieldName() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">refName</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> getPriority() {
        <span class="keyword">return</span> <span class="integer">500</span>; <span class="comment">// Run early</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> calculate(UnversionedBaseModel bean, <span class="predefined-type">String</span> fieldName, ImportRowContext context) {
        <span class="comment">// Try to derive from key field or generate UUID</span>
        <span class="keyword">if</span> (bean.getDisplayName() != <span class="predefined-constant">null</span> &amp;&amp; !bean.getDisplayName().isBlank()) {
            <span class="keyword">return</span> slugify(bean.getDisplayName());
        }
        <span class="keyword">return</span> <span class="predefined-type">UUID</span>.randomUUID().toString();
    }

    <span class="directive">private</span> <span class="predefined-type">String</span> slugify(<span class="predefined-type">String</span> input) {
        <span class="keyword">return</span> input.toLowerCase()
            .replaceAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">[^a-z0-9]+</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">-</span><span class="delimiter">&quot;</span></span>)
            .replaceAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">^-|-$</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_importprofile_configuration">ImportProfile Configuration</h5>
<div class="paragraph">
<p>Add to ImportProfile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Enable header modifier parsing (!, ?, ~, *).
 * When false (default), headers are treated as plain field names.
 * This maintains backward compatibility.
 */</span>
<span class="directive">private</span> <span class="type">boolean</span> enableHeaderModifiers = <span class="predefined-constant">false</span>;

<span class="comment">/**
 * Custom field calculators defined in the profile.
 * These supplement CDI-discovered calculators.
 */</span>
<span class="directive">private</span> <span class="predefined-type">List</span>&lt;InlineFieldCalculator&gt; inlineCalculators;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Inline field calculator defined within an ImportProfile.
 * Supports simple expression-based calculations.
 */</span>
<span class="annotation">@Data</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">InlineFieldCalculator</span> {
    <span class="comment">/**
     * Field name to calculate.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> fieldName;

    <span class="comment">/**
     * Calculation type.
     */</span>
    <span class="directive">private</span> CalculationType type;

    <span class="comment">/**
     * Static value (for STATIC type).
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> staticValue;

    <span class="comment">/**
     * Source field (for COPY type).
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> sourceField;

    <span class="comment">/**
     * Template with ${fieldName} placeholders (for TEMPLATE type).
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> template;

    <span class="directive">public</span> <span class="type">enum</span> CalculationType {
        <span class="comment">/** Use current timestamp */</span>
        TIMESTAMP,
        <span class="comment">/** Generate UUID */</span>
        <span class="predefined-type">UUID</span>,
        <span class="comment">/** Use static value */</span>
        STATIC,
        <span class="comment">/** Copy from another field */</span>
        COPY,
        <span class="comment">/** Template with field placeholders */</span>
        TEMPLATE
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_rest_api_parameter">REST API Parameter</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Parameter</span>(description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Enable header modifier parsing (*, ?, ~, #). </span><span class="delimiter">&quot;</span></span> +
                         <span class="string"><span class="delimiter">&quot;</span><span class="content">When true, headers like 'name*' are parsed as required fields.</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">enableHeaderModifiers</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>) <span class="type">boolean</span> enableHeaderModifiers</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_processing_logic">Processing Logic</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Process headers and extract field metadata.
 */</span>
<span class="directive">private</span> <span class="predefined-type">List</span>&lt;ParsedHeader&gt; parseHeaders(
        <span class="predefined-type">String</span><span class="type">[]</span> rawHeaders,
        <span class="type">boolean</span> enableModifiers) {

    <span class="predefined-type">List</span>&lt;ParsedHeader&gt; parsed = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;(rawHeaders.length);
    <span class="type">int</span> keyFieldCount = <span class="integer">0</span>;

    <span class="keyword">for</span> (<span class="predefined-type">String</span> raw : rawHeaders) {
        <span class="keyword">if</span> (enableModifiers) {
            ParsedHeader header = ParsedHeader.parse(raw);
            <span class="keyword">if</span> (header.isKey()) {
                keyFieldCount++;
                <span class="keyword">if</span> (keyFieldCount &gt; <span class="integer">1</span>) {
                    <span class="keyword">throw</span> <span class="keyword">new</span> ImportException(
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">Multiple key fields (#) specified. Only one key field is allowed.</span><span class="delimiter">&quot;</span></span>);
                }
            }
            parsed.add(header);
        } <span class="keyword">else</span> {
            <span class="comment">// No modifier parsing - treat as plain field name</span>
            parsed.add(<span class="keyword">new</span> ParsedHeader(raw, HeaderModifier.NONE));
        }
    }

    <span class="keyword">return</span> parsed;
}

<span class="comment">/**
 * Validate required fields after parsing, before Jakarta validation.
 */</span>
<span class="directive">private</span> <span class="type">void</span> validateRequiredFields(
        <span class="predefined-type">Object</span> bean,
        <span class="predefined-type">List</span>&lt;ParsedHeader&gt; headers,
        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; values,
        ImportRowResult&lt;?&gt; rowResult) {

    <span class="keyword">for</span> (ParsedHeader header : headers) {
        <span class="keyword">if</span> (header.isRequired()) {
            <span class="predefined-type">Object</span> value = values.get(header.getFieldName());
            <span class="keyword">if</span> (value == <span class="predefined-constant">null</span> || (value <span class="keyword">instanceof</span> <span class="predefined-type">String</span> s &amp;&amp; s.isBlank())) {
                rowResult.addError(<span class="keyword">new</span> FieldError(
                    header.getFieldName(),
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Field is required (marked with *) but value is empty</span><span class="delimiter">&quot;</span></span>,
                    FieldErrorCode.VALIDATION
                ));
            }
        }
    }
}

<span class="comment">/**
 * Apply calculated fields.
 */</span>
<span class="directive">private</span> <span class="type">void</span> applyCalculatedFields(
        UnversionedBaseModel bean,
        <span class="predefined-type">List</span>&lt;ParsedHeader&gt; headers,
        ImportRowContext context) {

    <span class="keyword">for</span> (ParsedHeader header : headers) {
        <span class="keyword">if</span> (header.isCalculated()) {
            <span class="predefined-type">Object</span> currentValue = getFieldValue(bean, header.getFieldName());
            <span class="keyword">if</span> (currentValue == <span class="predefined-constant">null</span> || (currentValue <span class="keyword">instanceof</span> <span class="predefined-type">String</span> s &amp;&amp; s.isBlank())) {
                <span class="predefined-type">Object</span> calculated = calculateField(bean, header.getFieldName(), context);
                <span class="keyword">if</span> (calculated != <span class="predefined-constant">null</span>) {
                    setFieldValue(bean, header.getFieldName(), calculated);
                }
            }
        }
    }
}

<span class="comment">/**
 * Find key field for intent detection.
 */</span>
<span class="directive">private</span> <span class="predefined-type">String</span> findKeyField(<span class="predefined-type">List</span>&lt;ParsedHeader&gt; headers) {
    <span class="keyword">for</span> (ParsedHeader header : headers) {
        <span class="keyword">if</span> (header.isKey()) {
            <span class="keyword">return</span> header.getFieldName();
        }
    }
    <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">refName</span><span class="delimiter">&quot;</span></span>; <span class="comment">// Default</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_complete_csv_with_all_modifiers">Example: Complete CSV with All Modifiers</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csv">_action,sku#,displayName*,description?,price*,category*,createdAt~,uuid~
INSERT,NEW-001,New Widget,A great new widget,19.99,Electronics,,
UPDATE,EXIST-001,Updated Name,,29.99,Home,,
UPSERT,AUTO-001,Auto Detect,Optional desc,39.99,Tools,,
SKIP,IGNORE-001,Ignored Row,,,,,</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Header interpretation:</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Header</th>
<th class="tableblock halign-left valign-top">Modifier</th>
<th class="tableblock halign-left valign-top">Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>_action</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intent column (configured separately)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sku#</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KEY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use <code>sku</code> instead of <code>refName</code> for INSERT/UPDATE detection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>displayName*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REQUIRED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fail import if empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>description?</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPTIONAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow empty, skip @NotNull validation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>price*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REQUIRED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fail import if empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>category*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REQUIRED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fail import if empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createdAt~</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALCULATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generate timestamp if empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uuid~</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CALCULATED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generate UUID if empty</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_backward_compatibility">Backward Compatibility</h5>
<div class="ulist">
<ul>
<li>
<p><strong>Default behavior unchanged</strong>: <code>enableHeaderModifiers=false</code> by default</p>
</li>
<li>
<p><strong>Opt-in only</strong>: Must explicitly enable via profile or REST parameter</p>
</li>
<li>
<p><strong>Graceful handling</strong>: If disabled, characters like <code>*?~#</code> in field names are treated literally</p>
</li>
<li>
<p><strong>Escape mechanism</strong>: To use literal <code><strong></code> in a field name when modifiers are enabled, use <code>\\</strong></code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_6_intent_configuration">3.2.6. 6. Intent Configuration</h4>
<div class="paragraph">
<p>The existing <code>Intent</code> enum (INSERT, UPDATE, SKIP) can optionally be specified per-row via a designated CSV column.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.util.csv</span>;

<span class="comment">/**
 * Supported intent values for CSV import.
 * These match the existing CSVImportHelper.Intent enum.
 *
 * NOTE: MERGE and DELETE are intentionally NOT supported to prevent
 * accidental data loss or complex partial updates via CSV.
 */</span>
<span class="directive">public</span> <span class="type">enum</span> ImportIntent {
    <span class="comment">/**
     * Insert a new record. Fails if refName already exists.
     */</span>
    INSERT,

    <span class="comment">/**
     * Update an existing record. Fails if refName does not exist.
     */</span>
    UPDATE,

    <span class="comment">/**
     * Auto-detect: INSERT if new, UPDATE if exists.
     * This is the current default behavior.
     */</span>
    UPSERT,

    <span class="comment">/**
     * Skip this row - do not process.
     * Useful for conditional imports or marking rows to ignore.
     */</span>
    SKIP
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Why MERGE and DELETE are not supported:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>DELETE</strong>: Allowing bulk deletes via CSV is dangerous. A malformed file or user error could delete large amounts of data. Deletes should be explicit via the REST DELETE endpoint or purpose-built batch operations with additional safeguards.</p>
</li>
<li>
<p><strong>MERGE</strong>: Partial/merge updates are complex and error-prone. It&#8217;s unclear which fields should be preserved vs. overwritten when the CSV value is empty. The current full-replacement semantic is predictable and explicit.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_7_globaltransformations">3.2.7. 7. GlobalTransformations</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.model.persistent.imports</span>;

<span class="keyword">import</span> <span class="include">lombok.Data</span>;
<span class="keyword">import</span> <span class="include">lombok.NoArgsConstructor</span>;
<span class="keyword">import</span> <span class="include">lombok.AllArgsConstructor</span>;
<span class="keyword">import</span> <span class="include">lombok.Builder</span>;

<span class="comment">/**
 * Global transformations applied to all string fields during import.
 * These are applied before column-specific transformations.
 */</span>
<span class="annotation">@Data</span>
<span class="annotation">@NoArgsConstructor</span>
<span class="annotation">@AllArgsConstructor</span>
<span class="annotation">@Builder</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">GlobalTransformations</span> {

    <span class="comment">/**
     * Trim leading/trailing whitespace from all string fields.
     * Default: true
     */</span>
    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> <span class="type">boolean</span> trimStrings = <span class="predefined-constant">true</span>;

    <span class="comment">/**
     * Convert empty strings to null.
     * Default: true
     */</span>
    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> <span class="type">boolean</span> emptyStringsToNull = <span class="predefined-constant">true</span>;

    <span class="comment">/**
     * Unicode normalization form: NFC, NFD, NFKC, NFKD, or null for none.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> unicodeNormalization;

    <span class="comment">/**
     * Remove ASCII control characters (0x00-0x1F except tab/newline).
     * Default: false
     */</span>
    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> <span class="type">boolean</span> removeControlChars = <span class="predefined-constant">false</span>;

    <span class="comment">/**
     * Maximum string length. Strings exceeding this are truncated.
     * Null means no limit.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">Integer</span> maxStringLength;

    <span class="comment">/**
     * Replace multiple consecutive whitespace with single space.
     * Default: false
     */</span>
    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> <span class="type">boolean</span> normalizeWhitespace = <span class="predefined-constant">false</span>;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_8_lookupservice_interface">3.2.8. 8. LookupService Interface</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.util.csv</span>;

<span class="keyword">import</span> <span class="include">com.e2eq.framework.model.persistent.imports.LookupConfig</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="keyword">import</span> <span class="include">java.util.Optional</span>;

<span class="comment">/**
 * Service for resolving lookup references during CSV import.
 */</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">LookupService</span> {

    <span class="comment">/**
     * Look up a single value.
     *
     * @param config The lookup configuration
     * @param matchValue The value to match against lookupMatchField
     * @return The resolved value, or empty if not found
     */</span>
    Optional&lt;<span class="predefined-type">String</span>&gt; lookup(LookupConfig config, <span class="predefined-type">String</span> matchValue);

    <span class="comment">/**
     * Batch lookup for performance optimization.
     * Implementations should use IN queries where possible.
     *
     * @param config The lookup configuration
     * @param matchValues The values to match
     * @return Map of matchValue → resolvedValue (missing keys = not found)
     */</span>
    <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; batchLookup(LookupConfig config, <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; matchValues);

    <span class="comment">/**
     * Clear any cached lookup results.
     */</span>
    <span class="type">void</span> clearCache();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_9_prevalidationtransformer_interface">3.2.9. 9. PreValidationTransformer Interface</h4>
<div class="paragraph">
<p>Programmatic hook for complex transformations that can&#8217;t be expressed declaratively.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.util.csv</span>;

<span class="keyword">import</span> <span class="include">com.e2eq.framework.model.persistent.base.UnversionedBaseModel</span>;

<span class="comment">/**
 * SPI for transforming parsed CSV beans before validation.
 * Implementations are discovered via CDI and applied in priority order.
 *
 * Use cases:
 * - Computing derived fields
 * - Cross-field validation/transformation
 * - Complex business logic that can't be expressed declaratively
 * - Conditional transformations based on other field values
 */</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">PreValidationTransformer</span>&lt;T <span class="directive">extends</span> UnversionedBaseModel&gt; {

    <span class="comment">/**
     * @return The entity class this transformer handles
     */</span>
    <span class="predefined-type">Class</span>&lt;T&gt; getTargetType();

    <span class="comment">/**
     * @return Priority (lower = earlier). Default transformers run at 1000.
     */</span>
    <span class="keyword">default</span> <span class="type">int</span> getPriority() {
        <span class="keyword">return</span> <span class="integer">1000</span>;
    }

    <span class="comment">/**
     * Transform the bean after CSV parsing but before validation.
     *
     * @param bean The parsed bean instance (already has cell processor transformations applied)
     * @param context Import context with access to row data, profile, lookup service, etc.
     * @return The transformed bean (may be same instance modified in place, or a new instance)
     * @throws TransformationException if transformation fails (row will be marked as error)
     */</span>
    T transform(T bean, ImportRowContext context) <span class="directive">throws</span> TransformationException;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_10_importrowcontext">3.2.10. 10. ImportRowContext</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.util.csv</span>;

<span class="keyword">import</span> <span class="include">com.e2eq.framework.model.persistent.imports.ImportProfile</span>;
<span class="keyword">import</span> <span class="include">lombok.Builder</span>;
<span class="keyword">import</span> <span class="include">lombok.Data</span>;

<span class="keyword">import</span> <span class="include">java.util.List</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;

<span class="comment">/**
 * Context information available to PreValidationTransformer implementations.
 */</span>
<span class="annotation">@Data</span>
<span class="annotation">@Builder</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ImportRowContext</span> {

    <span class="comment">/**
     * Current row number (1-based, after header).
     */</span>
    <span class="directive">private</span> <span class="type">int</span> rowNumber;

    <span class="comment">/**
     * Raw CSV line as string.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> rawLine;

    <span class="comment">/**
     * Parsed cell values by column index (0-based).
     * These are the raw string values before any transformation.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; rawValues;

    <span class="comment">/**
     * Parsed cell values by column name (if header was present).
     * These are the raw string values before any transformation.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; rawValuesByName;

    <span class="comment">/**
     * The import profile being used (may be null for profile-less imports).
     */</span>
    <span class="directive">private</span> ImportProfile profile;

    <span class="comment">/**
     * The import session ID (if using session-based flow).
     */</span>
    <span class="directive">private</span> <span class="predefined-type">String</span> sessionId;

    <span class="comment">/**
     * Access to lookup service for additional reference resolution.
     */</span>
    <span class="directive">private</span> LookupService lookupService;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_11_transformationexception">3.2.11. 11. TransformationException</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.util.csv</span>;

<span class="comment">/**
 * Exception thrown when a transformation fails during CSV import.
 * Results in the row being marked as an error.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">TransformationException</span> <span class="directive">extends</span> <span class="exception">RuntimeException</span> {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> field;

    <span class="directive">public</span> TransformationException(<span class="predefined-type">String</span> message) {
        <span class="local-variable">super</span>(message);
        <span class="local-variable">this</span>.field = <span class="predefined-constant">null</span>;
    }

    <span class="directive">public</span> TransformationException(<span class="predefined-type">String</span> field, <span class="predefined-type">String</span> message) {
        <span class="local-variable">super</span>(message);
        <span class="local-variable">this</span>.field = field;
    }

    <span class="directive">public</span> TransformationException(<span class="predefined-type">String</span> message, <span class="predefined-type">Throwable</span> cause) {
        <span class="local-variable">super</span>(message, cause);
        <span class="local-variable">this</span>.field = <span class="predefined-constant">null</span>;
    }

    <span class="directive">public</span> TransformationException(<span class="predefined-type">String</span> field, <span class="predefined-type">String</span> message, <span class="predefined-type">Throwable</span> cause) {
        <span class="local-variable">super</span>(message, cause);
        <span class="local-variable">this</span>.field = field;
    }

    <span class="comment">/**
     * @return The field that caused the error, or null if not field-specific
     */</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getField() {
        <span class="keyword">return</span> field;
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enhanced_cell_processors">3.3. Enhanced Cell Processors</h3>
<div class="sect3">
<h4 id="_valuemapprocessor">3.3.1. ValueMapProcessor</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.util.csv.processors</span>;

<span class="keyword">import</span> <span class="include">com.e2eq.framework.model.persistent.imports.UnmappedValueBehavior</span>;
<span class="keyword">import</span> <span class="include">org.supercsv.cellprocessor.CellProcessorAdaptor</span>;
<span class="keyword">import</span> <span class="include">org.supercsv.cellprocessor.ift.CellProcessor</span>;
<span class="keyword">import</span> <span class="include">org.supercsv.exception.SuperCsvCellProcessorException</span>;
<span class="keyword">import</span> <span class="include">org.supercsv.util.CsvContext</span>;

<span class="keyword">import</span> <span class="include">java.util.HashMap</span>;
<span class="keyword">import</span> <span class="include">java.util.Map</span>;

<span class="comment">/**
 * Cell processor that maps values using a lookup table.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ValueMapProcessor</span> <span class="directive">extends</span> CellProcessorAdaptor {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; mappings;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; lowerCaseMappings;
    <span class="directive">private</span> <span class="directive">final</span> <span class="type">boolean</span> caseSensitive;
    <span class="directive">private</span> <span class="directive">final</span> UnmappedValueBehavior unmappedBehavior;

    <span class="directive">public</span> ValueMapProcessor(
            <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; mappings,
            <span class="type">boolean</span> caseSensitive,
            UnmappedValueBehavior unmappedBehavior,
            CellProcessor next) {
        <span class="local-variable">super</span>(next);
        <span class="local-variable">this</span>.mappings = mappings;
        <span class="local-variable">this</span>.caseSensitive = caseSensitive;
        <span class="local-variable">this</span>.unmappedBehavior = unmappedBehavior;

        <span class="comment">// Pre-compute lowercase keys for case-insensitive matching</span>
        <span class="keyword">if</span> (!caseSensitive) {
            <span class="local-variable">this</span>.lowerCaseMappings = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
            mappings.forEach((k, v) -&gt; lowerCaseMappings.put(k.toLowerCase(), v));
        } <span class="keyword">else</span> {
            <span class="local-variable">this</span>.lowerCaseMappings = <span class="predefined-constant">null</span>;
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> execute(<span class="predefined-type">Object</span> value, CsvContext ctx) {
        <span class="keyword">if</span> (value == <span class="predefined-constant">null</span>) {
            <span class="keyword">return</span> next.execute(<span class="predefined-constant">null</span>, ctx);
        }

        <span class="predefined-type">String</span> stringValue = value.toString();
        <span class="predefined-type">String</span> mapped;

        <span class="keyword">if</span> (caseSensitive) {
            mapped = mappings.get(stringValue);
        } <span class="keyword">else</span> {
            mapped = lowerCaseMappings.get(stringValue.toLowerCase());
        }

        <span class="keyword">if</span> (mapped == <span class="predefined-constant">null</span>) {
            <span class="keyword">switch</span> (unmappedBehavior) {
                <span class="keyword">case</span> PASSTHROUGH:
                    <span class="keyword">return</span> next.execute(value, ctx);
                <span class="keyword">case</span> NULL:
                    <span class="keyword">return</span> next.execute(<span class="predefined-constant">null</span>, ctx);
                <span class="keyword">case</span> FAIL:
                    <span class="keyword">throw</span> <span class="keyword">new</span> SuperCsvCellProcessorException(
                        <span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">No mapping found for value '%s'. Valid values: %s</span><span class="delimiter">&quot;</span></span>,
                            stringValue, mappings.keySet()),
                        ctx, <span class="local-variable">this</span>);
                <span class="keyword">default</span>:
                    <span class="keyword">return</span> next.execute(value, ctx);
            }
        }

        <span class="keyword">return</span> next.execute(mapped, ctx);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_regexreplaceprocessor">3.3.2. RegexReplaceProcessor</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.util.csv.processors</span>;

<span class="keyword">import</span> <span class="include">org.supercsv.cellprocessor.CellProcessorAdaptor</span>;
<span class="keyword">import</span> <span class="include">org.supercsv.cellprocessor.ift.CellProcessor</span>;
<span class="keyword">import</span> <span class="include">org.supercsv.util.CsvContext</span>;

<span class="keyword">import</span> <span class="include">java.util.regex.Pattern</span>;

<span class="comment">/**
 * Cell processor that performs regex replacement on string values.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RegexReplaceProcessor</span> <span class="directive">extends</span> CellProcessorAdaptor {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Pattern</span> pattern;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">String</span> replacement;

    <span class="directive">public</span> RegexReplaceProcessor(<span class="predefined-type">String</span> regex, <span class="predefined-type">String</span> replacement, CellProcessor next) {
        <span class="local-variable">super</span>(next);
        <span class="local-variable">this</span>.pattern = <span class="predefined-type">Pattern</span>.compile(regex);
        <span class="local-variable">this</span>.replacement = replacement != <span class="predefined-constant">null</span> ? replacement : <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> execute(<span class="predefined-type">Object</span> value, CsvContext ctx) {
        <span class="keyword">if</span> (value == <span class="predefined-constant">null</span>) {
            <span class="keyword">return</span> next.execute(<span class="predefined-constant">null</span>, ctx);
        }

        <span class="predefined-type">String</span> result = pattern.matcher(value.toString()).replaceAll(replacement);
        <span class="keyword">return</span> next.execute(result, ctx);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_casetransformprocessor">3.3.3. CaseTransformProcessor</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.util.csv.processors</span>;

<span class="keyword">import</span> <span class="include">com.e2eq.framework.model.persistent.imports.CaseTransform</span>;
<span class="keyword">import</span> <span class="include">org.supercsv.cellprocessor.CellProcessorAdaptor</span>;
<span class="keyword">import</span> <span class="include">org.supercsv.cellprocessor.ift.CellProcessor</span>;
<span class="keyword">import</span> <span class="include">org.supercsv.util.CsvContext</span>;

<span class="comment">/**
 * Cell processor that transforms string case.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CaseTransformProcessor</span> <span class="directive">extends</span> CellProcessorAdaptor {

    <span class="directive">private</span> <span class="directive">final</span> CaseTransform transform;

    <span class="directive">public</span> CaseTransformProcessor(CaseTransform transform, CellProcessor next) {
        <span class="local-variable">super</span>(next);
        <span class="local-variable">this</span>.transform = transform;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> execute(<span class="predefined-type">Object</span> value, CsvContext ctx) {
        <span class="keyword">if</span> (value == <span class="predefined-constant">null</span>) {
            <span class="keyword">return</span> next.execute(<span class="predefined-constant">null</span>, ctx);
        }

        <span class="predefined-type">String</span> s = value.toString();
        <span class="predefined-type">String</span> result = <span class="keyword">switch</span> (transform) {
            <span class="keyword">case</span> UPPER -&gt; s.toUpperCase();
            <span class="keyword">case</span> LOWER -&gt; s.toLowerCase();
            <span class="keyword">case</span> TITLE -&gt; toTitleCase(s);
            <span class="keyword">case</span> NONE -&gt; s;
        };

        <span class="keyword">return</span> next.execute(result, ctx);
    }

    <span class="directive">private</span> <span class="predefined-type">String</span> toTitleCase(<span class="predefined-type">String</span> s) {
        <span class="keyword">if</span> (s == <span class="predefined-constant">null</span> || s.isEmpty()) <span class="keyword">return</span> s;

        <span class="predefined-type">StringBuilder</span> result = <span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>(s.length());
        <span class="type">boolean</span> capitalizeNext = <span class="predefined-constant">true</span>;

        <span class="keyword">for</span> (<span class="type">char</span> c : s.toCharArray()) {
            <span class="keyword">if</span> (<span class="predefined-type">Character</span>.isWhitespace(c)) {
                capitalizeNext = <span class="predefined-constant">true</span>;
                result.append(c);
            } <span class="keyword">else</span> <span class="keyword">if</span> (capitalizeNext) {
                result.append(<span class="predefined-type">Character</span>.toUpperCase(c));
                capitalizeNext = <span class="predefined-constant">false</span>;
            } <span class="keyword">else</span> {
                result.append(<span class="predefined-type">Character</span>.toLowerCase(c));
            }
        }

        <span class="keyword">return</span> result.toString();
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lookupprocessor">3.3.4. LookupProcessor</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.util.csv.processors</span>;

<span class="keyword">import</span> <span class="include">com.e2eq.framework.model.persistent.imports.LookupConfig</span>;
<span class="keyword">import</span> <span class="include">com.e2eq.framework.model.persistent.imports.LookupFailBehavior</span>;
<span class="keyword">import</span> <span class="include">com.e2eq.framework.util.csv.LookupService</span>;
<span class="keyword">import</span> <span class="include">org.supercsv.cellprocessor.CellProcessorAdaptor</span>;
<span class="keyword">import</span> <span class="include">org.supercsv.cellprocessor.ift.CellProcessor</span>;
<span class="keyword">import</span> <span class="include">org.supercsv.exception.SuperCsvCellProcessorException</span>;
<span class="keyword">import</span> <span class="include">org.supercsv.util.CsvContext</span>;

<span class="keyword">import</span> <span class="include">java.util.Map</span>;
<span class="keyword">import</span> <span class="include">java.util.Optional</span>;
<span class="keyword">import</span> <span class="include">java.util.concurrent.ConcurrentHashMap</span>;

<span class="comment">/**
 * Cell processor that looks up values from another collection.
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">LookupProcessor</span> <span class="directive">extends</span> CellProcessorAdaptor {

    <span class="directive">private</span> <span class="directive">final</span> LookupService lookupService;
    <span class="directive">private</span> <span class="directive">final</span> LookupConfig config;
    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, Optional&lt;<span class="predefined-type">String</span>&gt;&gt; cache;

    <span class="directive">public</span> LookupProcessor(
            LookupService lookupService,
            LookupConfig config,
            CellProcessor next) {
        <span class="local-variable">super</span>(next);
        <span class="local-variable">this</span>.lookupService = lookupService;
        <span class="local-variable">this</span>.config = config;
        <span class="local-variable">this</span>.cache = config.isCacheLookups() ? <span class="keyword">new</span> <span class="predefined-type">ConcurrentHashMap</span>&lt;&gt;() : <span class="predefined-constant">null</span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> execute(<span class="predefined-type">Object</span> value, CsvContext ctx) {
        <span class="keyword">if</span> (value == <span class="predefined-constant">null</span>) {
            <span class="keyword">return</span> next.execute(<span class="predefined-constant">null</span>, ctx);
        }

        <span class="predefined-type">String</span> key = value.toString();
        Optional&lt;<span class="predefined-type">String</span>&gt; result;

        <span class="keyword">if</span> (cache != <span class="predefined-constant">null</span>) {
            result = cache.computeIfAbsent(key, k -&gt; lookupService.lookup(config, k));
        } <span class="keyword">else</span> {
            result = lookupService.lookup(config, key);
        }

        <span class="keyword">if</span> (result.isEmpty()) {
            <span class="keyword">switch</span> (config.getOnNotFound()) {
                <span class="keyword">case</span> FAIL:
                    <span class="keyword">throw</span> <span class="keyword">new</span> SuperCsvCellProcessorException(
                        <span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">Lookup failed: no %s found with %s = '%s'</span><span class="delimiter">&quot;</span></span>,
                            config.getLookupCollection(),
                            config.getLookupMatchField(),
                            key),
                        ctx, <span class="local-variable">this</span>);
                <span class="keyword">case</span> NULL:
                    <span class="keyword">return</span> next.execute(<span class="predefined-constant">null</span>, ctx);
                <span class="keyword">case</span> PASSTHROUGH:
                    <span class="keyword">return</span> next.execute(value, ctx);
            }
        }

        <span class="keyword">return</span> next.execute(result.get(), ctx);
    }

    <span class="comment">/**
     * Clear the lookup cache. Call between imports if reusing processor.
     */</span>
    <span class="directive">public</span> <span class="type">void</span> clearCache() {
        <span class="keyword">if</span> (cache != <span class="predefined-constant">null</span>) {
            cache.clear();
        }
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_enhanced_csvimporthelper">3.4. Enhanced CSVImportHelper</h3>
<div class="sect3">
<h4 id="_new_method_signatures">3.4.1. New Method Signatures</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ApplicationScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CSVImportHelper</span> {

    <span class="annotation">@Inject</span>
    Instance&lt;PreValidationTransformer&lt;?&gt;&gt; transformers;

    <span class="annotation">@Inject</span>
    ImportProfileRepo importProfileRepo;

    <span class="annotation">@Inject</span>
    LookupService lookupService;

    <span class="comment">// ... existing methods unchanged ...</span>

    <span class="comment">/**
     * Import CSV with an ImportProfile for transformations.
     *
     * @param repo The repository for the target entity type
     * @param inputStream The CSV input stream
     * @param profile The import profile with transformation rules
     * @param formatOptions CSV format options (separator, quote, charset, etc.)
     * @param failedRecordHandler Optional handler for failed records
     * @return Import result with counts and error details
     */</span>
    <span class="directive">public</span> &lt;T <span class="directive">extends</span> UnversionedBaseModel&gt; ImportResult&lt;T&gt; importCSV(
            BaseMorphiaRepo&lt;T&gt; repo,
            <span class="predefined-type">InputStream</span> inputStream,
            ImportProfile profile,
            CSVFormatOptions formatOptions,
            FailedRecordHandler&lt;T&gt; failedRecordHandler);

    <span class="comment">/**
     * Import CSV with profile referenced by refName.
     *
     * @param repo The repository for the target entity type
     * @param inputStream The CSV input stream
     * @param profileRefName The refName of an existing ImportProfile
     * @param formatOptions CSV format options
     * @param failedRecordHandler Optional handler for failed records
     * @return Import result with counts and error details
     * @throws ValidationException if profile not found
     */</span>
    <span class="directive">public</span> &lt;T <span class="directive">extends</span> UnversionedBaseModel&gt; ImportResult&lt;T&gt; importCSV(
            BaseMorphiaRepo&lt;T&gt; repo,
            <span class="predefined-type">InputStream</span> inputStream,
            <span class="predefined-type">String</span> profileRefName,
            CSVFormatOptions formatOptions,
            FailedRecordHandler&lt;T&gt; failedRecordHandler);

    <span class="comment">/**
     * Analyze CSV with profile for preview (session-based flow).
     *
     * @param repo The repository for the target entity type
     * @param inputStream The CSV input stream
     * @param profile The import profile with transformation rules
     * @param formatOptions CSV format options
     * @return Import result with preview data and session ID
     */</span>
    <span class="directive">public</span> &lt;T <span class="directive">extends</span> UnversionedBaseModel&gt; ImportResult&lt;T&gt; analyzeCSV(
            BaseMorphiaRepo&lt;T&gt; repo,
            <span class="predefined-type">InputStream</span> inputStream,
            ImportProfile profile,
            CSVFormatOptions formatOptions) <span class="directive">throws</span> <span class="exception">IOException</span>;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_csvformatoptions_refactored">3.4.2. CSVFormatOptions (Refactored)</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.util.csv</span>;

<span class="keyword">import</span> <span class="include">lombok.Builder</span>;
<span class="keyword">import</span> <span class="include">lombok.Data</span>;

<span class="keyword">import</span> <span class="include">java.nio.charset.Charset</span>;
<span class="keyword">import</span> <span class="include">java.nio.charset.StandardCharsets</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="comment">/**
 * CSV format configuration options.
 */</span>
<span class="annotation">@Data</span>
<span class="annotation">@Builder</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CSVFormatOptions</span> {

    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> <span class="type">char</span> fieldSeparator = <span class="string"><span class="delimiter">'</span><span class="content">,</span><span class="delimiter">'</span></span>;

    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> <span class="type">char</span> quoteChar = <span class="string"><span class="delimiter">'</span><span class="content">&quot;</span><span class="delimiter">'</span></span>;

    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> <span class="type">boolean</span> skipHeaderRow = <span class="predefined-constant">true</span>;

    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> <span class="predefined-type">Charset</span> charset = StandardCharsets.UTF_8;

    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> <span class="type">boolean</span> hasBOM = <span class="predefined-constant">false</span>;

    <span class="annotation">@Builder</span>.Default
    <span class="directive">private</span> <span class="predefined-type">String</span> quotingStrategy = <span class="string"><span class="delimiter">&quot;</span><span class="content">QUOTE_WHERE_ESSENTIAL</span><span class="delimiter">&quot;</span></span>;

    <span class="comment">/**
     * Column names/fields to import, in CSV column order.
     * If null and profile has columnMappings, uses those.
     * If both null, uses header row.
     */</span>
    <span class="directive">private</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; requestedColumns;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enhanced_processor_chain_building">3.4.3. Enhanced Processor Chain Building</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Build cell processors from ImportProfile column mappings.
 */</span>
<span class="directive">private</span> CellProcessor<span class="type">[]</span> buildProcessorsFromProfile(
        <span class="predefined-type">Class</span>&lt;?&gt; clazz,
        ImportProfile profile,
        ListCellProcessor listProcessor) {

    <span class="predefined-type">List</span>&lt;ColumnMapping&gt; mappings = profile.getColumnMappings();
    CellProcessor<span class="type">[]</span> processors = <span class="keyword">new</span> CellProcessor[mappings.size()];

    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">0</span>; i &lt; mappings.size(); i++) {
        ColumnMapping mapping = mappings.get(i);
        processors[i] = buildProcessorChain(clazz, mapping, listProcessor);
    }

    <span class="keyword">return</span> processors;
}

<span class="comment">/**
 * Build a processor chain for a single column.
 * Processors are chained innermost-first (type conversion is innermost).
 */</span>
<span class="directive">private</span> CellProcessor buildProcessorChain(
        <span class="predefined-type">Class</span>&lt;?&gt; clazz,
        ColumnMapping mapping,
        ListCellProcessor listProcessor) {

    <span class="predefined-type">String</span> fieldName = mapping.getTargetField();
    <span class="predefined-type">Class</span>&lt;?&gt; type = getFieldType(clazz, fieldName);

    <span class="comment">// Start with type-specific processor (innermost)</span>
    CellProcessor chain = buildTypeProcessor(type, mapping, listProcessor);

    <span class="comment">// Add lookup if configured</span>
    <span class="keyword">if</span> (mapping.getLookup() != <span class="predefined-constant">null</span>) {
        chain = <span class="keyword">new</span> LookupProcessor(lookupService, mapping.getLookup(), chain);
    }

    <span class="comment">// Add value mapping if configured</span>
    <span class="keyword">if</span> (mapping.getValueMappings() != <span class="predefined-constant">null</span> &amp;&amp; !mapping.getValueMappings().isEmpty()) {
        chain = <span class="keyword">new</span> ValueMapProcessor(
            mapping.getValueMappings(),
            mapping.isValueMappingCaseSensitive(),
            mapping.getUnmappedValueBehavior(),
            chain);
    }

    <span class="comment">// Add regex replacement if configured</span>
    <span class="keyword">if</span> (mapping.getRegexPattern() != <span class="predefined-constant">null</span>) {
        chain = <span class="keyword">new</span> RegexReplaceProcessor(
            mapping.getRegexPattern(),
            mapping.getRegexReplacement(),
            chain);
    }

    <span class="comment">// Add case transformation</span>
    <span class="keyword">if</span> (mapping.getCaseTransform() != CaseTransform.NONE) {
        chain = <span class="keyword">new</span> CaseTransformProcessor(mapping.getCaseTransform(), chain);
    }

    <span class="comment">// Add trim (applied early, before other transformations)</span>
    <span class="keyword">if</span> (mapping.isTrim()) {
        chain = <span class="keyword">new</span> org.supercsv.cellprocessor.Trim(chain);
    }

    <span class="comment">// Add empty-to-null conversion</span>
    <span class="keyword">if</span> (mapping.isEmptyToNull()) {
        chain = <span class="keyword">new</span> EmptyToNullProcessor(chain);
    }

    <span class="comment">// Add default value handling (applied last, after null conversion)</span>
    <span class="keyword">if</span> (mapping.getDefaultValue() != <span class="predefined-constant">null</span>) {
        chain = <span class="keyword">new</span> org.supercsv.cellprocessor.ConvertNullTo(mapping.getDefaultValue(), chain);
    }

    <span class="comment">// Wrap with Optional for null safety</span>
    <span class="keyword">return</span> <span class="keyword">new</span> org.supercsv.cellprocessor.Optional(chain);
}

<span class="directive">private</span> CellProcessor buildTypeProcessor(
        <span class="predefined-type">Class</span>&lt;?&gt; type,
        ColumnMapping mapping,
        ListCellProcessor listProcessor) {

    <span class="keyword">if</span> (mapping.getTargetField().contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">[</span><span class="delimiter">&quot;</span></span>)) {
        <span class="keyword">return</span> listProcessor;
    }

    <span class="comment">// Handle date with custom format</span>
    <span class="keyword">if</span> (type == java.time.LocalDate.class || type == java.time.LocalDateTime.class
            || type == java.util.Date.class) {
        <span class="keyword">if</span> (mapping.getDateFormat() != <span class="predefined-constant">null</span>) {
            <span class="keyword">return</span> <span class="keyword">new</span> ParseDateProcessor(mapping.getDateFormat(), mapping.getLocale());
        }
    }

    <span class="comment">// Standard type processors</span>
    <span class="keyword">if</span> (type == <span class="type">int</span>.class || type == <span class="predefined-type">Integer</span>.class) {
        <span class="keyword">return</span> <span class="keyword">new</span> org.supercsv.cellprocessor.ParseInt();
    } <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="type">long</span>.class || type == <span class="predefined-type">Long</span>.class) {
        <span class="keyword">return</span> <span class="keyword">new</span> org.supercsv.cellprocessor.ParseLong();
    } <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="type">double</span>.class || type == <span class="predefined-type">Double</span>.class
            || type == <span class="type">float</span>.class || type == <span class="predefined-type">Float</span>.class) {
        <span class="keyword">return</span> <span class="keyword">new</span> org.supercsv.cellprocessor.ParseDouble();
    } <span class="keyword">else</span> <span class="keyword">if</span> (type == java.math.BigDecimal.class) {
        <span class="keyword">return</span> <span class="keyword">new</span> org.supercsv.cellprocessor.ParseBigDecimal();
    } <span class="keyword">else</span> <span class="keyword">if</span> (type == <span class="type">boolean</span>.class || type == <span class="predefined-type">Boolean</span>.class) {
        <span class="keyword">return</span> <span class="keyword">new</span> org.supercsv.cellprocessor.ParseBool();
    } <span class="keyword">else</span> <span class="keyword">if</span> (type != <span class="predefined-constant">null</span> &amp;&amp; type.isEnum()) {
        <span class="keyword">return</span> <span class="keyword">new</span> ParseEnum((<span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> <span class="predefined-type">Enum</span>&lt;?&gt;&gt;) type);
    }

    <span class="comment">// Default: pass through as string</span>
    <span class="keyword">return</span> <span class="keyword">new</span> org.supercsv.cellprocessor.constraint.NotNull();
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_prevalidationtransformer_integration">3.4.4. PreValidationTransformer Integration</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Apply pre-validation transformers to a parsed bean.
 */</span>
<span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">unchecked</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> &lt;T <span class="directive">extends</span> UnversionedBaseModel&gt; T applyTransformers(
        T bean,
        ImportRowContext context) <span class="directive">throws</span> TransformationException {

    <span class="keyword">if</span> (transformers == <span class="predefined-constant">null</span> || transformers.isUnsatisfied()) {
        <span class="keyword">return</span> bean;
    }

    <span class="comment">// Collect and sort transformers by priority</span>
    <span class="predefined-type">List</span>&lt;PreValidationTransformer&lt;T&gt;&gt; applicable = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();
    <span class="keyword">for</span> (PreValidationTransformer&lt;?&gt; transformer : transformers) {
        <span class="keyword">if</span> (transformer.getTargetType().isAssignableFrom(bean.getClass())) {
            applicable.add((PreValidationTransformer&lt;T&gt;) transformer);
        }
    }

    applicable.sort(<span class="predefined-type">Comparator</span>.comparingInt(PreValidationTransformer::getPriority));

    <span class="comment">// Apply transformers in order</span>
    T result = bean;
    <span class="keyword">for</span> (PreValidationTransformer&lt;T&gt; transformer : applicable) {
        result = transformer.transform(result, context);
    }

    <span class="keyword">return</span> result;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_intent_resolution">3.4.5. Intent Resolution</h4>
<div class="paragraph">
<p>When an <code>intentColumn</code> is configured, the import process reads the intent from each row and validates it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Resolve the intent for a row from CSV data or profile defaults.
 *
 * @param profile The import profile (may have intentColumn configured)
 * @param rowValues The parsed CSV row values by column name
 * @param existsInDb Whether the record already exists (for UPSERT resolution)
 * @return The resolved intent for this row
 * @throws ImportException if an invalid intent value is specified
 */</span>
<span class="directive">private</span> ImportIntent resolveIntent(
        ImportProfile profile,
        <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; rowValues,
        <span class="type">boolean</span> existsInDb) {

    <span class="comment">// If no intent column configured, use default behavior</span>
    <span class="keyword">if</span> (profile == <span class="predefined-constant">null</span> || profile.getIntentColumn() == <span class="predefined-constant">null</span>) {
        <span class="keyword">return</span> existsInDb ? ImportIntent.UPDATE : ImportIntent.INSERT;
    }

    <span class="comment">// Read intent from CSV column</span>
    <span class="predefined-type">String</span> intentValue = rowValues.get(profile.getIntentColumn());

    <span class="keyword">if</span> (intentValue != <span class="predefined-constant">null</span> &amp;&amp; !intentValue.isBlank()) {
        <span class="predefined-type">String</span> normalized = intentValue.toUpperCase().trim();

        <span class="comment">// Validate against allowed intents (explicitly reject MERGE/DELETE)</span>
        <span class="keyword">switch</span> (normalized) {
            <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT</span><span class="delimiter">&quot;</span></span>:
                <span class="keyword">return</span> ImportIntent.INSERT;
            <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">UPDATE</span><span class="delimiter">&quot;</span></span>:
                <span class="keyword">return</span> ImportIntent.UPDATE;
            <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">SKIP</span><span class="delimiter">&quot;</span></span>:
                <span class="keyword">return</span> ImportIntent.SKIP;
            <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">UPSERT</span><span class="delimiter">&quot;</span></span>:
                <span class="keyword">return</span> existsInDb ? ImportIntent.UPDATE : ImportIntent.INSERT;
            <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">MERGE</span><span class="delimiter">&quot;</span></span>:
            <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE</span><span class="delimiter">&quot;</span></span>:
                <span class="keyword">throw</span> <span class="keyword">new</span> ImportException(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Intent '</span><span class="delimiter">&quot;</span></span> + normalized + <span class="string"><span class="delimiter">&quot;</span><span class="content">' is not supported. </span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Only INSERT, UPDATE, UPSERT, and SKIP are allowed.</span><span class="delimiter">&quot;</span></span>);
            <span class="keyword">default</span>:
                <span class="keyword">throw</span> <span class="keyword">new</span> ImportException(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid intent value: '</span><span class="delimiter">&quot;</span></span> + intentValue + <span class="string"><span class="delimiter">&quot;</span><span class="content">'. </span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Valid values are: INSERT, UPDATE, UPSERT, SKIP.</span><span class="delimiter">&quot;</span></span>);
        }
    }

    <span class="comment">// Fall back to profile default</span>
    <span class="predefined-type">String</span> defaultIntent = profile.getDefaultIntent();
    <span class="keyword">if</span> (defaultIntent == <span class="predefined-constant">null</span> || defaultIntent.isBlank()) {
        defaultIntent = <span class="string"><span class="delimiter">&quot;</span><span class="content">UPSERT</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="keyword">return</span> <span class="keyword">switch</span> (defaultIntent.toUpperCase()) {
        <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT</span><span class="delimiter">&quot;</span></span> -&gt; ImportIntent.INSERT;
        <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">UPDATE</span><span class="delimiter">&quot;</span></span> -&gt; ImportIntent.UPDATE;
        <span class="keyword">case</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">SKIP</span><span class="delimiter">&quot;</span></span> -&gt; ImportIntent.SKIP;
        <span class="keyword">default</span> -&gt; existsInDb ? ImportIntent.UPDATE : ImportIntent.INSERT; <span class="comment">// UPSERT</span>
    };
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_intent_execution">3.4.6. Intent Execution</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">/**
 * Execute the save operation based on the resolved intent.
 */</span>
<span class="directive">private</span> &lt;T <span class="directive">extends</span> UnversionedBaseModel&gt; <span class="type">void</span> executeWithIntent(
        BaseMorphiaRepo&lt;T&gt; repo,
        T bean,
        ImportIntent intent,
        ImportRowResult&lt;T&gt; rowResult) {

    <span class="keyword">switch</span> (intent) {
        <span class="keyword">case</span> INSERT -&gt; {
            <span class="comment">// Verify record doesn't exist</span>
            Optional&lt;T&gt; existing = repo.findByRefName(bean.getRefName());
            <span class="keyword">if</span> (existing.isPresent()) {
                <span class="keyword">throw</span> <span class="keyword">new</span> ImportException(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Cannot INSERT: record with refName '</span><span class="delimiter">&quot;</span></span> + bean.getRefName() +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">' already exists. Use UPDATE or UPSERT intent.</span><span class="delimiter">&quot;</span></span>);
            }
            repo.save(bean);
            rowResult.setIntent(Intent.INSERT);
        }

        <span class="keyword">case</span> UPDATE -&gt; {
            <span class="comment">// Verify record exists and get its ID</span>
            Optional&lt;T&gt; existing = repo.findByRefName(bean.getRefName());
            <span class="keyword">if</span> (existing.isEmpty()) {
                <span class="keyword">throw</span> <span class="keyword">new</span> ImportException(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Cannot UPDATE: record with refName '</span><span class="delimiter">&quot;</span></span> + bean.getRefName() +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">' does not exist. Use INSERT or UPSERT intent.</span><span class="delimiter">&quot;</span></span>);
            }
            <span class="comment">// Copy ID to ensure update, not insert</span>
            bean.setId(existing.get().getId());
            repo.save(bean);
            rowResult.setIntent(Intent.UPDATE);
        }

        <span class="keyword">case</span> SKIP -&gt; {
            <span class="comment">// Do nothing - row is intentionally skipped</span>
            rowResult.setIntent(Intent.SKIP);
        }

        <span class="comment">// UPSERT is resolved to INSERT or UPDATE before this method is called</span>
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rest_api_enhancements">3.5. REST API Enhancements</h3>
<div class="sect3">
<h4 id="_updated_endpoints">3.5.1. Updated Endpoints</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// In BaseResource.java</span>

<span class="annotation">@POST</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">csv</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Consumes</span>(MediaType.MULTIPART_FORM_DATA)
<span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="annotation">@Operation</span>(summary = <span class="string"><span class="delimiter">&quot;</span><span class="content">Import a list of entities from a CSV file</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Response importCSVList(
        <span class="annotation">@Context</span> UriInfo info,
        <span class="annotation">@BeanParam</span> FileUpload fileUpload,
        <span class="comment">// Existing parameters</span>
        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">fieldSeparator</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">,</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> fieldSeparator,
        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">quoteChar</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> quoteChar,
        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">skipHeaderRow</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>) <span class="type">boolean</span> skipHeaderRow,
        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">requestedColumns</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> requestedColumns,
        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">charsetEncoding</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8-without-BOM</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> charsetEncoding,
        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">quotingStrategy</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">QUOTE_WHERE_ESSENTIAL</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> quotingStrategy,
        <span class="comment">// NEW parameters</span>
        <span class="annotation">@Parameter</span>(description = <span class="string"><span class="delimiter">&quot;</span><span class="content">RefName of ImportProfile to use for value mapping and transformations</span><span class="delimiter">&quot;</span></span>)
        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">profileRefName</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> profileRefName,
        <span class="annotation">@Parameter</span>(description = <span class="string"><span class="delimiter">&quot;</span><span class="content">CSV column name containing per-row intent (INSERT, UPDATE, SKIP). </span><span class="delimiter">&quot;</span></span> +
                                 <span class="string"><span class="delimiter">&quot;</span><span class="content">If not specified, uses UPSERT behavior (auto-detect).</span><span class="delimiter">&quot;</span></span>)
        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">intentColumn</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> intentColumn,
        <span class="annotation">@Parameter</span>(description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Default intent when intentColumn value is empty. </span><span class="delimiter">&quot;</span></span> +
                                 <span class="string"><span class="delimiter">&quot;</span><span class="content">One of: INSERT, UPDATE, UPSERT, SKIP. Default: UPSERT</span><span class="delimiter">&quot;</span></span>)
        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultIntent</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">UPSERT</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> defaultIntent,
        <span class="annotation">@Parameter</span>(description = <span class="string"><span class="delimiter">&quot;</span><span class="content">Enable header modifier parsing. When true, headers like </span><span class="delimiter">&quot;</span></span> +
                                 <span class="string"><span class="delimiter">&quot;</span><span class="content">'name*' (required), 'desc?' (optional), 'createdAt~' (calculated), </span><span class="delimiter">&quot;</span></span> +
                                 <span class="string"><span class="delimiter">&quot;</span><span class="content">'sku#' (key field) are parsed for field metadata.</span><span class="delimiter">&quot;</span></span>)
        <span class="annotation">@QueryParam</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">enableHeaderModifiers</span><span class="delimiter">&quot;</span></span>) <span class="annotation">@DefaultValue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>) <span class="type">boolean</span> enableHeaderModifiers
) {
    <span class="comment">// Implementation uses profile if provided, or parameters directly</span>
}

<span class="annotation">@POST</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">csv/session</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Consumes</span>(MediaType.MULTIPART_FORM_DATA)
<span class="annotation">@Produces</span>(MediaType.APPLICATION_JSON)
<span class="annotation">@Operation</span>(summary = <span class="string"><span class="delimiter">&quot;</span><span class="content">Create an import session with preview</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Response createCsvImportSession(
        <span class="comment">// ... same parameters including profileRefName ...</span>
) {
    <span class="comment">// Implementation</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_importprofile_resource">3.5.2. ImportProfile Resource</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.e2eq.framework.rest.resources</span>;

<span class="keyword">import</span> <span class="include">com.e2eq.framework.model.persistent.imports.ImportProfile</span>;
<span class="keyword">import</span> <span class="include">com.e2eq.framework.model.persistent.morphia.ImportProfileRepo</span>;
<span class="keyword">import</span> <span class="include">jakarta.ws.rs.Path</span>;

<span class="comment">/**
 * REST resource for managing ImportProfiles.
 */</span>
<span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/integration/import-profiles</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">ImportProfileResource</span> <span class="directive">extends</span> BaseResource&lt;ImportProfile, ImportProfileRepo&gt; {
    <span class="comment">// Standard CRUD endpoints inherited from BaseResource</span>
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_example_usage">3.6. Example Usage</h3>
<div class="sect3">
<h4 id="_example_importprofile_json">3.6.1. Example ImportProfile (JSON)</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">refName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">product-import-v1</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">displayName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Product Import Profile</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Maps legacy product CSV format to Product entity</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">targetType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.Product</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">columnMappings</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">SKU</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">targetField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">refName</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">trim</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">caseTransform</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UPPER</span><span class="delimiter">&quot;</span></span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Product Name</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">targetField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">displayName</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">trim</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Status</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">targetField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">valueMappings</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">A</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTIVE</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">I</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">INACTIVE</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">D</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">DISCONTINUED</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">P</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">PENDING</span><span class="delimiter">&quot;</span></span>
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">unmappedValueBehavior</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FAIL</span><span class="delimiter">&quot;</span></span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Active</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">targetField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">isActive</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">valueMappings</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">Y</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">N</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">YES</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">NO</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">valueMappingCaseSensitive</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Category</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">targetField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">categoryRefName</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">lookup</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">lookupCollection</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Category</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">lookupMatchField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">displayName</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">lookupReturnField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">refName</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">onNotFound</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">FAIL</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">cacheLookups</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
      }
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Price</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">targetField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">price</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">regexPattern</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">[$,]</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">regexReplacement</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">trim</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Tags</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">targetField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">tags</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">regexPattern</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="char">\\</span><span class="content">s*[,;]</span><span class="char">\\</span><span class="content">s*</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">regexReplacement</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">,</span><span class="delimiter">&quot;</span></span>
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">globalTransformations</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">trimStrings</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">emptyStringsToNull</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">normalizeWhitespace</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">intentColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">_action</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">defaultIntent</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UPSERT</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_csv_without_intent_column">3.6.2. Example CSV (without intent column)</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csv">SKU,Product Name,Status,Active,Category,Price,Tags
 sku-001 ,Widget Pro,A,Y,Electronics,$19.99,new; featured
SKU-002,Gadget Plus,I,N,Home &amp; Garden,$29.99,sale, clearance
sku-003,Tool Kit,D,0,Tools,$49.99,</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_csv_with_intent_column">3.6.3. Example CSV (with intent column)</h4>
<div class="paragraph">
<p>When you need explicit control over whether each row is inserted, updated, or skipped:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csv">_action,SKU,Product Name,Status,Active,Category,Price,Tags
INSERT,SKU-NEW-001,Brand New Widget,A,Y,Electronics,$19.99,new
UPDATE,SKU-002,Updated Gadget Name,A,Y,Home &amp; Garden,$34.99,updated
SKIP,SKU-003,Ignore This Row,I,N,Tools,$0.00,
UPSERT,SKU-004,Auto Detect Mode,A,Y,Electronics,$24.99,auto
INSERT,SKU-NEW-002,Another New Product,A,Y,Tools,$49.99,new</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Intent column behavior:</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Intent</th>
<th class="tableblock halign-left valign-top">Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>INSERT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Insert new record. <strong>Fails if refName already exists.</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPDATE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Update existing record. <strong>Fails if refName does not exist.</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UPSERT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-detect: INSERT if new, UPDATE if exists. (Default behavior)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SKIP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip this row entirely - no database operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MERGE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Not supported</strong> - returns error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DELETE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Not supported</strong> - returns error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_api_calls">3.6.4. API Calls</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># Create the profile first
curl -X POST \
  -H &quot;Authorization: Bearer $JWT&quot; \
  -H &quot;Content-Type: application/json&quot; \
  &quot;https://host/api/integration/import-profiles&quot; \
  -d @product-import-profile.json

# Import using the profile (UPSERT behavior - auto-detect insert vs update)
curl -X POST \
  -H &quot;Authorization: Bearer $JWT&quot; \
  -F &quot;file=@products.csv&quot; \
  &quot;https://host/api/products/csv?profileRefName=product-import-v1&amp;skipHeaderRow=true&quot;

# Import with explicit intent column (no profile needed for intent)
curl -X POST \
  -H &quot;Authorization: Bearer $JWT&quot; \
  -F &quot;file=@products-with-intent.csv&quot; \
  &quot;https://host/api/products/csv?requestedColumns=_action,refName,displayName,status&amp;intentColumn=_action&amp;skipHeaderRow=true&quot;

# Import with intent column and profile for value mappings
curl -X POST \
  -H &quot;Authorization: Bearer $JWT&quot; \
  -F &quot;file=@products-with-intent.csv&quot; \
  &quot;https://host/api/products/csv?profileRefName=product-import-v1&amp;intentColumn=_action&amp;skipHeaderRow=true&quot;

# Import with default intent (all rows treated as INSERT, fail if exists)
curl -X POST \
  -H &quot;Authorization: Bearer $JWT&quot; \
  -F &quot;file=@new-products.csv&quot; \
  &quot;https://host/api/products/csv?profileRefName=product-import-v1&amp;defaultIntent=INSERT&amp;skipHeaderRow=true&quot;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_prevalidationtransformer">3.6.5. Example PreValidationTransformer</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.example.imports</span>;

<span class="keyword">import</span> <span class="include">com.e2eq.framework.util.csv.ImportRowContext</span>;
<span class="keyword">import</span> <span class="include">com.e2eq.framework.util.csv.PreValidationTransformer</span>;
<span class="keyword">import</span> <span class="include">com.e2eq.framework.util.csv.TransformationException</span>;
<span class="keyword">import</span> <span class="include">com.example.model.Product</span>;
<span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;

<span class="keyword">import</span> <span class="include">java.math.BigDecimal</span>;

<span class="annotation">@ApplicationScoped</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProductTransformer</span> <span class="directive">implements</span> PreValidationTransformer&lt;Product&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;Product&gt; getTargetType() {
        <span class="keyword">return</span> Product.class;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> getPriority() {
        <span class="keyword">return</span> <span class="integer">500</span>; <span class="comment">// Run before default transformers</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Product transform(Product product, ImportRowContext context)
            <span class="directive">throws</span> TransformationException {

        <span class="comment">// Compute derived fields</span>
        <span class="keyword">if</span> (product.getPrice() != <span class="predefined-constant">null</span> &amp;&amp; product.getQuantity() != <span class="predefined-constant">null</span>) {
            product.setTotalValue(
                product.getPrice().multiply(<span class="predefined-type">BigDecimal</span>.valueOf(product.getQuantity()))
            );
        }

        <span class="comment">// Business rule: new products default to DRAFT status</span>
        <span class="keyword">if</span> (product.getStatus() == <span class="predefined-constant">null</span>) {
            product.setStatus(ProductStatus.DRAFT);
        }

        <span class="comment">// Cross-field validation</span>
        <span class="keyword">if</span> (product.getDiscountPrice() != <span class="predefined-constant">null</span> &amp;&amp; product.getPrice() != <span class="predefined-constant">null</span>) {
            <span class="keyword">if</span> (product.getDiscountPrice().compareTo(product.getPrice()) &gt; <span class="integer">0</span>) {
                <span class="keyword">throw</span> <span class="keyword">new</span> TransformationException(
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">discountPrice</span><span class="delimiter">&quot;</span></span>,
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">Discount price cannot exceed regular price</span><span class="delimiter">&quot;</span></span>
                );
            }
        }

        <span class="comment">// Conditional transformation</span>
        <span class="keyword">if</span> (<span class="string"><span class="delimiter">&quot;</span><span class="content">CLEARANCE</span><span class="delimiter">&quot;</span></span>.equals(product.getCategory())) {
            product.setFeatured(<span class="predefined-constant">false</span>);
            product.setSearchable(<span class="predefined-constant">false</span>);
        }

        <span class="keyword">return</span> product;
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_migration_path">4. Migration Path</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_phase_1_core_models_non_breaking">4.1. Phase 1: Core Models (Non-Breaking)</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add <code>ImportProfile</code> entity and repository</p>
</li>
<li>
<p>Add <code>ColumnMapping</code>, <code>LookupConfig</code>, <code>GlobalTransformations</code>, <code>CaseTransform</code>, enums</p>
</li>
<li>
<p>Add <code>LookupService</code> interface</p>
</li>
<li>
<p>Create <code>ImportProfileResource</code> REST endpoint</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Backward Compatibility:</strong> No changes to existing behavior.</p>
</div>
</div>
<div class="sect2">
<h3 id="_phase_2_cell_processors_non_breaking">4.2. Phase 2: Cell Processors (Non-Breaking)</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add <code>ValueMapProcessor</code></p>
</li>
<li>
<p>Add <code>RegexReplaceProcessor</code></p>
</li>
<li>
<p>Add <code>CaseTransformProcessor</code></p>
</li>
<li>
<p>Add <code>LookupProcessor</code></p>
</li>
<li>
<p>Add <code>EmptyToNullProcessor</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Backward Compatibility:</strong> New processors only used when profile specified.</p>
</div>
</div>
<div class="sect2">
<h3 id="_phase_3_csvimporthelper_enhancement_non_breaking">4.3. Phase 3: CSVImportHelper Enhancement (Non-Breaking)</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add overloaded methods accepting <code>ImportProfile</code></p>
</li>
<li>
<p>Add <code>buildProcessorsFromProfile()</code> method</p>
</li>
<li>
<p>Implement processor chain building from profile</p>
</li>
<li>
<p>Add <code>LookupService</code> implementation</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Backward Compatibility:</strong> Existing methods unchanged; new methods are additions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_phase_4_prevalidationtransformer_spi_non_breaking">4.4. Phase 4: PreValidationTransformer SPI (Non-Breaking)</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add <code>PreValidationTransformer</code> interface</p>
</li>
<li>
<p>Add <code>ImportRowContext</code> class</p>
</li>
<li>
<p>Add <code>TransformationException</code></p>
</li>
<li>
<p>Integrate transformer invocation into import flow</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Backward Compatibility:</strong> Transformers are optional; empty by default.</p>
</div>
</div>
<div class="sect2">
<h3 id="_phase_5_header_modifiers_non_breaking">4.5. Phase 5: Header Modifiers (Non-Breaking)</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add <code>HeaderModifier</code> enum and <code>ParsedHeader</code> class</p>
</li>
<li>
<p>Add <code>FieldCalculator</code> SPI interface</p>
</li>
<li>
<p>Add built-in calculators (Timestamp, UUID, RefName)</p>
</li>
<li>
<p>Add <code>InlineFieldCalculator</code> for profile-defined calculations</p>
</li>
<li>
<p>Add <code>enableHeaderModifiers</code> flag to ImportProfile</p>
</li>
<li>
<p>Add <code>enableHeaderModifiers</code> REST parameter</p>
</li>
<li>
<p>Integrate header parsing into import flow</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Backward Compatibility:</strong> Feature is opt-in; disabled by default.</p>
</div>
</div>
<div class="sect2">
<h3 id="_phase_6_rest_api_updates_non_breaking">4.6. Phase 6: REST API Updates (Non-Breaking)</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add <code>profileRefName</code> query parameter to CSV endpoints</p>
</li>
<li>
<p>Add <code>intentColumn</code> and <code>defaultIntent</code> parameters</p>
</li>
<li>
<p>Add <code>enableHeaderModifiers</code> parameter</p>
</li>
<li>
<p>Update OpenAPI documentation</p>
</li>
<li>
<p>Add user guide documentation</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Backward Compatibility:</strong> All parameters are optional; existing calls work unchanged.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security_considerations">5. Security Considerations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_profile_access_control">5.1. Profile Access Control</h3>
<div class="ulist">
<ul>
<li>
<p><code>ImportProfile</code> entities follow standard DataDomain scoping</p>
</li>
<li>
<p>Profiles can only be used within their tenant/org context</p>
</li>
<li>
<p>Cross-tenant profile access is blocked</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_lookup_security">5.2. Lookup Security</h3>
<div class="ulist">
<ul>
<li>
<p>Lookup queries respect the caller&#8217;s security context</p>
</li>
<li>
<p>RuleContext filters are applied to lookup queries</p>
</li>
<li>
<p>Cross-tenant lookups are blocked by DataDomain filtering</p>
</li>
<li>
<p>Lookups only access collections the user has VIEW permission on</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_regex_safety">5.3. Regex Safety</h3>
<div class="ulist">
<ul>
<li>
<p>Consider limiting regex complexity to prevent ReDoS attacks</p>
</li>
<li>
<p>Implement timeout for regex operations on large values</p>
</li>
<li>
<p>Log warnings for potentially dangerous patterns</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_performance_considerations">6. Performance Considerations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lookup_caching">6.1. Lookup Caching</h3>
<div class="ulist">
<ul>
<li>
<p>Lookups are cached per-import session by default (<code>cacheLookups: true</code>)</p>
</li>
<li>
<p>Cache is cleared between import sessions</p>
</li>
<li>
<p>Consider LRU eviction for imports with many unique lookup values</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_batch_lookup_optimization">6.2. Batch Lookup Optimization</h3>
<div class="ulist">
<ul>
<li>
<p><code>LookupService.batchLookup()</code> allows batch resolution</p>
</li>
<li>
<p>Collect all values for a column, resolve in single query</p>
</li>
<li>
<p>Reduces database round-trips for large imports</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_profile_caching">6.3. Profile Caching</h3>
<div class="ulist">
<ul>
<li>
<p>Frequently used profiles could be cached in memory</p>
</li>
<li>
<p>Consider cache invalidation on profile update</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_testing_strategy">7. Testing Strategy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_unit_tests">7.1. Unit Tests</h3>
<div class="ulist">
<ul>
<li>
<p>Test each cell processor in isolation</p>
</li>
<li>
<p>Test processor chain building with various configurations</p>
</li>
<li>
<p>Test value mapping with case sensitivity options</p>
</li>
<li>
<p>Test lookup with various failure behaviors</p>
</li>
<li>
<p>Test PreValidationTransformer priority ordering</p>
</li>
<li>
<p>Test header modifier parsing (*, ?, ~, #)</p>
</li>
<li>
<p>Test ParsedHeader.parse() with various inputs</p>
</li>
<li>
<p>Test FieldCalculator invocation for calculated fields</p>
</li>
<li>
<p>Test required field validation</p>
</li>
<li>
<p>Test key field intent detection</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_integration_tests">7.2. Integration Tests</h3>
<div class="ulist">
<ul>
<li>
<p>Test full import flow with profiles</p>
</li>
<li>
<p>Test lookup resolution across collections</p>
</li>
<li>
<p>Test security filtering on lookups</p>
</li>
<li>
<p>Test error handling and reporting</p>
</li>
<li>
<p>Test header modifiers with real CSV files</p>
</li>
<li>
<p>Test backward compatibility (modifiers disabled)</p>
</li>
<li>
<p>Test calculated fields with CDI-discovered calculators</p>
</li>
<li>
<p>Test inline calculators from profile</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_performance_tests">7.3. Performance Tests</h3>
<div class="ulist">
<ul>
<li>
<p>Benchmark imports with 100K+ rows</p>
</li>
<li>
<p>Measure lookup cache effectiveness</p>
</li>
<li>
<p>Profile memory usage during large imports</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appendix_a_common_value_mapping_patterns">8. Appendix A: Common Value Mapping Patterns</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_boolean_values">8.1. Boolean Values</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">valueMappings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Y</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">N</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">YES</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">NO</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">TRUE</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">FALSE</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">T</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">F</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">ON</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">OFF</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">valueMappingCaseSensitive</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_status_codes">8.2. Status Codes</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">valueMappings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">DRAFT</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">PENDING</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">30</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">APPROVED</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">40</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ACTIVE</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">SUSPENDED</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">90</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CLOSED</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">99</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">CANCELLED</span><span class="delimiter">&quot;</span></span>
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_country_codes">8.3. Country Codes</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">valueMappings</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">USA</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">US</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">United States</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">US</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">UK</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">GB</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">United Kingdom</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">GB</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">Great Britain</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">GB</span><span class="delimiter">&quot;</span></span>
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">valueMappingCaseSensitive</span><span class="delimiter">&quot;</span></span>: <span class="value">false</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">unmappedValueBehavior</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">PASSTHROUGH</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appendix_b_regex_patterns">9. Appendix B: Regex Patterns</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_remove_currency_symbols">9.1. Remove Currency Symbols</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">regexPattern</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">[$€£¥,]</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">regexReplacement</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_normalize_phone_numbers">9.2. Normalize Phone Numbers</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">regexPattern</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">[^0-9+]</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">regexReplacement</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extract_numeric_id">9.3. Extract Numeric ID</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">regexPattern</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^[A-Z]+-([0-9]+)$</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">regexReplacement</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">$1</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_normalize_whitespace">9.4. Normalize Whitespace</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">regexPattern</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="char">\\</span><span class="content">s+</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">regexReplacement</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation_status">10. Implementation Status</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following components have been implemented:</p>
</div>
<div class="sect2">
<h3 id="_completed_components">10.1. Completed Components</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 28.5714%;">
<col style="width: 28.5714%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CaseTransform</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.model.persistent.imports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum for string case transformation options</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UnmappedValueBehavior</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.model.persistent.imports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum for behavior when CSV value not in mappings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LookupFailBehavior</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.model.persistent.imports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum for behavior when lookup fails</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LookupConfig</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.model.persistent.imports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration for cross-collection lookups</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ColumnMapping</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.model.persistent.imports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Per-column transformation configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GlobalTransformations</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.model.persistent.imports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global string transformation settings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>InlineFieldCalculator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.model.persistent.imports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inline calculator definitions for profiles</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HeaderModifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.model.persistent.imports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum for header modifier suffixes (*, ?, ~, #)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ParsedHeader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.model.persistent.imports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parsed CSV header with modifier</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ImportIntent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.model.persistent.imports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Import intent enum (INSERT, UPDATE, SKIP, UPSERT)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ImportProfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.model.persistent.imports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Persistent profile entity extending BaseModel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ImportSession</code> (updated)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.model.persistent.imports</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added <code>profileRefName</code> field</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ImportProfileRepo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.model.persistent.morphia</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Repository for ImportProfile entities</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>FieldCalculator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.spi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI interface for field calculators</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PreValidationTransformer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.spi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI interface for pre-validation transformers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ImportContext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.spi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context object for SPI implementations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LookupService</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.service</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface for cross-collection lookups</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LookupServiceImpl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.service</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default implementation with caching</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ImportProfileService</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.service</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Orchestration service for profile processing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TimestampFieldCalculator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.calculators</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Built-in calculator for timestamp fields</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UUIDFieldCalculator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.calculators</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Built-in calculator for UUID fields</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RefNameFieldCalculator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.calculators</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Built-in calculator for refName generation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ValueMapProcessor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.processors</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CellProcessor for value mapping</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RegexReplaceProcessor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.processors</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CellProcessor for regex replacement</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CaseTransformProcessor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.processors</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CellProcessor for case transformation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LookupProcessor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.processors</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CellProcessor for cross-collection lookups</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>GlobalTransformProcessor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.processors</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CellProcessor for global transformations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RowValueResolver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.spi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI interface for arbitrary per-row code execution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RowValueResolverProcessor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.imports.processors</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CellProcessor wrapper for RowValueResolver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CSVImportHelper</code> (enhanced)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.util</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added <code>analyzeCSVWithProfile()</code> method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BaseResource</code> (enhanced)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.e2eq.framework.rest.resources</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added <code>/csv/session/profile</code> endpoint</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_rest_api_endpoints">10.2. REST API Endpoints</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 33.3333%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Path</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/{entity}/csv/session/profile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create import session with ImportProfile support. Accepts <code>profileRefName</code> query parameter.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_usage">10.3. Usage</h3>
<div class="paragraph">
<p>To use the new profile-based import:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Create an ImportProfile</strong> via the standard BaseResource CRUD endpoints or directly in the database</p>
</li>
<li>
<p><strong>Call the profile endpoint:</strong></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">curl -X POST \
  -H &quot;Authorization: Bearer $TOKEN&quot; \
  -F &quot;file=@data.csv&quot; \
  &quot;https://host/api/products/csv/session/profile?profileRefName=my-profile&quot;</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Review the preview</strong> and commit using the existing session workflow:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># Commit the session
curl -X POST \
  -H &quot;Authorization: Bearer $TOKEN&quot; \
  &quot;https://host/api/products/csv/session/{sessionId}/commit&quot;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rowvalueresolver_per_row_arbitrary_code_execution">11. RowValueResolver: Per-Row Arbitrary Code Execution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>RowValueResolver</code> SPI allows you to run arbitrary code for each row during CSV import.
Unlike static lookups which match a single field against a collection, RowValueResolvers
have access to <strong>all columns in the row</strong> and can invoke external services, apply complex
business logic, or perform conditional transformations.</p>
</div>
<div class="sect2">
<h3 id="_use_cases">11.1. Use Cases</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Geocoding addresses</strong>: Look up latitude/longitude from a geocoding service based on address fields</p>
</li>
<li>
<p><strong>Cross-field validation</strong>: Validate combinations of fields that depend on each other</p>
</li>
<li>
<p><strong>External service calls</strong>: Call APIs to enrich, validate, or transform data</p>
</li>
<li>
<p><strong>Complex business rules</strong>: Apply conditional logic based on multiple fields</p>
</li>
<li>
<p><strong>Composite key generation</strong>: Generate identifiers from multiple source columns</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_example_address_geocoding">11.2. Example: Address Geocoding</h3>
<div class="paragraph">
<p>This example shows how to geocode addresses during import, setting latitude and longitude
fields based on an address lookup service.</p>
</div>
<div class="sect3">
<h4 id="_1_create_the_rowvalueresolver_implementation">11.2.1. 1. Create the RowValueResolver Implementation</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.example.imports</span>;

<span class="keyword">import</span> <span class="include">com.e2eq.framework.imports.spi.ImportContext</span>;
<span class="keyword">import</span> <span class="include">com.e2eq.framework.imports.spi.RowValueResolver</span>;
<span class="keyword">import</span> <span class="include">jakarta.enterprise.context.ApplicationScoped</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Inject</span>;
<span class="keyword">import</span> <span class="include">jakarta.inject.Named</span>;

<span class="keyword">import</span> <span class="include">java.util.Map</span>;

<span class="annotation">@ApplicationScoped</span>
<span class="annotation">@Named</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">geocodeResolver</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">GeocodeResolver</span> <span class="directive">implements</span> RowValueResolver {

    <span class="annotation">@Inject</span>
    GeocodingService geocodingService;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">geocodeResolver</span><span class="delimiter">&quot;</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">ResolveResult</span> resolve(<span class="predefined-type">String</span> inputValue, <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; rowData, ImportContext context) {
        <span class="comment">// Access multiple address columns from the row</span>
        <span class="predefined-type">String</span> street = getString(rowData, <span class="string"><span class="delimiter">&quot;</span><span class="content">street</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">String</span> city = getString(rowData, <span class="string"><span class="delimiter">&quot;</span><span class="content">city</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">String</span> state = getString(rowData, <span class="string"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">String</span> zip = getString(rowData, <span class="string"><span class="delimiter">&quot;</span><span class="content">zip</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">String</span> country = getString(rowData, <span class="string"><span class="delimiter">&quot;</span><span class="content">country</span><span class="delimiter">&quot;</span></span>);

        <span class="comment">// Build full address for geocoding</span>
        <span class="predefined-type">String</span> fullAddress = <span class="predefined-type">String</span>.format(<span class="string"><span class="delimiter">&quot;</span><span class="content">%s, %s, %s %s, %s</span><span class="delimiter">&quot;</span></span>,
                street, city, state, zip, country);

        <span class="keyword">try</span> {
            <span class="comment">// Call external geocoding service</span>
            GeocodingResult result = geocodingService.geocode(fullAddress);

            <span class="keyword">if</span> (result == <span class="predefined-constant">null</span> || !result.isValid()) {
                <span class="comment">// Return null - field won't be set but row continues</span>
                <span class="keyword">return</span> <span class="predefined-type">ResolveResult</span>.nullValue();
            }

            <span class="comment">// Return a GeoPoint or coordinate object</span>
            <span class="keyword">return</span> <span class="predefined-type">ResolveResult</span>.success(<span class="keyword">new</span> GeoPoint(result.getLatitude(), result.getLongitude()));

        } <span class="keyword">catch</span> (GeocodingException e) {
            <span class="comment">// Log warning but don't fail the row</span>
            <span class="keyword">return</span> <span class="predefined-type">ResolveResult</span>.nullValue();
        } <span class="keyword">catch</span> (<span class="exception">Exception</span> e) {
            <span class="comment">// Critical error - skip this row</span>
            <span class="keyword">return</span> <span class="predefined-type">ResolveResult</span>.error(<span class="string"><span class="delimiter">&quot;</span><span class="content">Geocoding failed: </span><span class="delimiter">&quot;</span></span> + e.getMessage());
        }
    }

    <span class="directive">private</span> <span class="predefined-type">String</span> getString(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; rowData, <span class="predefined-type">String</span> key) {
        <span class="predefined-type">Object</span> value = rowData.get(key);
        <span class="keyword">return</span> value != <span class="predefined-constant">null</span> ? value.toString().trim() : <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_2_configure_the_importprofile">11.2.2. 2. Configure the ImportProfile</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">refName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">location-import-profile</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">displayName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Location Import with Geocoding</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">targetCollection</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.model.Location</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">columnMappings</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">targetField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">displayName</span><span class="delimiter">&quot;</span></span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">street</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">targetField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">address.street</span><span class="delimiter">&quot;</span></span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">city</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">targetField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">address.city</span><span class="delimiter">&quot;</span></span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">state</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">targetField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">address.state</span><span class="delimiter">&quot;</span></span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">zip</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">targetField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">address.postalCode</span><span class="delimiter">&quot;</span></span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">country</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">targetField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">address.country</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">defaultValue</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">USA</span><span class="delimiter">&quot;</span></span>
    },
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">sourceColumn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">street</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">targetField</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">location</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">rowValueResolverName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">geocodeResolver</span><span class="delimiter">&quot;</span></span>
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: The <code>sourceColumn</code> for the geocodeResolver can be any column - the resolver has access
to all row data via the <code>rowData</code> map. The column value is passed as <code>inputValue</code> but you
can ignore it and use any combination of columns.</p>
</div>
</div>
<div class="sect3">
<h4 id="_3_sample_csv_input">11.2.3. 3. Sample CSV Input</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csv">name,street,city,state,zip,country
&quot;Acme Corp HQ&quot;,&quot;123 Main St&quot;,&quot;San Francisco&quot;,&quot;CA&quot;,&quot;94102&quot;,&quot;USA&quot;
&quot;East Coast Office&quot;,&quot;456 Park Ave&quot;,&quot;New York&quot;,&quot;NY&quot;,&quot;10022&quot;,&quot;USA&quot;
&quot;European Branch&quot;,&quot;10 Oxford St&quot;,&quot;London&quot;,&quot;&quot;,&quot;W1D 1BS&quot;,&quot;UK&quot;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_4_result">11.2.4. 4. Result</h4>
<div class="paragraph">
<p>After import, each Location entity will have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All address fields populated from the CSV</p>
</li>
<li>
<p>A <code>location</code> field containing a GeoPoint with latitude/longitude</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rowvalueresolver_api">11.3. RowValueResolver API</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">RowValueResolver</span> {

    <span class="comment">/**
     * Unique name for this resolver (used in ColumnMapping.rowValueResolverName).
     */</span>
    <span class="predefined-type">String</span> getName();

    <span class="comment">/**
     * Resolve a value based on input and row data.
     *
     * @param inputValue the value from the CSV column (after prior transformations)
     * @param rowData all column values from the current row (column name -&gt; value)
     * @param context import context with profile, realm, row number, session ID
     * @return the resolution result
     */</span>
    <span class="predefined-type">ResolveResult</span> resolve(<span class="predefined-type">String</span> inputValue, <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; rowData, ImportContext context);

    <span class="comment">/**
     * Check if this resolver applies to the given target class.
     * Default returns true (applies to all types).
     */</span>
    <span class="keyword">default</span> <span class="type">boolean</span> appliesTo(<span class="predefined-type">Class</span>&lt;?&gt; targetClass) {
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
    }

    <span class="comment">/**
     * Priority order - lower values run first. Default is 100.
     */</span>
    <span class="keyword">default</span> <span class="type">int</span> getOrder() {
        <span class="keyword">return</span> <span class="integer">100</span>;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_resolveresult_options">11.4. ResolveResult Options</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Method</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResolveResult.success(value)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Return a resolved value to set on the target field</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResolveResult.passthrough(originalValue)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keep the original value unchanged</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResolveResult.nullValue()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the field to null (but continue processing)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResolveResult.skip()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip this row entirely (not an error)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResolveResult.skip(reason)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip with a reason message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ResolveResult.error(message)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mark row as error with the given message</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_processing_order">11.5. Processing Order</h3>
<div class="paragraph">
<p>RowValueResolvers are applied after field calculators but before pre-validation transformers:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CSV parsing with CellProcessors (value mapping, regex, case transform, static lookups)</p>
</li>
<li>
<p>Field calculators (timestamps, UUIDs, templates)</p>
</li>
<li>
<p><strong>RowValueResolvers</strong> (arbitrary code with full row access)</p>
</li>
<li>
<p>Pre-validation transformers</p>
</li>
<li>
<p>Bean validation</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.2.4-SNAPSHOT<br>
Last updated 2026-01-26 13:55:19 -0500
</div>
</div>
</body>
</html>